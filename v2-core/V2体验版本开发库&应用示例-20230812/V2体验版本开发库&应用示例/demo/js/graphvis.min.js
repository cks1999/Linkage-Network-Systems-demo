/**
 * GraphVis
 * @description Graph Data Visualization Analysis Kit (website: www.graphvis.cn)
 * @author dubaopeng
 * @email dubaopeng@126.com
 * @license (c) GraphVis 2019-2023. All rights reserved
 * @version: v2.2.0 (built on 2023-08-13 01:43:05)
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).GraphVis=e()}(this,function(){"use strict";function F(e,t){var i,n=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)),n}function h(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?F(Object(o),!0).forEach(function(t){var e,i;e=n,i=o[t=t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):F(Object(o)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))})}return n}function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){var i;if(t)return"string"==typeof t?s(t,e):"Map"===(i="Object"===(i=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}null!=Object.assign&&Object.assign.bind(Object);function a(t,e,i,n){for(var o in e)if(e.hasOwnProperty(o)||!0===i)if(e[o]&&e[o].constructor===Object)void 0===t[o]&&(t[o]={}),t[o].constructor===Object?a(t[o],e[o],i):null===e[o]&&void 0!==t[o]&&!0===n?delete t[o]:t[o]=e[o];else if(Array.isArray(e[o])){t[o]=[];for(var s=0;s<e[o].length;s++)t[o].push(e[o][s])}else null===e[o]&&void 0!==t[o]&&!0===n?delete t[o]:t[o]=e[o];return t}function m(t){return Number(Math.random().toString().substring(2,t)+Date.now()).toString(36)}function i(t){var e,i={};for(e in t)"returnValue"!=e&&"keyLocation"!=e&&(i[e]=t[e]);return i}function o(t,e,i,n){var o,i=null==i&&null==n?(o=e.x-t.x,e.y-t.y):(o=i-t,n-e);return Math.sqrt(o*o+i*i)}function n(t,e,i,n){var o=(n-e)/(i-t),s=e-t*o;function a(t){return t*o+s}return a.k=o,a.b=s,a.x1=t,a.x2=i,a.y1=e,a.y2=n,a}function _(t,e,i){var n=Math.abs(e-i),e=Math.abs(e-t),i=Math.abs(i-t);return Math.abs(n-(e+i))<1e-6}function H(t,e,i){return _(t,i.x1,i.x2)&&_(e,i.y1,i.y2)}function c(t,e){return t.k==e.k||(n=1/0==t.k||t.k==-1/0?(i=t.x1,e(t.x1)):1/0==e.k||e.k==-1/0?(i=e.x1,t(e.x1)):t(i=(e.b-t.b)/(t.k-e.k)),0==H(i,n,t))||0==H(i,n,e)?null:{x:i,y:n};var i,n}function k(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function M(t,e,i,n,o){var s=1-o;return s*s*(s*t+3*o*e)+o*o*(o*n+3*s*i)}function x(t,e,i,n){var o=1-n;return o*(o*t+2*n*e)+n*n*i}function l(t,e){return Math.random()*(e-t+1)+t}var V={getDistance:o,isFirefox:0<navigator.userAgent.indexOf("Firefox"),isIE:!(!window.attachEvent||-1!==navigator.userAgent.indexOf("Opera")),isChrome:null!=navigator.userAgent.toLowerCase().match(/chrome/),clone:function(t){var e,i={};for(e in t)i[e]=t[e];return i},isPointInLine:function(t,e,i){var n=o(e,i),e=o(e,t),i=o(i,t);return Math.abs(e+i-n)<=.5},removeFromArray:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e){t.splice(i,1);break}return t},getEventPosition:function(t){var e=null;return t.pageX?e=i(t):((e=i(t)).pageX=t.clientX+document.body.scrollLeft-document.body.clientLeft,e.pageY=t.clientY+document.body.scrollTop-document.body.clientTop),e},cloneEvent:i,getOffsetPosition:function(t){var e,i,n,o,s,a,r;return t?(r=a=0,"getBoundingClientRect"in document.documentElement?(e=t.getBoundingClientRect(),i=(n=t.ownerDocument).body,o=(n=n.documentElement).clientTop||i.clientTop||0,s=n.clientLeft||i.clientLeft||0,a=e.top+(self.pageYOffset||n&&n.scrollTop||i.scrollTop)-o,r=e.left+(self.pageXOffset||n&&n.scrollLeft||i.scrollLeft)-s):(a+=t.offsetTop||0,r+=t.offsetLeft||0,t=t.offsetParent),{left:r,top:a}):{left:0,top:0}},lineVir:n,intersection:c,intersectionLineBound:function(t,e){var i=c(t,n(e.left,e.top,e.left,e.bottom));return i=null==i&&null==(i=c(t,n(e.left,e.top,e.right,e.top)))&&null==(i=c(t,n(e.right,e.top,e.right,e.bottom)))?c(t,n(e.left,e.bottom,e.right,e.bottom)):i},pointOnCircle:function(t,e,i,n){return{x:t+i*Math.cos(n),y:e+i*Math.sin(n)}},pointInCircle:function(t,e,i,n,o){return(t-i)*(t-i)+(e-n)*(e-n)<o*o},calPointOnCircle:function(t,e,i,n){n=2*n*Math.PI;return{x:t+i*Math.cos(n),y:e-i*Math.sin(n)}},findAngle:function(t,e,i,n){n=Math.atan((n-e)/(i-t));return 0<=i-t?n:n+Math.PI},isPointOnLineSegment:function(t,e,i,n){var o=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)),s=(i.x-e.x)/o,i=(i.y-e.y)/o,a=t.x-e.x,t=t.y-e.y,e=a*s+t*i;return!(e<0||o<e)&&Math.abs(a*-i+t*s)<=n/2},containStroke:function(t,e,i,n,o,s,a){var r;return 0!==o&&(r=0,!(e+(o=o)<a&&n+o<a||a<e-o&&a<n-o||t+o<s&&i+o<s||s<t-o&&s<i-o))&&(t===i?Math.abs(s-t)<=o/2:(s=(r=(e-n)/(t-i))*s-a+(t*n-i*e)/(t-i))*s/(r*r+1)<=o/2*o/2)},containBerzierStroke:function(t,e,i,n,o,s,a,r,h,w,c){return 0!==h&&!(e+(h=h)<c&&n+h<c&&s+h<c&&r+h<c||c<e-h&&c<n-h&&c<s-h&&c<r-h||t+h<w&&i+h<w&&o+h<w&&a+h<w||w<t-h&&w<i-h&&w<o-h&&w<a-h)&&function(t,e,i,n,o,s,a,r,h){var c,l,u,d,f=.005,g=1/0,p=[],y=[],m=[];p[0]=w,p[1]=h;for(var v=0;v<1;v+=.05)y[0]=M(t,i,o,a,v),y[1]=M(e,n,s,r,v),(u=k(p,y))<g&&(c=v,g=u);for(var g=1/0,x=0;x<32&&!(f<1e-4);x++)l=c+f,y[0]=M(t,i,o,a,d=c-f),y[1]=M(e,n,s,r,d),u=k(y,p),0<=d&&u<g?(c=d,g=u):(m[0]=M(t,i,o,a,l),m[1]=M(e,n,s,r,l),d=k(m,p),l<=1&&d<g?(c=l,g=d):f*=.5);return Math.sqrt(g)}(t,e,i,n,o,s,a,r,c)<=h/2},containQuadraticStroke:function(t,e,i,n,o,s,a,v,r){return 0!==a&&!(e+(a=a)<r&&n+a<r&&s+a<r||r<e-a&&r<n-a&&r<s-a||t+a<v&&i+a<v&&o+a<v||v<t-a&&v<i-a&&v<o-a)&&function(t,e,i,n,o,s,a){var r,h=.005,c=1/0,l=0,u=[],d=[],f=[];u[0]=v,u[1]=a;for(var g=0;g<1;g+=.05)d[0]=x(t,i,o,g),d[1]=x(e,n,s,g),(l=k(u,d))<c&&(r=g,c=l);for(var c=1/0,p=0;p<32&&!(h<1e-4);p++){var y=r-h,m=r+h;d[0]=x(t,i,o,y),d[1]=x(e,n,s,y),l=k(d,u),0<=y&&l<c?(r=y,c=l):(f[0]=x(t,i,o,m),f[1]=x(e,n,s,m),y=k(f,u),m<=1&&y<c?(r=m,c=y):h*=.5)}return Math.sqrt(c)}(t,e,i,n,o,s,r)<=a/2},near:function(t,e,i,n,o){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))<=o},isInPolygon:function(t,e){for(var i,n,o=0,s=e.length,a=e[0],r=1;r<=s;r++)n=e[r%s],t[0]>Math.min(a[0],n[0])&&t[0]<=Math.max(a[0],n[0])&&t[1]<=Math.max(a[1],n[1])&&a[0]!=n[0]&&(i=(t[0]-a[0])*(n[1]-a[1])/(n[0]-a[0])+a[1],a[1]==n[1]||t[1]<=i)&&o++,a=n;return o%2!=0},findDotsAtSegment:function(t,e,i,n,o,s,a,r,h){var c=1-h,l=Math.pow(c,3),u=Math.pow(c,2),d=h*h,f=d*h,g=l*t+3*u*h*i+3*c*h*h*o+f*a,l=l*e+3*u*h*n+3*c*h*h*s+f*r,u=t+2*h*(i-t)+d*(o-2*i+t),f=e+2*h*(n-e)+d*(s-2*n+e),p=i+2*h*(o-i)+d*(a-2*o+i),d=n+2*h*(s-n)+d*(r-2*s+n),t=c*t+h*i,i=c*e+h*n,e=c*o+h*a,n=c*s+h*r,o=90-180*Math.atan2(u-p,f-d)/Math.PI;return(p<u||f<d)&&(o+=180),{x:g,y:l,m:{x:u,y:f},n:{x:p,y:d},start:{x:t,y:i},end:{x:e,y:n},alpha:o}},getSelfLoopControlPoints:function(t,e,i){return{x1:t+7*i,y1:e,x2:t,y2:e-7*i}},getPointOnBezierCurve:function(t,e,i,n,o,s,a,r,h){var c=Math.pow(1-t,3),l=3*t*Math.pow(1-t,2),u=3*Math.pow(t,2)*(1-t),t=Math.pow(t,3);return{x:c*e+l*s+u*r+t*n,y:c*i+l*a+u*h+t*o}},getQuadraticControlPoint:function(t,e,i,n,o,s){return{x:(t+i)*(s=s||.5)+(n-e)/(o||4),y:(e+n)*s+(t-i)/(o||4)}},getPointOnQuadraticCurve:function(t,e,i,n,o,s,a){return{x:Math.pow(1-t,2)*e+2*(1-t)*t*s+Math.pow(t,2)*n,y:Math.pow(1-t,2)*i+2*(1-t)*t*a+Math.pow(t,2)*o}},calculateAngle:function(t,e,i,n){var o=Math.abs(t-i),s=Math.abs(e-n),o=Math.sqrt(Math.pow(o,2)+Math.pow(s,2)),s=Math.acos(s/o),o=Math.floor(180/(Math.PI/s));return t<i&&e<n&&(o=180-o),i==t&&e<n&&(o=180),t<i&&n==e&&(o=90),i<t&&e<n&&(o=180+o),i<t&&n==e&&(o=270),o=i<t&&n<e?360-o:o},getPointsCenter:function(t){var e=0,i=0;if(0<t.length){var n,o=function(t){var e,i,n,o,s,a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return n=!(i=!0),{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){n=!0,e=t},f:function(){try{i||null==a.return||a.return()}finally{if(n)throw e}}};if(Array.isArray(t)||(a=G(t)))return a&&(t=a),o=0,{s:s=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:s};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;e+=s.x,i+=s.y}}catch(t){o.e(t)}finally{o.f()}e/=t.length,i/=t.length}return{x:e,y:i}},createWebWorker:function(t){t=new Blob([t],{type:"application/javascript"}),t=URL.createObjectURL(t);return new Worker(t)},getRandomRange:l,getRandomRangeRGBColor:function(t,e){return r=0|l(t,e),g=0|l(t,e),b=0|l(t,e),r+","+g+","+b},genrateTextSvg:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:60,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:60,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=n.isVertical,s=n.fontColor,a=n.fontFamily,n=n.fontSize,r=document.createElement("div");r.innerText=t,r.style="\n      word-wrap: break-word;\n      word-break: break-all;\n      font-family : ".concat(a||"Arial",";\n      font-size: ").concat(n||13,"px;\n      text-align: ").concat(o?"left":"center",";\n      color: ").concat(s||"#333",";\n      ").concat(o?"height":"width",": 100%;\n      position: relative;\n      ").concat(o?"right: 50%; transform: translateX(50%);":"top: 50%; transform: translateY(-50%);","\n      ").concat(o?"writing-mode: vertical-rl;":"","\n      ").concat(o?"float: right;":"","\n    ");return'data:image/svg+xml;charset=utf-8,\n      <svg xmlns="http://www.w3.org/2000/svg">\n        <foreignObject width="'.concat(e,'px" height="').concat(i,'px">\n          <body xmlns="http://www.w3.org/1999/xhtml" style="').concat("margin: 0; padding: 0;overflow: hidden;width: 100%;height: 100%;",'">\n            ').concat(r.outerHTML,"\n          </body>\n        </foreignObject>\n      </svg>")},buildMutilTextSvg:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:30,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=document.createElement("div"),s="",t=(t.forEach(function(t){s+="<div>"+t+"</div>"}),o.innerHTML=s,n.fontColor),a=n.font,r=n.backgroundColor,h=n.borderColor,n=n.borderRadius,a=(o.style="\n        width : calc(100% - 2px);\n        position: relative;\n        top: 50%; \n        transform: translateY(-50%);\n        text-align: center;\n        font : ".concat(a||"normal 13px Arial",";\n        color: ").concat(t||"#333",";\n        background-color:").concat(r||"none",";\n        border: ").concat(h?"1px solid "+h:"none",";\n        border-radius:").concat(n||2,"px;\n    "),'<svg xmlns="http://www.w3.org/2000/svg">\n            <foreignObject width="'.concat(e,'px" height="').concat(i,'px">\n                <body1 xmlns="http://www.w3.org/1999/xhtml" style="').concat("padding:0;margin: 0;overflow: hidden;width: calc(100% - 2px);height:100%;",'">\n                    ').concat(o.outerHTML,"\n                </body1>\n            </foreignObject>\n        </svg>"));return"data:image/svg+xml;charset=utf-8,".concat(a)}},O={version:"v2.2.0",buildTime:"2023-08-13 02:08:31",Group_zIndex:1,Link_zIndex:2,Node_zIndex:3,imgStore:{}};function D(t){this.name=t,this.messageMap={},this.messageCount=0,this.subscribe=function(t,e){null==this.messageMap[t]&&(this.messageMap[t]=[]),this.messageMap[t].push(e),this.messageCount++},this.unsubscribe=function(t){null!=this.messageMap[t]&&(this.messageMap[t]=null,delete this.messageMap[t],this.messageCount--)},this.publish=function(t,e,i){var n=this.messageMap[t];if(null!=n)for(var o=0;o<n.length;o++)i?function(t,e){setTimeout(function(){t(e)},10)}(n[o],e):n[o](e)}}function X(a,n){this.padding=0,this.visible=!1,this.container=null,this.canvas=null,this.viewBox=null,this.thumbnailCtx=null,this.width=n.width,this.height=n.height,this.timer=null,this.sceneChilds=0,this.initialize=function(){var t=document.createElement("div"),e=(t.className="thumbnail",t.style.cssText="\n            position: absolute;\n            width : ".concat(this.width,"px;\n            height: ").concat(this.height,"px;\n            border: 1px solid #e1d2d2;\n            background-color: transparent;\n            overflow:hidden;\n            user-select: none;\n            -webkit-user-drag: none;\n            -webkit-tap-highlight-color: rgba(0,0,0 0);"),document.createElement("canvas")),i=(e.style.cssText="width:100%;height:100%;background-color:transparent;cursor:not-allowed;pointer-events:none;",e.width=this.width*a.pixelRatio,e.height=this.height*a.pixelRatio,n.container),i=document.getElementById(i),i=(i?(i.appendChild(t),t.style.left=0,t.style.top=0):(a.canvas.parentNode.style.position="relative",a.canvas.parentNode.appendChild(t),t.style.right=0,t.style.bottom=0),t.appendChild(e),document.createElement("div"));i.style.cssText="position:absolute;top:0px;left:0px;width:".concat(this.width*a.pixelRatio,"px;height:").concat(this.height*a.pixelRatio,"px;border:1px solid ").concat(n.viewColor,";background:rgba(110,110,250,0.3);cursor:not-allowed;pointer-events:none;"),t.appendChild(i),this.container=t,this.canvas=e,this.thumbnailCtx=e.getContext("2d"),this.viewBox=i,this.addThumbEvents()},this.addThumbEvents=function(){var s=this;this.container.addEventListener("click",function(t){var e=t.offsetX,t=t.offsetY,i=a.boundCache,n=a.childs[0],e=i.left*(s.width/i.width)+e,t=i.top*(s.height/i.height)+t,o=a.width/(n.scaleX*i.width),i=(t/=a.height/(n.scaleY*i.height),(e/=o)/(s.width/a.width*n.scaleX)),o=t/(s.height/a.height*n.scaleY);n.setCenter(i,o),a.repaint()})},this.destory=function(){this.visible=!1,this.sceneChilds=0,clearInterval(this.timer),this.container&&(this.container.removeEventListener("click",function(){},!1),this.container.parentNode.removeChild(this.container),this.container=null,this.canvas=null,this.thumbnailCtx=null)},this.show=function(){var e=this;this.visible||null!=this.container||(this.initialize(),this.visible=!0,e.timer=setInterval(function(){var t=a.childs[0].childs.length;0!=t&&e.sceneChilds==t||(e.update(),e.paint()),e.sceneChilds=t},1e3))},this.update=function(){var t=a.getBound();if(null==t||t.width<0)return null;var e=a.childs[0],i=this.width*a.pixelRatio,n=this.height*a.pixelRatio,t=Math.min(i/t.width,n/t.height),o=this.thumbnailCtx;o.save(),o.clearRect(0,0,i,n),e.save(),e.centerAndZoom(t,o),e.paintNodes(o),e.restore(),o.restore()},this.paint=function(){var t,e,i,n,o;this.visible&&null!=(e=a.boundCache)&&(n=(o=(t=a.childs[0]).getOffsetTranslate()).translateX*(this.width/a.width)*t.scaleX,o=o.translateY*(this.height/a.height)*t.scaleY,i=a.width/(t.scaleX*e.width),t=a.height/(t.scaleY*e.height),n=n*i+e.left*(this.width/e.width),o=o*t+e.top*(this.height/e.height),e=Math.round(this.width*i),i=Math.round(this.height*t),n=Math.round(n),o=Math.round(o),this.viewBox.style.width="".concat(e,"px"),this.viewBox.style.height="".concat(i,"px"),this.viewBox.style.left="".concat(-n,"px"),this.viewBox.style.top="".concat(-o,"px"))}}function Y(t,i,n){var a=this,o=(a.canvasElements=new Map,a.canvasContexts=new Map,a.container=t,a.container.style.position="relative",atob(["d3d3","LmdyY","XBodm","lzLmNu"].join(""))),t=h("background",0),s=h("elements",1),e=h("mouse",2);function r(t){var t=O.util.getEventPosition(t),e=O.util.getOffsetPosition(a.canvas);return t.offsetLeft=t.pageX-e.left,t.offsetTop=t.pageY-e.top,t.x=t.offsetLeft*a.pixelRatio,t.y=t.offsetTop*a.pixelRatio,t.target=null,t}function h(t,e){var i=document.createElement("canvas");return i.setAttribute("class","graphvis-".concat(t)),i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.zIndex=e,a.canvasElements.set(t,i),a.canvasContexts.set(t,i.getContext("2d")),a.container.appendChild(i),i}function c(){var i=a.container.offsetWidth||200,n=a.container.offsetHeight||100,o=Math.round(i*a.pixelRatio),s=Math.round(n*a.pixelRatio);a.canvasElements.forEach(function(t,e){t.style.width=i+"px",t.style.height=n+"px",t.width=o,t.height=s}),a.offCanvas.width=o,a.offCanvas.height=s}function l(t){document.onselectstart=function(){return!1};t=r(t);a.dispatchEventToScenes("mouseover",t),a.dispatchEvent("mouseover",t)}function u(t){a.needRepaint=!1,document.onselectstart=function(){return!0};t=r(t);a.dispatchEventToScenes("mouseout",t),a.dispatchEvent("mouseout",t)}function d(t){a.mouseDown=!0;t=r(t);a.mouseDownX=t.x,a.mouseDownY=t.y,a.dispatchEventToScenes("mousedown",t),a.dispatchEvent("mousedown",t)}function f(t){a.mouseDown=!1,a.dragging&&(a.dragEndMouseUp=!0,setTimeout(function(){a.dragEndMouseUp=!1,a.dragging=!1,a.needRepaint=!0},200));t=r(t);a.dispatchEventToScenes("mouseup",t),a.dispatchEvent("mouseup",t),a.needRepaint=!1,a.clearSelectArea(),a.thumbnail.visible&&a.thumbnail.update()}function g(t){var e=r(t);!a.mouseDown||1!=t.buttons&&0!=t.buttons?a.staticMode||(a.dispatchEventToScenes("mousemove",e),a.dispatchEvent("mousemove",e)):(e.dx=e.x-a.mouseDownX,e.dy=e.y-a.mouseDownY,4<Math.sqrt(e.dx*e.dx+e.dy*e.dy)&&(a.dragging=!0,a.dispatchEventToScenes("mousedrag",e),a.dispatchEvent("mousedrag",e)))}function p(e){if(e.preventDefault(),a.dragEndMouseUp)return!1;clearTimeout(a.clickTimer),a.clickTimer=setTimeout(function(){var t=r(e);a.dispatchEventToScenes("click",t),a.dispatchEvent("click",t)},200)}function y(t){t.preventDefault(),clearTimeout(a.clickTimer);t=r(t);a.dispatchEventToScenes("dbclick",t),a.dispatchEvent("dbclick",t)}function m(t){a.wheelZoom&&(a.needRepaint=!0,a.wheeling=a.smoothWheelMode,0<(null==t.wheelDelta?t.detail:t.wheelDelta)?a.zoomOut(a.wheelZoom):a.zoomIn(a.wheelZoom),t.preventDefault?t.preventDefault():t.returnValue=!1,t=r(t),a.dispatchEventToScenes("mousewheel",t),setTimeout(function(){a.wheeling=!1,a.needRepaint=!0},300))}function v(t){var e;function i(t,e){var i=e.pageX-t.pageX,e=e.pageY-t.pageY;return Math.sqrt(i*i+e*e)}t.preventDefault(),!a.istouch||t.touches&&t.touches.length<2?g(b(t,"mousemove")):(t.preventDefault(),t=t.touches,e=a.touchStart,i(t[0],t[1])<i(e[0],e[1])?a.zoomIn(.85):i(t[0],t[1])>i(e[0],e[1])&&a.zoomOut(.85),a.touchStart=t,a.needRepaint=!0)}function x(t){a.istouch=!0,t.touches&&t.touches.length<2?d(b(t,"mousedown")):2<=(t=t.touches).length&&(a.touchStart=t)}function w(t){a.istouch&&(a.istouch=!1,a.touchStart=null,f(b(t,"mousedown")))}function b(t,e){var i,n,o;return!(!t.changedTouches||1!=t.changedTouches.length)&&(i=(t=t.changedTouches[0]).clientX,n=t.clientY,o=t.screenX,t=t.screenY,new MouseEvent(e,{clientX:i,clientY:n,screenX:o,screenY:t,button:0,buttons:0}))}function k(t){a.resize()}a.offCanvas=document.createElement("canvas"),a.canvas=e,a.backgrounGraphics=t.getContext("2d"),a.viewGraphics=s.getContext("2d"),a.graphics=a.offCanvas.getContext("2d"),a.mouseGraphics=e.getContext("2d"),a.pixelRatio=function(){var t,e=s.getContext("2d");if(void 0!==e)return t=1,(t="undefined"!=typeof window?window.devicePixelRatio||1:t)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}(),c(),S(a.backgrounGraphics,a.canvas.width,a.canvas.height),n||setTimeout(function(){var t,e=atob("Z3JhcGh2aXMtbG9n");document.getElementById(e)||((t=document.createElement("script")).id=e,t.src=atob("aHR0cHM6Ly9obS5iYWlkdS5jb20vaG0uanM/NjNlMTQzY2FkNmU0MGRmMDEwMWNiZmMyZjJkMTc1ZmU="),document.body.appendChild(t),t.onload=function(){},t.onerror=function(t){})},500);var C=!(e.oncontextmenu=function(t){if(2==t.button)return t.preventDefault(),!1});function M(t){C||(C=!0,a.dispatchEventToScenes("keydown",O.util.cloneEvent(t),!1))}function E(t){a.dispatchEventToScenes("keyup",O.util.cloneEvent(t),!1),C=!1}function L(t){t.removeEventListener("mouseout",u),t.removeEventListener("mouseover",l),t.removeEventListener("mousedown",d),t.removeEventListener("mouseup",f),t.removeEventListener("mousemove",g),t.removeEventListener("click",p),t.removeEventListener("dblclick",y),t.removeEventListener("touchstart",x),t.removeEventListener("touchmove",v),t.removeEventListener("touchend",w),window.removeEventListener("resize",k),window.removeEventListener("keydown",M),window.removeEventListener("keyup",E)}function T(t,e,i,n,o){t.clearRect(0,0,n,o);var s=t.globalAlpha;t.save(),t.globalAlpha=Number(i)||1,e.width<n||e.height<o?(i=t.createPattern(e,"repeat"),t.fillStyle=i,t.fillRect(0,0,n,o)):t.drawImage(e,0,0,n,o),t.globalAlpha=s,t.restore(),S(t,n,o)}function S(t,e,i){n||(t.save(),t.textAlign="center",t.textBaseline="middle",t.font="italic 20px Arial",t.fillStyle="rgba(80,80,80,0.5)",t.fillText(o,e-100,i-24),t.restore())}this.initialize=function(t){var e;this.childs=[],this.fps=-50,this.eventBus=new D,this.wheelZoom=.9,this.mouseDownX=0,this.mouseDownY=0,this.mouseDown=!1,this.needRepaint=!1,this.istouch=!1,this.touchStart=null,this.wheeling=!1,this.dragging=!1,this.dragEndMouseUp=!1,this.clickTimer=null,this.openDragHideEffect=!1,this.smoothWheelMode=!0,this.staticMode=!1,this.requestAnimateId=null,this.loadingAnimateId=null,this.boundCache=null,this.showDetailScale=.2,this.selectBoxColor="10,10,225",this.selectBoxAlpha=.1,this.thumbnail=new X(this,i||{}),L(e=t),O.util.isIE||!window.addEventListener?(e.onmouseout=u,e.onmouseover=l,e.onmousedown=d,e.onmouseup=f,e.onmousemove=g,e.onclick=p,e.ondblclick=y,e.onmousewheel=m,e.touchstart=x,e.touchmove=v,e.touchend=w):(e.addEventListener("mouseout",u),e.addEventListener("mouseover",l),e.addEventListener("mousedown",d),e.addEventListener("mouseup",f),e.addEventListener("mousemove",g),e.addEventListener("click",p),e.addEventListener("dblclick",y),e.addEventListener("touchstart",x),e.addEventListener("touchmove",v),e.addEventListener("touchend",w),O.util.isFirefox?e.addEventListener("DOMMouseScroll",m):e.addEventListener("mousewheel",m),window.addEventListener("resize",k),window.addEventListener("keydown",M),window.addEventListener("keyup",E)),this.resize=function(){var t=this.container.offsetWidth,e=this.container.offsetHeight;if(0==t||0==e)return!1;c(),this.paint(),this.repaintBackGround(this.backgrounGraphics,this.width,this.height)},this.dispatchEventToScenes=function(i,n){this.needRepaint=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],this.childs.forEach(function(t){if(1==t.visible){var e=t[i+"Handler"];if(null==e)return null;e.call(t,n)}})},this.add=function(t){for(var e=0;e<this.childs.length;e++)if(this.childs[e]===t)return;t.addTo(this),this.childs.push(t)},this.remove=function(t){if(null==t)return null;for(var e=0;e<this.childs.length;e++)if(this.childs[e]===t){t.stage=null,this.childs.splice(e,1);break}return this},this.clear=function(){this.childs=[]},this.addEventListener=function(t,e){var i=this;return this.eventBus.subscribe(t,function(t){e.call(i,t)}),this},this.removeEventListener=function(t){this.eventBus.unsubscribe(t)},this.removeAllEventListener=function(){this.eventBus=new D,L(t)},this.dispatchEvent=function(t,e){return this.eventBus.publish(t,e),this},this.paint=function(){0<this.childs.length&&(this.graphics.save(),this.graphics.clearRect(0,0,this.width,this.height),this.childs.forEach(function(t){t.visible&&t.repaint(a.graphics)}),this.graphics.restore(),a.viewGraphics.clearRect(0,0,this.width,this.height),a.viewGraphics.drawImage(a.offCanvas,0,0),a.thumbnail.visible)&&a.thumbnail.paint()},this.repaint=function(){0<this.fps?this.paint():this.fps<0?this.needRepaint&&(this.needRepaint=!1,this.paint()):this.needRepaint=!1},this.repaintBackGround=function(t,e,i){t.clearRect(0,0,e,i),t.save(),this.backGroundColor&&(t.fillStyle=this.backGroundColor,t.fillRect(0,0,e,i)),S(t,e,i),null!=this.backGroundImage&&T(t,this.backGroundImage,this.backGroundOpaticy,e,i),t.restore()},this.getPagePosition=function(t,e){var i,n,o;return this.childs&&0!=this.childs.length?(n=(i=this.childs&&this.childs[0]).getOffsetTranslate(),o=O.util.getOffsetPosition(this.canvas),t=(t+n.translateX)*i.scale/this.pixelRatio,e=(e+n.translateY)*i.scale/this.pixelRatio,{pageX:t+o.left,pageY:e+o.top}):{pageX:0,pageY:0}},this.getImageUrlData=function(t){var e=this.getBound();if(null==e||e.width<0)return null;var i=t.width||8e3,n=t.height||8e3,o=t.type,s=e.width,a=e.height,r=0,h=0,e=("node"==e.leftNode.elementType&&"node"==e.rightNode.elementType&&(r=e.leftNode.radius*e.leftNode.scale+e.rightNode.radius*e.rightNode.scale,h=e.topNode.radius*e.topNode.scale+e.bottomNode.radius*e.bottomNode.scale),s+=r+50,a+=h+50,document.createElement("canvas")),r=Math.min(i||8e3,s),h=Math.min(n||8e3,a),i=(e.width=r,e.height=h,Math.min(r/s,h/a)),n=(Math.max(s,a)<500&&(e.width=Math.max(Math.max(s,a),500),e.height=Math.max(Math.max(s,a),500),i=1),e.getContext("2d")),r=(this.repaintBackGround(n,e.width,e.height),t.textWatermark&&(n.save(),this.paintTextWatermark(n,e.width,e.height,{content:t.textWatermark.content||"GraphVis可视化",angle:t.textWatermark.angle||-30,alpha:t.textWatermark.alpha||.1,fontStyle:t.textWatermark.fontStyle||"normal",fontSize:t.textWatermark.fontSize||40,fontFamliy:t.textWatermark.fontFamliy||"Arial",fontColor:t.textWatermark.fontColor||"#666"}),n.restore()),this.childs[0]),h=(r.save(),r.centerAndZoom(i,n),r.repaint(n,!0),r.restore(),null);try{h=e.toDataURL("image/"+(o||"png"),1)}catch(t){}return h},this.paintTextWatermark=function(t,e,i,n){var o=n.content,s=n.alpha,a=n.angle,r=n.fontSize,h=n.fontStyle,c=n.fontFamliy,n=n.fontColor,h=(t.font="".concat(h," ").concat(r,"px ").concat(c),Math.ceil(t.measureText(o).width));t.fillStyle=n||"#666",t.textBaseline="middle",t.textAlign="center",t.globalAlpha=s||.1;for(var l=Math.round(.6*h),u=h+Math.round(e/50),d=Math.ceil(i/l)+5,f=Math.ceil(e/u)+5,g=0;g<d;g++)for(var p=0;p<f;p++)t.save(),t.translate(p*u,g*l),t.rotate(a*Math.PI/180),t.fillText(o,0,0),t.restore();t.globalAlpha=1},this.saveAsLocalImage=function(){var t,e,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=i.type||"png",o=this.getImageUrlData(i);null!=o&&(o=o.replace(function(t){t=(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/);return"image"+(t=t&&t[0])}(n),"image/octet-stream"),t=document.createElement("a"),e=new MouseEvent("click"),t.download=(i.fileName||"Graph_"+(new Date).getTime())+"."+n,t.href=o,t.dispatchEvent(e))},this.getSnapshotImage=function(){var t=null;try{t=this.canvasElements.get("elements").toDataURL("image/png",1)}catch(t){}return t},this.paintSelectRect=function(t,e,i,n){this.clearSelectArea(),this.mouseGraphics.save(),this.mouseGraphics.beginPath(),this.mouseGraphics.rect(t*this.pixelRatio,e*this.pixelRatio,i,n),this.mouseGraphics.strokeStyle="rgba(".concat(this.selectBoxColor,",0.8)"),this.mouseGraphics.fillStyle="rgba(".concat(this.selectBoxColor,",").concat(this.selectBoxAlpha,")"),this.mouseGraphics.fill(),this.mouseGraphics.stroke(),this.mouseGraphics.restore()},this.paintSelectCircle=function(t,e,i,n){this.clearSelectArea();i=Math.round(Math.sqrt(i*i+n*n,2));this.mouseGraphics.save(),this.mouseGraphics.beginPath(),this.mouseGraphics.arc(t*this.pixelRatio,e*this.pixelRatio,i,0,2*Math.PI),this.mouseGraphics.strokeStyle="rgba(".concat(this.selectBoxColor,",0.8)"),this.mouseGraphics.fillStyle="rgba(".concat(this.selectBoxColor,",").concat(this.selectBoxAlpha,")"),this.mouseGraphics.fill(),this.mouseGraphics.stroke(),this.mouseGraphics.restore()},this.paintSelectPolygon=function(t,e,i){this.clearSelectArea(),this.mouseGraphics.save(),this.mouseGraphics.beginPath(),this.mouseGraphics.moveTo(t*this.pixelRatio,e*this.pixelRatio);for(var n=1;n<i.length;n++)this.mouseGraphics.lineTo(i[n][0]*this.pixelRatio,i[n][1]*this.pixelRatio);this.mouseGraphics.closePath(),this.mouseGraphics.strokeStyle="rgba(".concat(this.selectBoxColor,",0.8)"),this.mouseGraphics.fillStyle="rgba(".concat(this.selectBoxColor,",").concat(this.selectBoxAlpha,")"),this.mouseGraphics.fill(),this.mouseGraphics.stroke(),this.mouseGraphics.restore()},this.clearSelectArea=function(){this.mouseGraphics.clearRect(0,0,this.width,this.height)},this.showLoading=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"loading",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.2,i=(this.clearSelectArea(),this.mouseGraphics),n=Math.PI,o=n/2,n=2*n;i.save(),i.translate(this.width/2,this.height/2),i.fillStyle="rgba(240,240,240,1)",i.strokeStyle="rgba(200,200,200,0.8)",i.lineWidth=10,i.beginPath(),i.arc(0,0,80,0,2*Math.PI,!1),i.fill(),i.stroke(),i.closePath(),i.strokeStyle="rgba(120,120,240,0.9)",i.lineWidth=10,i.lineCap="round",i.beginPath(),i.arc(0,0,80,-o,n*e-o,!1),i.stroke(),i.closePath(),i.font="normal 16px KaiTi",i.textAlign="center",i.textBaseline="middle",i.fillStyle="rgba(50,50,50,1)",i.fillText(t,0,0),i.restore()},this.hideLoading=function(){this.clearSelectArea()},this.zoom=function(e){this.childs.forEach(function(t){t.visible&&t.zoom(e)})},this.zoomOut=function(e,t){this.childs.forEach(function(t){t.visible&&t.zoomOut(e)})},this.zoomIn=function(e,t){this.childs.forEach(function(t){t.visible&&t.zoomIn(e)})},this.centerAndZoom=function(){this.childs.forEach(function(t){t.visible&&t.centerAndZoom()})},this.setCenter=function(n,o){var s=this.canvas;this.childs.forEach(function(t){var e=n-s.width/2,i=o-s.height/2;t.translateX=-e,t.translateY=-i})},this.getBound=function(){var e={left:1/0,right:-1/0,top:1/0,bottom:-1/0};return 0==this.childs.length||0==this.childs[0].childs?null:(this.childs.forEach(function(t){t=t.getElementsBound();t.left<e.left&&(e.left=t.left,e.leftNode=t.leftNode),t.top<e.top&&(e.top=t.top,e.topNode=t.topNode),t.right>e.right&&(e.right=t.right,e.rightNode=t.rightNode),t.bottom>e.bottom&&(e.bottom=t.bottom,e.bottomNode=t.bottomNode)}),e.width=e.right-e.left,e.height=e.bottom-e.top,this.boundCache=e)},this.setBackGroundColor=function(t){this.backgrounGraphics.clearRect(0,0,this.width,this.height),this.backgrounGraphics.fillStyle=t||"#fff",this.backgrounGraphics.fillRect(0,0,this.width,this.height),this.backGroundColor=t,S(this.backgrounGraphics,this.width,this.height)},this.setBackGroundImage=function(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=this.backgrounGraphics,o=(this.backGroundOpaticy=i,this);"string"==typeof t?((e=new Image).setAttribute("crossOrigin","Anonymous"),e.src=t,e.onload=function(){o.backGroundImage=e,T(n,e,i,o.width,o.height)}):(o.backGroundImage=t,T(n,t,i,this.width,this.height))}},this.initialize(a.canvas),["click","dbclick","mousedown","mouseup","mouseover","mouseout","mousemove","mousedrag","mousewheel","keydown","keyup"].forEach(function(e){a[e]=function(t){null!=t?this.addEventListener(e,t):this.dispatchEvent(e)}});P=0;var P,B="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:function(t){var e=Date.now(),i=Math.min(16,Math.max(0,16-(e-P))),n=P=e+i;return setTimeout(function(){return t(n)},i)},A="undefined"!=typeof cancelAnimationFrame?cancelAnimationFrame:function(t){return clearTimeout(t)};!function t(){var e,i;(e=a.requestAnimateId)&&A(e),a.repaint(),a.requestAnimateId=(i=t,B(function(t){i.call(void 0,t)}))}()}function j(){this.initialize=function(){this.elementType="element",this.serializedProperties=["elementType"],this.propertiesStack=[]},this.removeHandler=function(){},this.save=function(){var e=this,i={};this.serializedProperties.forEach(function(t){i[t]=e[t]}),this.propertiesStack.push(i)},this.restore=function(){var e,i=this;null!=this.propertiesStack&&0!=this.propertiesStack.length&&(e=this.propertiesStack.pop(),this.serializedProperties.forEach(function(t){i[t]=e[t]}))}}function u(h){var i=this,t=(this.initialize=function(){u.prototype.initialize.apply(this,arguments),this.sceneMode={normal:"normal",drag:"drag",select:"select"},this.eventBus=new D,this.elementType="scene",this.childs=[],this.zIndexMap={},this.zIndexArray=[],this.visible=!0,this.scale=1,this.scaleRange=[.01,10],this.pickMode="node-first",this.mode=this.sceneMode.normal,this.translate=!0,this.translateX=0,this.translateY=0,this.lastTranslateX=0,this.lastTranslateY=0,this.mouseDown=!1,this.mouseDownX=null,this.mouseDownY=null,this.mouseDownEvent=null,this.dragable=!0,this.dragging=!1,this.areaSelect=!1,this.selectBoxType="rect",this.operations=[],this.selectedElements=[],this.polygonPoints=null,this.polygonCoords=null,this.dragMouseIndex=0,this.displayElements={nodes:[],links:[],groups:[]},this.serializedProperties=["translateX","translateY","lastTranslatedX","lastTranslatedY","scale"],this.setBackground=function(t){this.background=t},this.addTo=function(t){this.stage!==t&&null!=t&&(this.stage=t)}},this.initialize(),null!=h&&(h.add(this),this.addTo(h)),this.show=function(){this.visible=!0},this.hide=function(){this.visible=!1},this.paint=function(t,e){var i;t.save(),t.scale(this.scale,this.scale),1==this.translate&&(i=this.getOffsetTranslate(t),t.translate(i.translateX,i.translateY)),e?this.paintAllChilds(t):this.paintChilds(t),t.restore(),t.save(),this.paintOperations(t,this.operations),t.restore()},this.repaint=function(t,e){this.visible&&this.paint(t,e)},this.getDisplayedElements=function(){this.displayElements={nodes:[],edges:[],groups:[]};var t=!!(h.wheeling||this.scale<=this.scaleRange[0]);h.openDragHideEffect&&(t=h.dragging||t),this.displayElements.groups=this.zIndexMap[O.Group_zIndex];for(var e,i,n=this.zIndexMap[O.Node_zIndex]||[],o=n.length,s=this.getOffsetTranslate(),a=[],r=0;r<o;r++)e=n[r],this.nodeInView(e,s)&&a.push(e);return this.displayElements.nodes=a,t||(i=new Set,a.forEach(function(t){(t.outLinks||[]).forEach(function(t){t.visible&&i.add(t)}),(t.inLinks||[]).forEach(function(t){t.visible&&i.add(t)})}),this.displayElements.edges=Array.from(i)),this.displayElements},this.paintChilds=function(e){var i=this,t=i.getDisplayedElements(),n=this.scale<=this.scaleRange[0],o=[],s=[];(t.groups||[]).forEach(function(t){i.paintElement(e,t)}),(t.edges||[]).forEach(function(t){t.isMouseOver||t.selected?s.push(t):i.paintElement(e,t,n)}),s.forEach(function(t){i.paintElement(e,t,n)}),(t.nodes||[]).forEach(function(t){t.isMouseOver||t.selected?o.push(t):i.paintElement(e,t,n)}),o.forEach(function(t){i.paintElement(e,t,n)})},this.paintElement=function(t,e,i){var n;e.visible&&(t.save(),e.transformAble&&(n=e.getCenterLocation(),t.translate(n.x,n.y),0!=e.rotate&&t.rotate(e.rotate*Math.PI/180),0<e.scale)&&t.scale(e.scale,e.scale),e.isMouseOver&&!i&&e.paintMouseover(t),e.selected||e.showSelected||e.isMouseOver||this.scale>=this.stage.showDetailScale&&1<=e.alpha?e.hideText=!1:e.hideText=!0,e.paint(t,i),t.restore())},this.paintAllChilds=function(t){for(var e=0;e<this.zIndexArray.length;e++)for(var i=this.zIndexArray[e],n=this.zIndexMap[i],o=0;o<n.length;o++){var s,a=n[o];1==a.visible&&(t.save(),a.transformAble&&(s=a.getCenterLocation(),t.translate(s.x,s.y),t.rotate(a.rotate*Math.PI/180),t.scale(a.scale,a.scale)),a.isMouseOver&&a.paintMouseover(t),a.hideText=!1,a.paint(t,!1),t.restore())}},this.paintNodes=function(e){var t,i=this.zIndexMap[O.Node_zIndex]||[];if(0==i.length)return!1;e.save(),e.scale(this.scale,this.scale),1==this.translate&&(t=this.getOffsetTranslate(e),e.translate(t.translateX,t.translateY));var n;i.forEach(function(t){n=t.getCenterLocation(),e.save(),e.translate(n.x,n.y),e.rotate(t.rotate*Math.PI/180),e.scale(t.scale,t.scale),t.paint(e,!0),e.restore()}),e.restore()},this.getOffsetTranslate=function(t){var e=this.stage.width,i=this.stage.height,t=(null!=t&&(e=t.canvas.width,i=t.canvas.height),e/this.scale/2),e=i/this.scale/2;return{translateX:this.translateX+(t-t*this.scale),translateY:this.translateY+(e-e*this.scale)}},this.nodeInView=function(t,e){var i;return!(null==t||!t.visible||(i=(t.x+e.translateX)*this.scale)>this.stage.width||(e=(t.y+e.translateY)*this.scale)>this.stage.height||i+t.width*this.scale<0||e+t.height*this.scale<0)},this.isVisiable=function(t,e){return!(null==t||!t.visible)&&("link"==t.elementType?!(!t.source.visible||!t.target.visible):this.nodeInView(t,e))},this.paintOperations=function(t,e){for(var i=0;i<e.length;i++)e[i](t)},this.addOperation=function(t){return this.operations.push(t),this},this.clearOperations=function(){return this.operations=[],this},this.getElementByXY=function(t,e){var i,n=null,o=["nodes","edges","groups"];"node-first"!=this.pickMode&&(o=["edges","nodes","groups"]);for(var s=0;s<o.length;s++)for(var a=(i=this.displayElements[o[s]]||[]).length-1;0<=a;a--){if((n=i[a]).visible&&n.mouseInteractive&&n.isInBound(t,e))return n;n=null}return n},this.add=function(t){this.childs.push(t),null==this.zIndexMap[t.zIndex]&&(this.zIndexMap[t.zIndex]=[],this.zIndexArray.push(t.zIndex),this.zIndexArray.sort(function(t,e){return t-e})),this.zIndexMap[""+t.zIndex].push(t)},this.remove=function(t){this.childs=O.util.removeFromArray(this.childs,t);var e=this.zIndexMap[t.zIndex];e&&(this.zIndexMap[t.zIndex]=O.util.removeFromArray(e,t),t.removeHandler(this))},this.clear=function(){this.childs=[],this.operations=[],this.zIndexArray=[],this.zIndexMap={}},this.addToSelected=function(t){-1==this.selectedElements.indexOf(t)&&this.selectedElements.push(t)},this.cancleAllSelected=function(){for(var t=0;t<this.selectedElements.length;t++)this.selectedElements[t].unselectedHandler();this.selectedElements=[]},this.notInSelectedNodes=function(t){for(var e=0;e<this.selectedElements.length;e++)if(t===this.selectedElements[e])return!1;return!0},this.removeFromSelected=function(t){for(var e=0;e<this.selectedElements.length;e++)if(t===this.selectedElements[e]){this.selectedElements.splice(e,1);break}},this.toSceneEvent=function(t){var e,t=O.util.clone(t);return t.x/=this.scale,t.y/=this.scale,1==this.translate&&(e=this.getOffsetTranslate(),t.x-=e.translateX,t.y-=e.translateY),null!=t.dx&&(t.dx/=this.scale,t.dy/=this.scale),null!=this.currentElement&&(t.target=this.currentElement),t.scene=this,t},this.selectElement=function(t){var e=this.getElementByXY(t.x,t.y);if(null!=e)if((t.target=e).mousedownHander(t),e.selectedHandler(t),this.notInSelectedNodes(e))t.ctrlKey||this.cancleAllSelected(),this.addToSelected(e);else{t.ctrlKey&&(e.unselectedHandler(),this.removeFromSelected(e));for(var i=0;i<this.selectedElements.length;i++)this.selectedElements[i].selectedHandler(t)}else t.ctrlKey||this.cancleAllSelected();this.currentElement=e},this.mousedownHandler=function(t){t=this.toSceneEvent(t);if(this.mouseDownX=t.x,this.mouseDownY=t.y,this.mouseDownEvent=t,this.mouseDown=this.mode==this.sceneMode.normal)this.selectElement(t),null!=this.currentElement&&"link"!=this.currentElement.elementType||1!=this.translate||(this.lastTranslateX=this.translateX,this.lastTranslateY=this.translateY);else{if(this.mode==this.sceneMode.drag&&1==this.translate)return this.lastTranslateX=this.translateX,this.lastTranslateY=this.translateY;this.mode==this.sceneMode.select&&this.selectElement(t)}i.dispatchEvent("mousedown",t)},this.mouseupHandler=function(t){i.clearOperations();var e=this.toSceneEvent(t);null!=this.currentElement&&(e.target=i.currentElement,this.currentElement.mouseupHandler(e)),this.dispatchEvent("mouseup",e),this.mouseDown=!1,this.dragging&&(this.dragging=!1),this.areaSelect&&(this.areaSelect=!1,this.boxSelectEndHandle(t))},this.dragElements=function(t){if(null!=this.currentElement&&this.currentElement.dragable)for(var e=O.util.clone(t),i=0;i<this.selectedElements.length;i++){var n=this.selectedElements[i];n.dragable&&(e.target=n).mousedragHandler(e)}},this.mousedragHandler=function(t){t=this.toSceneEvent(t);this.mode==this.sceneMode.normal?null==this.currentElement||"link"==this.currentElement.elementType?this.dragable&&this.translate&&(this.translateX=this.lastTranslateX+t.dx,this.translateY=this.lastTranslateY+t.dy):this.dragable&&this.dragElements(t):this.mode==this.sceneMode.drag?this.dragable&&this.translate&&(this.translateX=this.lastTranslateX+t.dx,this.translateY=this.lastTranslateY+t.dy):this.mode==this.sceneMode.select&&(null!=this.currentElement?this.currentElement.dragable&&this.dragElements(t):(this.stage.needRepaint=!1,this.areaSelect=!0,"lasso"==this.selectBoxType?this.selectPolygonHandle(t):"circle"==this.selectBoxType?this.selectCircleHandle(t):this.selectRectHandle(t))),this.dragging=!0,this.dispatchEvent("mousedrag",t)},this.boxSelectEndHandle=function(t){for(var e,i,n,o,s=null,a=["nodes"],r=[],h=0;h<a.length;h++)for(var c=this.displayElements[a[h]]||[],l=c.length,u=0;u<l;u++)s=c[u],2<this.polygonCoords.length?O.util.isInPolygon([s.cx,s.cy],this.polygonCoords)&&(s.selectedHandler(t),this.addToSelected(s),r.push(s)):(o=this.polygonCoords[1][0],e=this.polygonCoords[1][1],i=this.polygonCoords[0][0],n=this.polygonCoords[0][1],o=Math.round(Math.sqrt(o*o+e*e,2)),O.util.pointInCircle(s.cx,s.cy,i,n,o)&&(s.selectedHandler(t),this.addToSelected(s),r.push(s)));this.boxSelectedNodes=r,this.polygonPoints=null,this.polygonCoords=null,this.dragMouseIndex=0,this.stage.repaint()},this.selectPolygonHandle=function(t){var e=t.offsetLeft,i=t.offsetTop;this.dragMouseIndex++,null==this.polygonPoints?(this.polygonPoints=[[e,i]],this.polygonCoords=[[t.x,t.y]]):this.dragMouseIndex%5==0&&(this.polygonPoints.push([e,i]),this.polygonCoords.push([t.x,t.y])),this.stage.paintSelectPolygon(e,i,this.polygonPoints)},this.selectRectHandle=function(t){var e=t.offsetLeft,i=t.offsetTop,n=this.mouseDownEvent.offsetLeft,o=this.mouseDownEvent.offsetTop,n=n<=e?n:e,e=o<=i?o:i,o=Math.abs(t.dx)*this.scale,i=Math.abs(t.dy)*this.scale,o=(this.stage.paintSelectRect(n,e,o,i),n=(t.x>=this.mouseDownEvent.x?this.mouseDownEvent:t).x,e=(t.y>=this.mouseDownEvent.y?this.mouseDownEvent:t).y,n+Math.abs(t.dx)),i=e+Math.abs(t.dy);this.polygonCoords=[[n,e],[o,e],[o,i],[n,i]]},this.selectCircleHandle=function(t){var e=t.offsetLeft,i=t.offsetTop,n=this.mouseDownEvent.offsetLeft,o=this.mouseDownEvent.offsetTop,n=n<=e?n:e,e=o<=i?o:i,o=Math.abs(t.dx)*this.scale,i=Math.abs(t.dy)*this.scale;this.stage.paintSelectCircle(n,e,o,i),n=(t.x>=this.mouseDownEvent.x?this.mouseDownEvent:t).x,e=(t.y>=this.mouseDownEvent.y?this.mouseDownEvent:t).y,this.polygonCoords=[[n,e],[o,i]]},this.mousemoveHandler=function(t){var t=i.toSceneEvent(t),e=i.getElementByXY(t.x,t.y);null!=e?(i.mouseOverelement&&i.mouseOverelement!==e&&(t.target=e,i.mouseOverelement.mouseoutHandler(t)),(i.mouseOverelement=e).isMouseOver?t.target=e:((t.target=e).mouseoverHandler(t),i.dispatchEvent("mouseover",t))):i.mouseOverelement?(t.target=e,i.mouseOverelement.mouseoutHandler(t),i.mouseOverelement=null,i.dispatchEvent("mouseout",t)):(t.target=null,i.dispatchEvent("mousemove",t))},this.mouseoverHandler=function(t){t=this.toSceneEvent(t);this.dispatchEvent("mouseover",t)},this.mouseoutHandler=function(t){t=this.toSceneEvent(t);this.dispatchEvent("mouseout",t)},this.mousewheelHandler=function(t){this.dispatchEvent("mousewheel")},this.clickHandler=function(t){t=this.toSceneEvent(t);this.currentElement&&(t.target=this.currentElement,this.currentElement.clickHandler(t)),this.dispatchEvent("click",t)},this.dbclickHandler=function(t){t=this.toSceneEvent(t);this.currentElement?(t.target=this.currentElement,this.currentElement.dbclickHandler(t)):this.cancleAllSelected(),this.dispatchEvent("dbclick",t)},this.keydownHandler=function(t){this.dispatchEvent("keydown",t)},this.keyupHandler=function(t){this.dispatchEvent("keyup",t)},this.addEventListener=function(t,e){var i=this;return this.eventBus.subscribe(t,function(t){e.call(i,t)}),this},this.removeEventListener=function(t){this.eventBus.unsubscribe(t)},this.removeAllEventListener=function(){this.eventBus=new D},this.dispatchEvent=function(t,e){return this.eventBus.publish(t,e),this},"click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,mousewheel,keydown,keyup".split(",")),i=this;return t.forEach(function(e){i[e]=function(t){null!=t?this.addEventListener(e,t):this.dispatchEvent(e)}}),this.zoom=function(t){null!=t&&0!=t&&(this.scale=t)},this.zoomOut=function(t){this.scale<=this.scaleRange[1]&&0!=t&&(this.scale/=t=null==t?.8:t)},this.zoomIn=function(t){this.scale>=this.scaleRange[0]&&0!=t&&(this.scale*=t=null==t?.8:t)},this.getBound=function(){return{left:0,top:0,right:this.stage.width,bottom:this.stage.height,width:this.stage.width,height:this.stage.height}},this.getElementsBound=function(){return 0==this.childs.length?null:this.getBoundWithElemets()},this.getBoundWithElemets=function(){for(var t,e,i={left:Number.MAX_VALUE,right:-Number.MAX_VALUE,top:Number.MAX_VALUE,bottom:-Number.MAX_VALUE,width:0,height:0},n=this.zIndexMap[O.Node_zIndex]||[],o=n.length,s=0;s<o;s++)t=n[s],i.left>t.x&&(i.left=t.x,i.leftNode=t),e=t.x+t.width,i.right<e&&(i.right=e,i.rightNode=t),i.top>t.y&&(i.top=t.y,i.topNode=t),e=t.y+t.height,i.bottom<e&&(i.bottom=e,i.bottomNode=t);return i.leftNode&&i.leftNode.parentContainer&&(i.left=i.left-i.leftNode.parentContainer.padding),i.rightNode&&i.rightNode.parentContainer&&(i.right=i.right+i.rightNode.parentContainer.padding),i.bottomNode&&i.bottomNode.parentContainer&&(i.bottom=i.bottom+i.bottomNode.parentContainer.padding),i.topNode&&i.topNode.parentContainer&&(i.top=i.top-i.topNode.parentContainer.padding-i.topNode.parentContainer.headerHeight),i.width=Math.round(i.right-i.left),i.height=Math.round(i.bottom-i.top),i},this.translateToCenter=function(t){var e,i,n=this.getElementsBound();null!=n&&(i=e=0,i=t?(e=t.canvas.width/2-(n.left+n.right)/2,t.canvas.height/2-(n.top+n.bottom)/2):(e=this.stage.width/2-(n.left+n.right)/2,this.stage.height/2-(n.top+n.bottom)/2),this.translateX=e,this.translateY=i)},this.setCenter=function(t,e){t-=this.stage.width/2,e-=this.stage.height/2;this.translateX=-t,this.translateY=-e},this.centerAndZoom=function(t,e){var i,n,o,s;this.translateToCenter(e),null==t?null!=(n=this.getElementsBound())&&(i=n.width,n=n.height,s=o=1,s=e?(o=e.canvas.width/i,e.canvas.height/n):(o=this.stage.width/i,this.stage.height/n),e=Math.min(o,s),this.zoom(e=1<e?1:e)):this.zoom(t)},this.getCenterLocation=function(){return{x:this.stage.width/2,y:this.stage.height/2}},i}function t(){this.initialize=function(){t.prototype.initialize.apply(this,arguments),this.elementType="displayElement",this.id=null,this.x=0,this.y=0,this.width=40,this.height=40,this.radius=20,this.size=40,this.visible=!0,this.alpha=1,this.rotate=0,this.scale=1,this.color=null,this.strokeColor="22,255,22",this.borderColor="22,255,22",this.fillColor="22,255,22",this.showShadow=!1,this.shadowBlur=20,this.shadowColor="rgba(20,200,20,0.5)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.transformAble=!1,this.animate=!1,this.zIndex=0,this.properties={}},this.initialize(),this.paint=function(t){t.beginPath(),t.rect(-this.width/2,-this.height/2,this.width,this.height),this.fillColor&&(t.fillStyle="rgba(".concat(this.fillColor,",").concat(this.alpha,")"),t.fill()),t.strokeStyle="rgba(".concat(this.strokeColor,",").concat(this.alpha,")"),t.stroke(),t.closePath()},this.getLocation=function(){return{x:this.x,y:this.y}},this.setLocation=function(t,e){return this.x=t,this.y=e,this},this.getCenterLocation=function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},this.setCenterLocation=function(t,e){return this.x=t-this.width/2,this.y=e-this.height/2,this},this.getSize=function(){return{width:this.width,height:this.heith}},this.setSize=function(t,e){return this.width=Number(t)||40,this.height=Number(e)||40,this.raduis=Math.round(this.width/2),this},this.getBound=function(){return{left:this.x-this.borderWidth,top:this.y-this.borderWidth,right:this.x+this.width+this.borderWidth,bottom:this.y+this.height+this.borderWidth,width:this.width,height:this.height}},this.setBound=function(t,e,i,n){return this.setLocation(t,e),this.setSize(i,n),this},this.getPosition=function(t){var e,i=this.getBound();switch(t){case"Top_Left":e={x:i.left,y:i.top};break;case"Top_Center":e={x:this.cx,y:i.top};break;case"Top_Right":e={x:i.right,y:i.top};break;case"Middle_Left":e={x:i.left,y:this.cy};break;case"Middle_Center":e={x:this.cx,y:this.cy};break;case"Middle_Right":e={x:i.right,y:this.cy};break;case"Bottom_Left":e={x:i.left,y:i.bottom};break;case"Bottom_Center":e={x:this.cx,y:i.bottom};break;case"Bottom_Right":e={x:i.right,y:i.bottom};break;default:e={x:this.cx,y:this.cy}}return e}}function e(){this.initialize=function(){e.prototype.initialize.apply(this,arguments),this.elementType="interactiveElement",this.dragable=!1,this.selected=!1,this.showSelected=!1,this.isMouseOver=!1,this.selectedLocation=null,this.showBackGround=!1,this.animate=!1,this.visible=!0,this.mouseInteractive=!0},this.initialize(),this.paintMouseover=function(t){this.showSelected=!0},this.isInBound=function(t,e){var i,n,o,s,a,r;return"rect"==this.shape?(i=this.width*this.scale,n=this.height*this.scale,0==this.rotate?t>this.cx-i/2&&t<this.cx+i/2&&e>this.cy-n/2&&e<this.cy+n/2:(r=this.cx,o=this.cy,s=-this.rotate*Math.PI/180,a=(t-r)*Math.cos(s)-(e-o)*Math.sin(s)+r,r=(t-r)*Math.sin(s)+(e-o)*Math.cos(s)+o,a>this.cx-i/2&&a<this.cx+i/2&&r>this.cy-n/2&&r<this.cy+n/2)):(t-this.cx)*(t-this.cx)+(e-this.cy)*(e-this.cy)<this.radius*this.scale*this.radius*this.scale},this.selectedHandler=function(){this.selected=!0,this.selectedLocation={x:this.x,y:this.y}},this.unselectedHandler=function(){this.selected=!1,this.selectedLocation=null},this.dbclickHandler=function(t){this.dispatchEvent("dbclick",t)},this.clickHandler=function(t){this.dispatchEvent("click",t)},this.mousedownHander=function(t){this.dispatchEvent("mousedown",t)},this.mouseupHandler=function(t){this.dispatchEvent("mouseup",t)},this.mouseoverHandler=function(t){this.isMouseOver=!0,this.dispatchEvent("mouseover",t)},this.mousemoveHandler=function(t){this.dispatchEvent("mousemove",t)},this.mouseoutHandler=function(t){this.isMouseOver=!1,this.showSelected=!1,this.dispatchEvent("mouseout",t)},this.mousedragHandler=function(t){var e=this.selectedLocation.x+t.dx,i=this.selectedLocation.y+t.dy;this.setLocation(e,i),this.dispatchEvent("mousedrag",t)},this.addEventListener=function(t,e){var i=this;return this.eventBus||(this.eventBus=new D),this.eventBus.subscribe(t,function(t){e.call(i,t)}),this},this.dispatchEvent=function(t,e){return this.eventBus?(this.eventBus.publish(t,e),this):null},this.removeEventListener=function(t){this.eventBus.unsubscribe(t)},this.removeAllEventListener=function(){this.eventBus=new D};var t=this;["click","dbclick","mousedown","mouseup","mouseover","mouseout","mousemove","mousedrag"].forEach(function(e){t[e]=function(t){null!=t?this.addEventListener(e,t):this.dispatchEvent(e)}})}O.util=V,Y.prototype={get width(){return this.canvas.width},get height(){return this.canvas.height},set mode(e){this.childs.forEach(function(t){t.mode=e})}},u.prototype=new j,t.prototype=new j,Object.defineProperties(t.prototype,{cx:{get:function(){return Math.round(this.x+this.width/2)},set:function(t){this.x=Math.round(t-this.width/2)}},cy:{get:function(){return Math.round(this.y+this.height/2)},set:function(t){this.y=Math.round(t-this.height/2)}},radius:{get:function(){return Math.round(this.width/2)},set:function(t){this.width=this.height=2*t}},size:{get:function(){return Math.round(2*this.radius)},set:function(t){this.radius=Math.round(Math.round(t/2),2)}}}),e.prototype=new t,new e;function U(t,e,i){return q(t,e,i).length}var q=function(t,i,e){var n=[];return(t.outLinks||[]).forEach(function(e){(i.inLinks||[]).forEach(function(t){e===t&&n.push(t)})}),e&&(i.outLinks||[]).forEach(function(e){(t.inLinks||[]).forEach(function(t){e===t&&n.push(t)})}),n},d=Math.PI/2,f=Math.PI,Z=2*Math.PI,K=3*Math.PI,Q={font:"normal 13px Arial",fontColor:"120,120,120",lineWidth:2,lineJoin:"miter",lineCap:"butt",strokeColor:"120,120,120",selectedColor:"10,10,230",selectedAlpha:1,background:null,bundleOffset:20,bundleGap:20,groupNum:1,curveness:.5,arrowsRadius:5,lineType:"straight",alpha:1,showlabel:!0,showArrow:!0,arrowType:"triangle",labelBackGround:null,labelBorderWidth:0,labelBorderColor:"255,255,255",labelBorderRadius:0,lineDash:null,path:[],pathDefine:null,animate:!1,animateSpeed:1,animateBallIndex:1,animateBall:null,animateBallColor:"255,0,0",animateBallSize:5,lineDashOffset:0,multiControlPercent:.2,parallelType:"curve"};function p(h,t,e){this.initialize=function(t,e,i){p.prototype.initialize.apply(this,arguments),this.elementType="link",this.zIndex=O.Link_zIndex,this.label=i,this.source=t,this.target=e,this.source&&null==this.source.outLinks&&(this.source.outLinks=[]),this.source&&null==this.source.inLinks&&(this.source.inLinks=[]),this.target&&null==this.target.inLinks&&(this.target.inLinks=[]),this.target&&null==this.target.outLinks&&(this.target.outLinks=[]),null!=this.source&&this.source.outLinks.push(this),null!=this.target&&this.target.inLinks.push(this),this.linePointCache=null,this.pathDefine=null,this.arrowCache=null,this.textCache={text:null,width:0,height:0},Object.assign(this,Q),this.caculateIndex()},this.findInsertPoint=function(t,e){e=O.util.lineVir(t.cx,t.cy,e.cx,e.cy),t=t.getBound();return O.util.intersectionLineBound(e,t)},this.caculateIndex=function(){var t=U(this.source,this.target,!1);0<t&&(this.nodeIndex=t-1)},this.removeHandler=function(){var e,i=this;this.source.outLinks=(this.source.outLinks||[]).filter(function(t){return t!==i}),this.target.inLinks=(this.target.inLinks||[]).filter(function(t){return t!==i}),q((e=this).source,e.target).filter(function(t){return e!==t}).forEach(function(t,e){t.nodeIndex=e})},this.getStartPosition=function(){var t=this.findInsertPoint(this.source,this.target);return t=null==t?{x:this.source.cx,y:this.source.cy}:t},this.getEndPosition=function(){var t=this.findInsertPoint(this.target,this.source);return t=null==t?{x:this.target.cx,y:this.target.cy}:t},this.isInBound=function(t,e){var i,n=this.lineWidth;if(this.labelBackHeight&&(n=Math.round(this.labelBackHeight/2)),0<this.path.length){for(var o=!1,s=1;s<this.path.length;s++){var a=this.path[s-1],r=this.path[s];if(O.util.containStroke(a.x,a.y,r.x,r.y,n+2,t,e)){o=!0;break}}return o}return this.bezierPoints?(i=this.bezierPoints,O.util.containBerzierStroke(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],n,t,e)):!!this.quadraticPoints&&(i=this.quadraticPoints,O.util.containQuadraticStroke(i[0],i[1],i[2],i[3],i[4],i[5],n+2,t,e))},this.paint=function(t,e){"function"==typeof this.definedPaintFunc?this.definedPaintFunc(t,e):this.drawOriginalLine(t,e)},this.drawOriginalLine=function(t){if(this.source&&this.source.visible&&this.target&&this.target.visible){if("source"==this.colorType?this.strokeColor=this.source.fillColor:"target"==this.colorType&&(this.strokeColor=this.target.fillColor),this.source===this.target)this.lineType="curver";else if(this.groupNum=U(this.target,this.source,!0),1<this.groupNum)return void("curve"==this.parallelType?this.paintMutilCurve(t):this.paintMutilLine(t));this.paintLine(t,e)}},this.paintLine=function(t,e){switch(this.lineType){case"direct":case"straight":this.paintDrirectLine(t,e);break;case"vlink":this.paintVerticalLink(t,e);break;case"hlink":this.paintHorizolLink(t,e);break;case"vcurve":this.paintVCurve(t,e);break;case"hcurve":this.paintHCurve(t,e);break;case"hvfold":this.paintHVFoldLink(t,e);break;case"vhfold":this.paintVHFoldLink(t,e);break;case"bezier":this.paintBezier(t,e);break;case"vbezier":this.paintVBezierLink(t,e);break;case"hbezier":this.paintHBezierLink(t,e);break;case"arrowline":this.paintArrowLine(t,e);break;case"curver":this.paintCurverLink(t,e);break;default:this.lineType="straight",this.paintDrirectLine(t,e)}},this.paintAnimateBall=function(t){var e,i,n,o,s,a,r=this.path;2==r.length&&(this.animateBallIndex=1),0<this.animateBallIndex&&this.animateBallIndex<r.length?(e=r[this.animateBallIndex-1].x,i=r[this.animateBallIndex-1].y,n=r[this.animateBallIndex].x,r=r[this.animateBallIndex].y,o=Math.atan2(r-i,n-e),null!=(a=this.animateBall)&&a.sx==e&&a.sy==i&&a.tx==n&&a.ty==r||(a=n-e,s=r-i,a=Math.sqrt(a*a+s*s)/this.animateSpeed,this.animateBall={x:e,y:i,sx:e,sy:i,tx:n,ty:r,angle:o,moves:a})):(this.animateBallIndex=0,this.animateBall=null),this.animateBall&&0<this.animateBall.moves?(this.animateBall.moves--,this.animateBall.x+=this.animateSpeed*Math.cos(this.animateBall.angle),this.animateBall.y+=this.animateSpeed*Math.sin(this.animateBall.angle),t.save(),t.beginPath(),t.fillStyle="rgba(".concat(this.animateBallColor,",").concat(this.alpha,")"),t.arc(this.animateBall.x,this.animateBall.y,this.animateBallSize,0,Z),t.fill(),t.restore(),this.animateBall.moves<=0&&(this.animateBall=null,this.animateBallIndex++)):this.animateBallIndex++},this.setLineStyle=function(t){var e;this.selected||this.showSelected?(t.strokeStyle="rgba(".concat(this.selectedColor,",").concat(this.selectedAlpha,")"),t.lineWidth=this.lineWidth+2):("both"==this.colorType?(e=t.createLinearGradient(this.source.cx,this.source.cy,this.target.cx,this.target.cy),this.source.fillColor&&e.addColorStop(0,"rgba(".concat(this.source.fillColor,",").concat(this.alpha,")")),this.target.fillColor&&e.addColorStop(1,"rgba(".concat(this.target.fillColor,",").concat(this.alpha,")")),t.strokeStyle=e):"source"==this.colorType?t.strokeStyle="rgba(".concat(this.source.fillColor,",").concat(this.alpha,")"):"target"==this.colorType?t.strokeStyle="rgba(".concat(this.target.fillColor,",").concat(this.alpha,")"):t.strokeStyle="rgba(".concat(this.strokeColor,",").concat(this.alpha,")"),t.lineWidth=this.lineWidth),null!=this.lineDash&&(t.setLineDash(this.lineDash),this.animate)&&(t.lineDashOffset=this.lineDashOffset,this.lineDashOffset=(this.lineDashOffset-1)%100)},this.paintMutilCurve=function(t){this.bundleGap=60;var e={x:this.source.cx,y:this.source.cy},i={x:this.target.cx,y:this.target.cy},n=this.computeControlPoint(e,i,.49),o=n.startPoint,n=n.endPoint,s=null,a=("rect"==this.source.shape?(a=O.util.lineVir(o.x,o.y,this.source.cx,this.source.cy),null==(s=O.util.intersectionLineBound(a,this.source.getBound()))&&(s={x:o.x,y:o.y})):(a=(this.source.radius+this.source.borderWidth/2)*this.source.scale,s=O.util.pointOnCircle(e.x,e.y,a,Math.atan2(o.y-e.y,o.x-e.x))),Math.atan2(n.y-i.y,n.x-i.x),i),r=i,h=(this.showArrow&&(a=this.calculateEndPoint({cx:n.x,cy:n.y},this.target),h=this.getArrowRadius(),r.x=a.x-h*Math.cos(a.angle),r.y=a.y-h*Math.sin(a.angle)),function(t){for(var e=[],i=0,n=t.length;i<n-2;i+=2){var o=[{x:+t[i-2],y:+t[i-1]},{x:+t[i],y:+t[i+1]},{x:+t[i+2],y:+t[i+3]},{x:+t[i+4],y:+t[i+5]}];n-4===i?o[3]=o[2]:i||(o[0]={x:+t[i],y:+t[i+1]}),e=[(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y]}return e}([s.x,s.y,o.x,o.y,n.x,n.y,r.x,r.y])),s=(this.path=[],this.bezierPoints=[s.x,s.y,h[0],h[1],h[2],h[3],r.x,r.y],this.pathDefine="M".concat(s.x," ").concat(s.y," C").concat(h[0]," ").concat(h[1]," ").concat(h[2]," ").concat(h[3]," ").concat(r.x," ").concat(r.y),h=O.util.getPointOnBezierCurve(.33,s.x,s.y,r.x,r.y,h[0],h[1],h[2],h[3]),o=i.x<e.x?Math.atan2(e.y-i.y,e.x-i.x):Math.atan2(i.y-e.y,i.x-e.x),this.arrowCache={start:{x:n.x,y:n.y},end:a,textMid:{x:h.x,y:h.y},angle:o},new Path2D(this.pathDefine));this.paintLineBackGround(t,s),t.save(),this.setLineStyle(t),t.stroke(s),t.restore(),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.animate&&null==this.lineDash&&(r=this.bezierPoints,this.paintBezierAnimate(t,r[0],r[1],r[6],r[7],r[2],r[3],r[4],r[5])),this.paintLineText(t,this.arrowCache.textMid.x,this.arrowCache.textMid.y,this.arrowCache.angle),this.paintLineTips(t,this.arrowCache.textMid)},this.paintMutilLine=function(t){this.bundleGap=25;var e={x:this.source.cx,y:this.source.cy},i={x:this.target.cx,y:this.target.cy},n=this.computeControlPoint(e,i,this.multiControlPercent),o=n.startPoint,n=n.endPoint,s=i;this.showArrow&&(s=this.calculateEndPoint({cx:n.x,cy:n.y},this.target),h=this.getArrowRadius(),i.x=s.x-h*Math.cos(s.angle),i.y=s.y-h*Math.sin(s.angle)),this.path=[{x:e.x,y:e.y},{x:o.x,y:o.y},{x:n.x,y:n.y},{x:s.x,y:s.y}];for(var a=["M".concat(e.x," ").concat(e.y," ")],r=1;r<this.path.length-1;r++)a.push("L".concat(this.path[r].x," ").concat(this.path[r].y," "));a.push("L".concat(i.x," ").concat(i.y)),this.pathDefine=a.join(),this.arrowCache={start:{x:n.x,y:n.y},end:s,textStart:{cx:o.x,cy:o.y},textEnd:{cx:n.x,cy:n.y}};var h=new Path2D(this.pathDefine);this.paintLineBackGround(t,h),t.save(),this.setLineStyle(t),t.stroke(h),t.restore(),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.animate&&null==this.lineDash&&this.paintAnimateBall(t),this.showlabel&&this.paintTextOnLineWithAngle(t,this.arrowCache.textStart,this.arrowCache.textEnd)},this.computeControlPoint=function(t,e,i){this.bundleOffset=O.util.getDistance(t,e)*i;var i=this.groupNum,n=Math.atan2(e.y-t.y,e.x-t.x),o=t.x+this.bundleOffset*Math.cos(n),t=t.y+this.bundleOffset*Math.sin(n),s=e.x+this.bundleOffset*Math.cos(n-f),e=e.y+this.bundleOffset*Math.sin(n-f),i=i*this.bundleGap/2-this.bundleGap/2,a=this.bundleGap*this.nodeIndex,r=(n-=d,a*Math.cos(n)),a=a*Math.sin(n),h=Math.cos(n-f),n=Math.sin(n-f);return{startPoint:{x:o+r+i*h,y:t+a+i*n},endPoint:{x:s+r+i*h,y:e+a+i*n}}},this.paintCurverLink=function(t){this.checkNeedUpdate()&&(e=this.source.cx,i=this.source.cy,d=(n=this.target.cx)-e,c=(o=this.target.cy)-i,u=e<n?1:-1,s={},a={},r=0,this.path=[],l=null,l=(this.source===this.target?(h=this.source.radius/2*this.source.scale||20,this.showArrow=!1,s=O.util.getSelfLoopControlPoints(e,i,h+10*this.nodeIndex),a=O.util.getPointOnBezierCurve(.5,e,i,n,o,s.x1,s.y1,s.x2,s.y2),r=Math.atan2(1,1),this.animate=!1,this.bezierPoints=[e,i,s.x1,s.y1,s.x2,s.y2,n,o],"M".concat(e," ").concat(i," C").concat(s.x1," ").concat(s.y1," ").concat(s.x2," ").concat(s.y2," ")):(s=O.util.getQuadraticControlPoint(e,i,n,o,4,this.curveness),a=O.util.getPointOnQuadraticCurve(.5,e,i,n,o,s.x,s.y),r=Math.atan2(c*u,d*u),this.quadraticPoints=[e,i,s.x,s.y,n,o],"M".concat(e," ").concat(i," Q").concat(s.x," ").concat(s.y," "))).concat(n," ").concat(o),this.pathDefine=l,this.showArrow&&(h=O.util.getPointOnQuadraticCurve(.5,e,i,n,o,s.x,s.y),c=O.util.getPointOnQuadraticCurve(.52,e,i,n,o,s.x,s.y),this.arrowCache={start:{x:h.x,y:h.y},end:{x:c.x,y:c.y}}),this.control={x:a.x,y:a.y,angle:r});var e,i,n,o,s,a,r,h,c,l,u,d=new Path2D(this.pathDefine);this.paintLineBackGround(t,d),this.setLineStyle(t),t.stroke(d),this.animate&&null==this.lineDash&&(u=this.quadraticPoints,this.paintCurverAnimate(t,u[0],u[1],u[4],u[5],u[2],u[3])),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.paintLineText(t,this.control.x,this.control.y,this.control.angle),this.paintLineTips(t,{x:this.control.x,y:this.control.y})},this.paintCurverAnimate=function(t,e,i,n,o,s,a){this.animateBall&&this.animateBall.moves<100?(this.animateBall.moves=(this.animateBall.moves+this.animateSpeed)%100,e=O.util.getPointOnQuadraticCurve(this.animateBall.moves/100,e,i,n,o,s,a),t.save(),t.beginPath(),t.fillStyle="rgba(".concat(this.animateBallColor,",").concat(this.alpha,")"),t.arc(e.x,e.y,this.animateBallSize,0,Z),t.fill(),t.restore()):this.animateBall={moves:0}},this.paintArrowLine=function(t){var e=(e=this.lineWidth)<4?4:e,i={x:this.target.cx,y:this.target.cy},n=(this.showArrow&&(i=this.calculateEndPoint(this.source,this.target)),this.source.cx),o=this.source.cy,s=i.x,a=i.y;this.reverse&&(n=i.x,o=i.y,s=this.source.cx,a=this.source.cy),this.path=[{x:n,y:o},{x:s,y:a}],t.save(),t.beginPath(),this.showArrow?t.paintCustomArrow(n,o,s,a,[-3*e,e,-4*e,3*e+1]):t.paintCustomArrow(n,o,s,a,[0,e]),t.lineJoin="round","both"==this.colorType?((i=t.createLinearGradient(this.source.cx,this.source.cy,this.target.cx,this.target.cy)).addColorStop(0,"rgba(".concat(this.source.fillColor,",").concat(this.alpha,")")),i.addColorStop(1,"rgba(".concat(this.target.fillColor,",").concat(this.alpha,")")),t.fillStyle=i):t.fillStyle="rgba(".concat(this.strokeColor,",").concat(this.alpha,")"),(this.selected||this.showSelected)&&(t.fillStyle="rgba(".concat(this.selectedColor,",").concat(this.selectedAlpha,")")),t.fill(),t.restore(),this.paintTextOnLineWithAngle(t,this.source,this.target)},this.checkNeedUpdate=function(){return(null==this.linePointCache||this.linePointCache.source.x!=this.source.x||this.linePointCache.source.y!=this.source.y||this.linePointCache.target.x!=this.target.x||this.linePointCache.target.y!=this.target.y||this.lineType!=this.linePointCache.lineType)&&(this.linePointCache={source:{x:this.source.x,y:this.source.y},target:{x:this.target.x,y:this.target.y},lineType:this.lineType},!0)},this.paintDrirectLine=function(t){this.checkNeedUpdate()&&(o=this.target.cx,s=this.target.cy,this.arrowCache=null,this.showArrow&&(i=(e=this.calculateEndPoint(this.source,this.target)).x,n=e.y,o=i-(a=this.getArrowRadius())*Math.cos(e.angle),s=n-a*Math.sin(e.angle),this.arrowCache={start:{x:this.source.cx,y:this.source.cy},end:{x:i,y:n}}),this.path=[{x:this.source.cx,y:this.source.cy},{x:this.target.cx,y:this.target.cy}],this.pathDefine="M".concat(this.source.cx," ").concat(this.source.cy," L").concat(o," ").concat(s));var e,i,n,o,s,a=new Path2D(this.pathDefine);this.paintLineBackGround(t,a),this.setLineStyle(t),t.stroke(a),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.animate&&null==this.lineDash&&this.paintAnimateBall(t),this.paintTextOnLineWithAngle(t,this.source,this.target)},this.paintTextOnLineWithAngle=function(t,e,i){var n={x:(i.cx+e.cx)/2,y:(i.cy+e.cy)/2};this.showlabel&&null!=this.label&&(i=Math.atan2(i.cy-e.cy,i.cx-e.cx),d<i&&(i-=f),i<-d&&(i+=f),this.paintLineText(t,n.x,n.y,i)),this.paintLineTips(t,{x:n.x,y:n.y})},this.paintLineTips=function(t,e){var i,n,o;!this.hideText&&this.tipText&&(o=this.tipRadius||0,t.save(),t.font=this.tipFont||"normal 13px Arial",i=t.measureText(this.tipText).width+12,o=(n=t.measureText("田").width+12-2)/2<o?n/2:o,t.translate(e.x-i/2,e.y-n-6),t.beginPath(),t.arc(i-o,n-o,o,0,d),t.lineTo(i/2+4,n),t.lineTo(i/2,6+n),t.lineTo(i/2-4,n),t.lineTo(o,n),t.arc(o,n-o,o,d,f),t.lineTo(0,o),t.arc(o,o,o,f,K/2),t.lineTo(i-o,0),t.arc(i-o,o,o,K/2,Z),t.lineTo(i,n-o),t.closePath(),t.fillStyle="rgba(".concat(this.tipColor||"250,50,50",",").concat(this.alpha,")"),t.fill(),t.translate(i/2,n/2),t.textBaseline="middle",t.textAlign="center",t.fillStyle="rgba(".concat(this.tipFontColor||"250,250,250",",").concat(this.alpha,")"),t.fillText(this.tipText,0,0),t.restore())},this.calculateEndPoint=function(t,e){var i,n,o=0,s=0,a=e.cx,r=e.cy;return"rect"==this.target.shape?(a=(i=this.getEndPosition()).x,r=i.y,o=Math.atan2(r-t.cy,a-t.cx)):(i=e.cx,n=e.cy,s=-(e.radius+e.borderWidth/2)*e.scale,o=Math.atan2(n-t.cy,i-t.cx),a=i+s*Math.cos(o),r=n+s*Math.sin(o)),{x:Math.round(a),y:Math.round(r),angle:o}},this.getArrowRadius=function(){var t=3;return"dot"!=this.arrowType&&"box"!=this.arrowType||(t=2),t=this.selected||this.showSelected?Math.round(t*(this.lineWidth+1)):Math.round(t*this.lineWidth),Math.min(Math.max(t,3),80)},this.getTargetBorderPoint=function(){var t,e=0;return this.showArrow&&(e=(t=this.target).radius,e="rect"==t.shape?-1!=["vbezier","vlink"].indexOf(this.lineType)?(t.height/2+t.borderWidth/2)*t.scale:(t.width/2+t.borderWidth/2)*t.scale:(t.radius+t.borderWidth/2)*t.scale),e},this.paintSpecialArrow=function(t,e,i){var n=this.getArrowRadius(),o=Math.atan((i.x-e.x)/(i.y-e.y));switch(t.save(),t.translate(i.x,i.y),i.y>=e.y?t.rotate(-o):t.rotate(f-o),this.selected||this.showSelected?t.fillStyle="rgba(".concat(this.selectedColor,",").concat(this.selectedAlpha,")"):t.fillStyle="rgba(".concat(this.strokeColor,",").concat(this.alpha,")"),t.beginPath(),this.arrowType){case"arrow":var s="M0 0 L".concat(.6*-n," ").concat(1.5*-n," L0 ").concat(-n," L").concat(.6*n," ").concat(1.5*-n," Z");t.fill(new Path2D(s));break;case"dot":t.arc(0,-n,n,0,2*f),t.fill();break;case"box":t.fillRect(-n,-2*n,2*n,2*n);break;default:t.fill(new Path2D("M0 0 L".concat(-n/2," ").concat(1.2*-n," L").concat(n/2," ").concat(1.2*-n," Z")))}t.restore()},this.paintVerticalLink=function(t){if(this.checkNeedUpdate()){var e=this.source.y+this.source.height,i=this.target.y,n=this.showArrow?this.getArrowRadius():0;e>i+this.target.height&&(e=this.source.y,i=this.target.y+this.target.height,n=-n),this.path=[{x:this.source.cx,y:e},{x:this.source.cx,y:(e+i)/2},{x:this.target.cx,y:(e+i)/2},{x:this.target.cx,y:i-n}];for(var o=["M".concat(this.path[0].x," ").concat(this.path[0].y," ")],s=1;s<this.path.length;s++)o.push("L".concat(this.path[s].x," ").concat(this.path[s].y," "));this.pathDefine=o.join(),this.arrowCache={start:{x:this.target.cx,y:(e+i)/2},end:{x:this.target.cx,y:i},midPos:{x:this.target.cx,y:((e+i)/2+i)/2}}}n=new Path2D(this.pathDefine);this.paintLineBackGround(t,n),this.setLineStyle(t),t.stroke(n),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.animate&&null==this.lineDash&&this.paintAnimateBall(t),this.paintLineText(t,this.arrowCache.midPos.x,this.arrowCache.midPos.y),this.paintLineTips(t,this.arrowCache.midPos)},this.paintVCurve=function(t){this.checkNeedUpdate()&&(e=this.source.y+this.source.height,i=this.target.y,n=this.showArrow?this.getArrowRadius():0,e>i+this.target.height&&(e=this.source.y,i=this.target.y+this.target.height,n=-n),o=this.target.cx-this.source.cx<0?-1:1,s=(n=i-n)-e<0?-1:1,a=Math.abs(this.target.cx-this.source.cx)/2<30?Math.abs(this.target.cx-this.source.cx)/2:30,a=Math.abs(n-e)/2<a?Math.abs(n-e)/2:a,r=Math.abs(n-e)/2-a,c=Math.abs(this.target.cx-this.source.cx)-2*a,h=e+r*s+a*s,this.pathDefine=" M ".concat(this.source.cx," ").concat(e,"\n                                L ").concat(this.source.cx," ").concat(e+r*s,"\n                                C  ").concat(this.source.cx," ").concat(h," ").concat(this.source.cx," ").concat(h," ").concat(this.source.cx+a*o," ").concat(h,"\n                                L ").concat(this.source.cx+c*o+a*o," ").concat(h,"\n                                C  ").concat(this.target.cx," ").concat(h," ").concat(this.target.cx,"  ").concat(h," ").concat(this.target.cx," ").concat(n-r*s,"\n                                L ").concat(this.target.cx," ").concat(n),this.path=[{x:this.source.cx,y:e},{x:this.source.cx,y:h},{x:this.target.cx,y:h},{x:this.target.cx,y:n}],this.arrowCache={start:{x:this.target.cx,y:(e+i)/2},end:{x:this.target.cx,y:i},midPos:{x:this.target.cx,y:((e+i)/2+i)/2}});var e,i,n,o,s,a,r,h,c=new Path2D(this.pathDefine);this.paintLineBackGround(t,c),this.setLineStyle(t),t.stroke(c),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.paintLineText(t,this.arrowCache.midPos.x,this.arrowCache.midPos.y)},this.paintHCurve=function(t){this.checkNeedUpdate()&&(e=this.source.x+this.source.width,i=this.target.x,n=this.showArrow?this.getArrowRadius():0,e>i+this.target.width&&(e=this.source.x,i=this.target.x+this.target.width,n=-n),o=(n=i-n)-e<0?-1:1,s=this.target.cy-this.source.cy<0?-1:1,h=Math.abs(n-e)/2<30?Math.abs(n-e)/2:30,h=Math.abs(this.target.cy-this.source.cy)/2<h?Math.abs(this.target.cy-this.source.cy)/2:h,r=e+(a=Math.abs(n-e)/2-h)*o+h*o,this.pathDefine="M ".concat(e," ").concat(this.source.cy,"\n                                L ").concat(e+a*o," ").concat(this.source.cy,"\n                                C ").concat(r," ").concat(this.source.cy," \n                                ").concat(r," ").concat(this.source.cy," \n                                ").concat(r," ").concat(this.source.cy+h*s,"\n                                L ").concat(r," ").concat(this.target.cy-h*s," \n                                C ").concat(r,"  ").concat(this.target.cy," \n                                ").concat(r,"  ").concat(this.target.cy," \n                                ").concat(n-a*o,"  ").concat(this.target.cy,"\n                                L ").concat(n," ").concat(this.target.cy),this.path=[{x:e,y:this.source.cy},{x:r,y:this.source.cy},{x:r,y:this.target.cy},{x:n,y:this.target.cy}],this.arrowCache={start:{x:(e+i)/2,y:this.target.cy},end:{x:i,y:this.target.cy},midPos:{x:((e+i)/2+i)/2,y:this.target.cy}});var e,i,n,o,s,a,r,h=new Path2D(this.pathDefine);this.paintLineBackGround(t,h),this.setLineStyle(t),t.stroke(h),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.paintLineText(t,this.arrowCache.midPos.x,this.arrowCache.midPos.y)},this.paintHorizolLink=function(t){if(this.checkNeedUpdate()){var e=this.source.x+this.source.width,i=this.target.x,n=this.showArrow?this.getArrowRadius():0;e>i+this.target.width&&(e=this.source.x,i=this.target.x+this.target.width,n=-n),this.path=[{x:e,y:this.source.cy},{x:(e+i)/2,y:this.source.cy},{x:(e+i)/2,y:this.target.cy},{x:i-n,y:this.target.cy}];for(var o=["M".concat(this.path[0].x," ").concat(this.path[0].y," ")],s=1;s<this.path.length;s++)o.push("L".concat(this.path[s].x," ").concat(this.path[s].y," "));this.pathDefine=o.join(),this.arrowCache={start:{x:(e+i)/2,y:this.target.cy},end:{x:i,y:this.target.cy},midPos:{x:((e+i)/2+i)/2,y:this.target.cy}}}n=new Path2D(this.pathDefine);this.paintLineBackGround(t,n),this.setLineStyle(t),t.stroke(n),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.animate&&null==this.lineDash&&this.paintAnimateBall(t),this.paintLineText(t,this.arrowCache.midPos.x,this.arrowCache.midPos.y),this.paintLineTips(t,this.arrowCache.midPos)},this.paintHVFoldLink=function(t){this.checkNeedUpdate()&&(e=this.source,a=this.target,(n=o=e.cx)<(i=a.cx)?n=e.x+e.width:i<o&&(n=e.x),o=a.cy,s=0,e.cy<a.cy?(o=a.y,this.showArrow&&(s=3*-this.lineWidth)):e.cy>a.cy&&(o=a.y+a.height,this.showArrow)&&(s=3*this.lineWidth),this.path=[{x:n,y:e.cy},{x:i,y:e.cy},{x:i,y:o}],this.pathDefine="M".concat(n," ").concat(e.cy," L").concat(i," ").concat(e.cy," L").concat(i," ").concat(o+s),this.arrowCache={start:{x:i,y:e.cy},end:{x:i,y:o},textPos:{x:i,y:(e.cy+o)/2}});var e,i,n,o,s,a=new Path2D(this.pathDefine);this.paintLineBackGround(t,a),this.setLineStyle(t),t.stroke(a),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.paintLineText(t,this.arrowCache.textPos.x,this.arrowCache.textPos.y,0)},this.paintVHFoldLink=function(t){this.checkNeedUpdate()&&(e=this.source,i=this.target,o=e.cy,n=i.cy,s=e.cy,o<n?s=e.y+e.height:n<o&&(s=e.y),n=i.cx,o=0,e.cx<i.cx?(n=i.x,this.showArrow&&(o=3*-this.lineWidth)):e.cx>i.cx&&(n=i.x+i.width,this.showArrow)&&(o=3*this.lineWidth),this.path=[{x:e.cx,y:s},{x:e.cx,y:i.cy},{x:n,y:i.cy}],this.pathDefine="M".concat(e.cx," ").concat(s," L").concat(e.cx," ").concat(i.cy," L").concat(n+o," ").concat(i.cy),this.arrowCache={start:{x:e.cx,y:i.cy},end:{x:n,y:i.cy},textPos:{x:(e.cx+n)/2,y:i.cy}});var e,i,n,o,s=new Path2D(this.pathDefine);this.paintLineBackGround(t,s),this.setLineStyle(t),t.stroke(s),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.paintLineText(t,this.arrowCache.textPos.x,this.arrowCache.textPos.y,0)},this.paintLineBackGround=function(t,e){this.background&&(t.save(),t.lineCap="round",t.lineJoin="round",t.strokeStyle="rgba(".concat(this.background,",").concat(.9*this.alpha,")"),t.lineWidth=3*(this.lineWidth+2),t.stroke(e),t.restore())},this.paintBezier=function(t){var e=O.util.calculateAngle(this.source.cx,this.source.cy,this.target.cx,this.target.cy);0<=e&&e<=45||135<=e&&e<=225||315<=e&&e<=360?this.paintVBezierLink(t):this.paintHBezierLink(t)},this.paintHBezierLink=function(t){this.checkNeedUpdate()&&(e=this.showArrow?this.getArrowRadius():0,(r=this.source.x+this.source.width)>(i=this.target.x)+this.target.width&&(r=this.source.x,i=this.target.x+this.target.width,e=-e),n=(r+i)*this.curveness,o=this.source.cy,s=(r+i)*this.curveness,a=this.target.cy,this.path=[],this.bezierPoints=[r,this.source.cy,n,o,s,a,i,this.target.cy],this.pathDefine="M".concat(r," ").concat(this.source.cy," C").concat(n," ").concat(o," ").concat(s," ").concat(a," ").concat(i-e," ").concat(this.target.cy),this.arrowCache={start:{x:i-e,y:this.target.cy},end:{x:i,y:this.target.cy}});var e,i,n,o,s,a,r=new Path2D(this.pathDefine);this.paintLineBackGround(t,r),this.setLineStyle(t),t.stroke(r),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.animate&&null==this.lineDash&&this.paintBezierAnimate(t,this.bezierPoints[0],this.bezierPoints[1],this.bezierPoints[6],this.bezierPoints[7],this.bezierPoints[2],this.bezierPoints[3],this.bezierPoints[4],this.bezierPoints[5]),this.paintBezierText(t,this.bezierPoints[0],this.bezierPoints[1],this.bezierPoints[6],this.bezierPoints[7],this.bezierPoints[2],this.bezierPoints[3],this.bezierPoints[4],this.bezierPoints[5])},this.paintVBezierLink=function(t){this.checkNeedUpdate()&&(e=this.showArrow?this.getArrowRadius():0,(r=this.source.y+h.height)>(i=this.target.y)+this.target.height&&(r=this.source.y,i=this.target.y+this.target.height,e=-e),n=this.source.cx,o=(r+i)*this.curveness,s=this.target.cx,a=(r+i)*this.curveness,this.path=[],this.bezierPoints=[this.source.cx,r,n,o,s,a,this.target.cx,i],this.pathDefine="M".concat(this.source.cx," ").concat(r," C").concat(n," ").concat(o," ").concat(s," ").concat(a," ").concat(this.target.cx," ").concat(i-e),this.arrowCache={start:{x:this.target.cx,y:i-e},end:{x:this.target.cx,y:i}});var e,i,n,o,s,a,r=new Path2D(this.pathDefine);this.paintLineBackGround(t,r),this.setLineStyle(t),t.stroke(r),this.showArrow&&this.paintSpecialArrow(t,this.arrowCache.start,this.arrowCache.end),this.paintBezierText(t,this.bezierPoints[0],this.bezierPoints[1],this.bezierPoints[6],this.bezierPoints[7],this.bezierPoints[2],this.bezierPoints[3],this.bezierPoints[4],this.bezierPoints[5]),this.animate&&null==this.lineDash&&this.paintBezierAnimate(t,this.bezierPoints[0],this.bezierPoints[1],this.bezierPoints[6],this.bezierPoints[7],this.bezierPoints[2],this.bezierPoints[3],this.bezierPoints[4],this.bezierPoints[5])},this.paintBezierAnimate=function(t,e,i,n,o,s,a,r,h){this.animateBall&&this.animateBall.moves<100?(this.animateBall.moves=(this.animateBall.moves+this.animateSpeed)%100,e=O.util.getPointOnBezierCurve(this.animateBall.moves/100,e,i,n,o,s,a,r,h),t.save(),t.beginPath(),t.arc(e.x,e.y,this.animateBallSize,0,2*f),t.fillStyle="rgba(".concat(this.animateBallColor,",").concat(this.alpha,")"),t.fill(),t.restore()):this.animateBall={moves:0}},this.paintBezierText=function(t,e,i,n,o,s,a,r,h){var c,l=null;this.showlabel&&this.label&&(l=O.util.getPointOnBezierCurve(.5,e,i,n,o,s,a,r,h),"curver"==this.lineType?(c=0<r-s?-1:1,c=Math.atan2((r-s)*c,(h-a)*-c)+d,this.paintLineText(t,l.x,l.y,c)):this.paintLineText(t,l.x,l.y)),this.tipText&&(null==l&&O.util.getPointOnBezierCurve(.5,e,i,n,o,s,a,r,h),this.paintLineTips(t,{x:l.x,y:l.y}))},this.paintLineText=function(t,e,i,n){if(!this.showlabel||!this.label||this.hideText)return!1;var o="bottom";null!=this.tipText&&(o="top"),t.save(),t.translate(e,i),t.rotate(n||0),t.font=this.font,this.labelBackGround&&(o="middle",this.computeTextWidth(t),e=this.textCache.width,i=this.textCache.height,t.DGraphRoundRect(-e/2,-i/2,e,i,this.labelBorderRadius),t.fillStyle="rgba(".concat(this.labelBackGround,",").concat(this.alpha,")"),t.fill()),t.textAlign="center",t.textBaseline=o,t.fillStyle="rgba(".concat(this.fontColor,",").concat(this.alpha,")"),t.fillText(this.label,0,1),t.restore()},this.computeTextWidth=function(t){var e;this.textCache.text!=this.label&&(e=t.measureText(this.label).width+6,t=t.measureText("国").width+3,this.labelBackHeight=t,this.textCache.text=this.label,this.textCache.width=e,this.textCache.height=t)},this.initialize(h,t,e)}p.prototype=new e;var J={label:null,type:"default",shape:"circle",font:"normal 13px Arial",fontColor:"20,20,20",borderWidth:0,borderColor:"120,120,230",borderAlpha:1,selectedBorderColor:"120,120,230",selectedBorderWidth:6,borderRadius:0,shadowColor:"110,110,230",shadowBlur:10,dragable:!0,textPosition:"Middle_Center",textOffsetX:0,textOffsetY:0,transformAble:!0,inLinks:null,outLinks:null,labelBackGround:null,labelBorderWidth:0,labelBorderColor:"255,255,255",fillStyle:null,strokeStyle:null,textLines:[],showlabel:!0,nodeWrapText:!1,headTipText:null,headTipFont:"normal 13px YaHei",headTipFontColor:"250,250,250",headTipRadius:0,padding:0,tags:null,tagColor:"230,30,30"};function y(){this.initialize=function(){y.prototype.initialize.apply(this,arguments),this.elementType="node",this.nodeType="inner",this.zIndex=O.Node_zIndex,Object.assign(this,J),this.icon=null,this.imageOffsetX=0,this.imageOffsetY=0,this.padding=0,this.textCache={sigleWidth:0,maxWidth:0,lineCount:0,font:null,text:""},this.nodeWrapText=!1,this.textSvgImage=null,this.needUpdate=!1,this.wrapTextConfig={isVertical:!1,fontSize:13,fontFamily:"Arial",padding:10},this.textPadding=10,this.labelBorderWidth=0},this.initialize(),this.drawNodeImg=function(t,e,i,n,o){var s;e&&e.width&&(s=this.padding/2,"rect"==this.shape||"square"==this.shape?t.drawImage(e,i+this.imageOffsetX+s,n+this.imageOffsetY+s,this.width-this.padding,this.height-this.padding):(o=2<o?o:2)<e.width/2?(this.paintShape(t),t.clip(),t.drawImage(e,i+this.imageOffsetX+s,n+this.imageOffsetY+s,this.width-this.padding,this.height-this.padding)):t.drawImage(e,-e.width/2+s,-e.height/2+s,e.width-this.padding,e.height-this.padding))},this.paint=function(t,e){"function"==typeof this.definedPaintFunc?this.definedPaintFunc(t,e):this.drawOriginalNode(t,e)},this.drawOriginalNode=function(t,e){var i;this.drawShape(t,e),this.image&&!e&&(i=t.globalAlpha,t.save(),t.globalAlpha=this.alpha,this.drawNodeImg(t,this.image,-this.width/2,-this.height/2,this.width/2),t.globalAlpha=i,t.restore()),e||this.hideText||(this.paintText(t),this.paintHeadTip(t),this.paintNodeTags(t))},this.drawShape=function(t,e){t.save(),t.beginPath(),this.paintShape(t),e?this.fillStyle?(t.fillStyle=this.fillStyle,t.fill()):this.fillColor?(t.fillStyle="rgba(".concat(this.fillColor,",").concat(this.alpha,")"),t.fill()):(t.lineWidth=this.borderWidth,t.strokeStyle="rgba(".concat(this.borderColor,",").concat(this.alpha,")"),t.stroke()):((this.fillColor||e)&&(this.paintShadow(t),t.fillStyle=this.fillStyle||"rgba(".concat(this.fillColor,",").concat(this.alpha,")"),t.fill()),this.lineDash&&1<this.lineDash.length&&t.setLineDash(this.lineDash),this.showSelected||this.selected?0<this.selectedBorderWidth&&(t.lineWidth=this.selectedBorderWidth,t.strokeStyle="rgba(".concat(this.selectedBorderColor,",").concat(this.alpha,")"),t.stroke()):0<this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.strokeStyle||"rgba(".concat(this.borderColor,",").concat(this.alpha,")"),t.stroke())),t.restore()},this.paintShape=function(t){switch(this.shape){case"rect":var e,i,n,o,s,a;this.borderRadius?(e=this.width,i=this.height,n=Math.PI/180,o=this.borderRadius,t.moveTo((s=-e/2)+(o=i-2*(o=e-2*o<0?e/2:o)<0?i/2:o),a=-i/2),t.lineTo(s+e-o,a),t.arc(s+e-o,a+o,o,270*n,360*n,!1),t.lineTo(s+e,a+i-o),t.arc(s+e-o,a+i-o,o,0,90*n,!1),t.lineTo(s+o,a+i),t.arc(s+o,a+i-o,o,90*n,180*n,!1),t.lineTo(s,a+o),t.arc(s+o,a+o,o,180*n,270*n,!1),t.closePath()):t.rect(-this.width/2,-this.height/2,this.width,this.height);break;case"square":t.rect(-this.radius,-this.radius,2*this.radius,2*this.radius);break;case"star":t.moveTo(0,-this.radius);for(var r=0;r<5;r++)t.rotate(Math.PI/5),t.lineTo(0,-.4*this.radius),t.rotate(Math.PI/5),t.lineTo(0,-this.radius);t.closePath();break;case"polygon":for(var h=2*Math.PI/6,r=0;r<6;r++)s=Math.cos(r*h),a=Math.sin(r*h),t.lineTo(s*this.radius,a*this.radius);t.closePath();break;case"circle":this.radius=this.radius<2?2:this.radius,t.arc(0,0,this.radius,0,2*Math.PI,!1);break;default:this.radius=this.radius<2?2:this.radius,t.arc(0,0,this.radius,0,2*Math.PI,!0)}},this.paintWrapText=function(t){var e;null!=this.textSvgImage&&!this.needUpdate||(this.wrapTextConfig.fontColor="rgba(".concat(this.fontColor,",").concat(this.alpha,")"),(e=new Image).src=O.util.genrateTextSvg(this.label,this.width-this.wrapTextConfig.padding,this.height-this.wrapTextConfig.padding,this.wrapTextConfig),this.textSvgImage=e,this.needUpdate=!1),1<=this.alpha&&t.drawImage(this.textSvgImage,-(this.width-this.wrapTextConfig.padding)/2,-(this.height-this.wrapTextConfig.padding)/2)},this.paintTextMutilLine=function(t){var e,i,n,o;this.showlabel&&this.label&&(t.font=this.font,this.processLabel(t),this.nodeWrapText?this.paintWrapText(t):(i=0,e=this.textPadding,null==this.textSvgImage||this.needUpdate?(o=this.textLines.length*this.textCache.sigleWidth+e,i=this.textCache.maxWidth+e,(n=new Image).src=O.util.buildMutilTextSvg(this.textLines,i,o,{font:this.font,fontColor:"rgb(".concat(this.fontColor,")"),backgroundColor:"rgb(".concat(this.labelBackGround,")"),borderColor:"rgb(".concat(this.labelBorderColor,")"),borderRadius:2}),this.textSvgImage=n,this.needUpdate=!1):i=this.textCache.maxWidth+e,o=this.getTextPostion(i,this.textCache.sigleWidth),t.drawImage(this.textSvgImage,o.x,o.y-(this.textCache.sigleWidth+e/2))))},this.paintText=function(t){if(this.showlabel&&this.label)if(this.nodeWrapText)this.paintWrapText(t);else{t.save(),t.font=this.font,this.processLabel(t);var e=this.textCache.sigleWidth,i=this.textLines.length,n=i*e,o={x:0,y:0};if(this.labelBackGround&&(o=this.getTextPostion(this.textCache.maxWidth,e),t.save(),t.DGraphRoundRect(o.x-5,o.y-1.45*e,this.textCache.maxWidth+10,n+e+(1==i?0:4),5),t.fillStyle="rgba(".concat(this.labelBackGround,",").concat(this.alpha,")"),t.fill(),t.restore()),0<this.labelBorderWidth&&(t.lineWidth=this.labelBorderWidth,t.strokeStyle="rgba(".concat(this.labelBorderColor,",").concat(this.alpha,")")),t.fillStyle="rgba(".concat(this.fontColor,",").concat(this.alpha,")"),1==i)o=this.getTextPostion(this.textCache.maxWidth,e),0<this.labelBorderWidth&&t.strokeText(this.textLines[0],o.x,o.y),t.fillText(this.textLines[0],o.x,o.y-1);else for(var s=0;s<i;s++)o=this.getTextPostion(t.measureText(this.textLines[s]).width,e),0<this.labelBorderWidth&&t.strokeText(this.textLines[s],o.x,o.y+s*e+(0==s?0:2*s)),t.fillText(this.textLines[s],o.x,o.y-1+s*e+(0==s?0:2*s));t.restore()}},this.paintNodeTags=function(i){var n,o,s,a,r;Array.isArray(this.tags)&&(n=this,s=o=0,a=Math.PI/6,r=n.radius+4,this.tags.forEach(function(t,e){o=r*Math.sin(-a*(e+1)+Math.PI),s=r*Math.cos(-a*(e+1)+Math.PI),n.paintTagText(i,t,{x:o,y:s})}))},this.paintTagText=function(t,e,i){t.save(),t.beginPath(),t.arc(i.x,i.y,8,0,2*Math.PI),t.fillStyle="rgba(".concat(this.tagColor||"230,30,30",",").concat(this.alpha,")"),t.fill(),t.lineWidth=1,t.strokeStyle="rgba(250,250,250,".concat(this.alpha,")"),t.stroke(),t.font="normal 8px Arial",t.fillStyle="rgba(250,250,250,".concat(this.alpha,")"),t.textAlign="center",t.textBaseline="middle",t.fillText(e.substr(0,1),i.x,i.y),t.restore()},this.processLabel=function(t){if(this.textCache.text!=this.label||this.textCache.font!=this.font){if(this.textLines=String(this.label).split("\n"),this.textCache.sigleWidth=t.measureText("国").width,this.textCache.font=this.font,this.textCache.lineCount=this.textLines.length,this.textCache.text=this.label,1==this.textLines.length)this.textCache.maxWidth=t.measureText(this.textLines[0]).width;else for(var e=0;e<this.textLines.length;e++)this.textCache.maxWidth=Math.max(t.measureText(this.textLines[e]).width,this.textCache.maxWidth);this.needUpdate=!0}},this.paintShadow=function(t){this.showShadow&&this.selected&&(t.shadowBlur=this.shadowBlur,t.shadowColor="rgba(".concat(this.shadowColor,",").concat(.9*this.alpha,")"),t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY)},this.paintHeadTip=function(t){var e,i,n;this.headTipText&&(n=this.headTipRadius||0,t.save(),t.font=this.headTipFont||"normal 13px Arial",e=t.measureText(this.headTipText).width+16,n=(i=t.measureText("田").width+16-2)/2<n?i/2:n,t.translate(-e/2,-i-this.height/2-6),t.beginPath(),t.arc(e-n,i-n,n,0,Math.PI/2),t.lineTo(e/2+4,i),t.lineTo(e/2,6+i),t.lineTo(e/2-4,i),t.lineTo(n,i),t.arc(n,i-n,n,Math.PI/2,Math.PI),t.lineTo(0,n),t.arc(n,n,n,Math.PI,3*Math.PI/2),t.lineTo(e-n,0),t.arc(e-n,n,n,3*Math.PI/2,2*Math.PI),t.lineTo(e,i-n),t.closePath(),t.fillStyle="rgba(".concat(this.headTipColor||"250,50,50",",").concat(this.alpha,")"),t.fill(),t.translate(e/2,i/2),t.textBaseline="middle",t.textAlign="center",t.fillStyle="rgba(".concat(this.headTipFontColor||"250,250,250",",").concat(this.alpha,")"),t.fillText(this.headTipText,0,0),t.restore())},this.getTextPostion=function(t,e){var i=null;switch(this.textPosition){case"Bottom_Center":i={x:-this.width/2+(this.width-t)/2,y:this.height/2+e};break;case"Middle_Center":i={x:-this.width/2+(this.width-t)/2,y:e/2};break;case"Top_Center":i={x:-this.width/2+(this.width-t)/2,y:-this.height/2-e/2};break;case"Top_Right":i={x:this.width/2,y:-this.height/2-e/2};break;case"Top_Left":i={x:-this.width/2-t,y:-this.height/2-e/2};break;case"Bottom_Right":i={x:this.width/2,y:this.height/2+e};break;case"Bottom_Left":i={x:-this.width/2-t,y:this.height/2+e};break;case"Middle_Right":i={x:this.width/2,y:e/2};break;case"Middle_Left":i={x:-this.width/2-t,y:e/2};break;default:i={x:-this.width/2+(this.width-t)/2,y:this.height/2+e}}return 0!=this.textOffsetX&&(i.x+=this.textOffsetX),0!=this.textOffsetY&&(i.y+=this.textOffsetY),i},this.setImage=function(t,e){var i,n,o;t&&(i=this,null==(n=O.imgStore[t])?"string"==typeof t?((o=new Image).setAttribute("crossOrigin","Anonymous"),o.src=t,o.onload=function(){i.image=o,"function"==typeof e&&e()},O.imgStore[t]=o):(this.image=t,this.setSize(t.width,t.height)):i.image=n)},this.removeHandler=function(e){var i=this;this.outLinks&&(this.outLinks.forEach(function(t){t.source===i&&e.remove(t)}),this.outLinks=null),this.inLinks&&(this.inLinks.forEach(function(t){t.target===i&&e.remove(t)}),this.inLinks=null)}}function $(t){this.initialize=function(t){$.prototype.initialize.apply(this,arguments),this.elementType="node",this.nodeType="custome",this.zIndex=O.Node_zIndex,Object.assign(this,J),this.icon=null,this.imageOffsetX=0,this.imageOffsetY=0,this.padding=0,this.customeTemplate=t||[],this.needCheckElements=((null==(t=this.customeTemplate)?void 0:t.elements)||[]).filter(function(t){return!!t.isInBound})},this.initialize(t),this.paint=function(i,t){var n;this.drawOriginalNode(i,t),t||(t=(null==(t=this.customeTemplate)?void 0:t.elements)||[],n=this,t.forEach(function(t){var e=t.type,t=t.attrs;i.save(),n.drawNodeElement(i,e,t,n),i.restore()}))},this.drawNodeElement=function(t,e,i,n){switch(e){case"circle":case"rect":t.beginPath(),"circle"==e?t.arc(i.x,i.y,i.radius,0,2*Math.PI,!1):t.rect(i.x,i.y,i.width,i.height),i.fillColor&&("function"==typeof i.fillColor?t.fillStyle=i.fillColor(n)||"#fff":t.fillStyle=i.fillColor,t.fill()),i.borderWidth&&(t.lineWidth=i.borderWidth,t.strokeStyle=i.borderColor||"#fff",t.stroke());break;case"line":t.beginPath(),t.moveTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.lineWidth=i.lineWidth||1,t.strokeStyle=i.color||"#fff",t.stroke();break;case"text":t.font=i.font||"13px Arial",t.fillStyle=i.color||"#444",t.textAlign=i.textAlign||"center",t.textBaseline=i.textBaseline||"middle","function"==typeof i.content?t.fillText(i.content(n)||" ",i.x,i.y):t.fillText(i.content||" ",i.x,i.y);break;case"image":(o="function"==typeof i.imageUrl?i.imageUrl(n):i.imageUrl)&&(o=n.getElementImage(o))&&t.drawImage(o,i.x,i.y,i.width,i.height);break;case"defined":var o=i.drawFunction;"function"==typeof o&&o(t,n)}},this.drawNodeImg=function(t,e,i,n,o){var s;e&&e.width&&(s=this.padding/2,"rect"==this.shape?t.drawImage(e,i+this.imageOffsetX+s,n+this.imageOffsetY+s,this.width-this.padding,this.height-this.padding):(o=2<o?o:2)<e.width/2?(this.paintShape(t),t.clip(),t.drawImage(e,i+this.imageOffsetX+s,n+this.imageOffsetY+s,this.width-this.padding,this.height-this.padding)):t.drawImage(e,-e.width/2+s,-e.height/2+s,e.width-this.padding,e.height-this.padding))},this.drawOriginalNode=function(t,e){this.drawShape(t,e),this.image&&!e&&(e=t.globalAlpha,t.save(),t.globalAlpha=this.alpha,this.drawNodeImg(t,this.image,-this.width/2,-this.height/2,this.width/2),t.globalAlpha=e,t.restore())},this.drawShape=function(t,e){t.save(),t.beginPath(),this.paintShape(t),e?this.fillStyle?(t.fillStyle=this.fillStyle,t.fill()):this.fillColor?(t.fillStyle="rgba(".concat(this.fillColor,",").concat(this.alpha,")"),t.fill()):(t.lineWidth=this.borderWidth,t.strokeStyle="rgba(".concat(this.borderColor,",").concat(this.alpha,")"),t.stroke()):((this.fillColor||e)&&(this.paintShadow(t),t.fillStyle=this.fillStyle||"rgba(".concat(this.fillColor,",").concat(this.alpha,")"),t.fill()),this.lineDash&&1<this.lineDash.length&&t.setLineDash(this.lineDash),this.showSelected||this.selected?0<this.selectedBorderWidth&&(t.lineWidth=this.selectedBorderWidth,t.strokeStyle="rgba(".concat(this.selectedBorderColor,",").concat(this.alpha,")"),t.stroke()):0<this.borderWidth&&(t.lineWidth=this.borderWidth,t.strokeStyle=this.strokeStyle||"rgba(".concat(this.borderColor,",").concat(this.alpha,")"),t.stroke())),t.restore()},this.paintShape=function(t){switch(this.shape){case"rect":this.borderRadius?t.DGraphRoundRect(-this.width/2,-this.height/2,this.width,this.height,this.borderRadius):t.rect(-this.width/2,-this.height/2,this.width,this.height);break;case"circle":this.radius=this.radius<2?2:this.radius,t.arc(0,0,this.radius,0,2*Math.PI,!1);break;default:this.radius=this.radius<2?2:this.radius,t.rect(-this.radius,-this.radius,2*this.radius,2*this.radius)}},this.paintShadow=function(t){this.showShadow&&this.selected&&(t.shadowBlur=this.shadowBlur,t.shadowColor="rgba(".concat(this.shadowColor,",").concat(.9*this.alpha,")"),t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY)},this.getElementImage=function(t){var e,i,n;if(t)return null!=(e=O.imgStore[t])?e:(i=this,"string"==typeof t&&((n=new Image).setAttribute("crossOrigin","Anonymous"),n.src=t,n.onload=function(){O.imgStore[t]=n,i.drawFinished()}),null)},this.setImage=function(t,e){var i,n,o;t&&(i=this,null==(n=O.imgStore[t])?"string"==typeof t?((o=new Image).setAttribute("crossOrigin","Anonymous"),o.src=t,o.onload=function(){i.image=o,"function"==typeof e&&e()},O.imgStore[t]=o):(this.image=t,this.setSize(t.width,t.height)):i.image=n)},this.drawFinished=function(){},this.isInBound=function(t,e){for(var i,n,o,s,a,r,h=0;h<this.needCheckElements.length;h++)if(this.needCheckElements[h].isInBound(this,t,e))return!0;return"rect"==this.shape?(i=this.width*this.scale,n=this.height*this.scale,0==this.rotate?t>this.cx-i/2&&t<this.cx+i/2&&e>this.cy-n/2&&e<this.cy+n/2:(r=this.cx,o=this.cy,s=-this.rotate*Math.PI/180,a=(t-r)*Math.cos(s)-(e-o)*Math.sin(s)+r,r=(t-r)*Math.sin(s)+(e-o)*Math.cos(s)+o,a>this.cx-i/2&&a<this.cx+i/2&&r>this.cy-n/2&&r<this.cy+n/2)):(t-this.cx)*(t-this.cx)+(e-this.cy)*(e-this.cy)<this.radius*this.scale*this.radius*this.scale},this.removeHandler=function(e){var i=this;this.outLinks&&(this.outLinks.forEach(function(t){t.source===i&&e.remove(t)}),this.outLinks=null),this.inLinks&&(this.inLinks.forEach(function(t){t.target===i&&e.remove(t)}),this.inLinks=null)}}function w(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this.nodes=t,this.links=e,this.center=[1e3,600],this.alpha=.99,this.friction=.8,this.linkDistance=120,this.linkStrength=.03,this.charge=-300,this.gravity=.01,this.theta=.9,this.distances=[],this.strengths=[],this.charges=[],this.noverlap=!1,this.inited=!1,this.finished=!1,this.getConfig=function(){return[{label:"斥力",friction:.8},{label:"边长度",linkDistance:120},{label:"边强度",linkStrength:.03},{label:"引力",charge:-300},{label:"重力",gravity:.01},{label:"避免重叠",noverlap:[{label:"否",value:"false"},{label:"是",value:"true"}]}]},this.addData=function(t,e){this.nodes=t,this.links=e},this.resetConfig=function(t){t&&(this.friction=Number(t.friction)||.8,this.linkDistance=Number(t.linkDistance)||120,this.linkStrength=Number(t.linkStrength)||.03,this.charge=Number(t.charge)||-300,this.gravity=Number(t.gravity)||.01,this.noverlap=Boolean(t.noverlap)||!1,this.center=t.center||[1e3,600]),this.init()},this.excute=function(){if(this.inited)for(var t=0;t++<3;)this.tick()},this.init=function(){var t,e,i=this.nodes.length,n=this.links.length;for(this.charges=[],t=0;t<i;++t)(e=this.nodes[t]).index=t,e.weight=0,e.px=e.x,e.py=e.y,this.charges[t]=this.charge;for(t=0;t<n;++t){var o=(e=this.links[t]).source,s=e.target;this.distances[t]=this.linkDistance,this.strengths[t]=this.linkStrength,++o.weight,++s.weight}this.inited=!0},this.alpha1=function(t){return arguments.length?(this.alpha?this.alpha=0<t?t:0:0<t&&this.tick(),this):this.alpha},this.resume=function(){return this.alpha1(.8)},this.stop=function(){return this.alpha1(0)},this.tick=function(){var l=this;if((l.alpha*=.99)<.001)l.alpha=.01,l.finished=!0;else{for(var t,e,i,n,o,s,a,r,h=l.nodes.length,c=l.links.length,u=0;u<c;++u)i=(e=l.links[u]).source,(o=(a=(n=e.target).x-i.x)*a+(r=n.y-i.y)*r)&&(a*=o=l.alpha*l.strengths[u]*((o=Math.sqrt(o))-l.distances[u])/o,r*=o,n.x-=a*(s=i.weight/(n.weight+i.weight)),n.y-=r*s,i.x+=a*(s=1-s),i.y+=r*s);if((s=l.alpha*l.gravity)&&(a=l.center[0],r=l.center[1],u=-1,s))for(;++u<h;)(e=l.nodes[u]).x+=(a-e.x)*s,e.y+=(r-e.y)*s;if(l.charge)for(l.forceAccumulate(t=l.quadtree(l.nodes),l.alpha,l.charges),u=-1;++u<h;)(e=l.nodes[u]).fixed||t.visit(function(c){return function(t,e,i,n,o){if(t.point!==c){var s,a=t.cx-c.x,r=t.cy-c.y,h=1/Math.sqrt(a*a+r*r);if((n-e)*h<l.theta)return s=t.charge*h*h,c.px-=a*s,c.py-=r*s,!0;t.point&&isFinite(h)&&(s=t.pointCharge*h*h,c.px-=a*s,c.py-=r*s)}return!t.charge}}(e));for(u=-1;++u<h;)(e=l.nodes[u]).fixed?(e.x=e.px,e.y=e.py):(e.x-=(e.px-(e.px=e.x))*l.friction,e.y-=(e.py-(e.py=e.y))*l.friction,l.noverlap&&t.visit(function(c){var l=c.radius+20,u=c.x-l,d=c.x+l,f=c.y-l,g=c.y+l;return function(t,e,i,n,o){var s,a,r,h;return t.point&&t.point!==c&&(s=c.x-t.point.x,a=c.y-t.point.y,0==s&&0==a&&(c.x=c.x+Math.round(10*Math.random()),c.y=c.y+Math.round(10*Math.random()),s=c.x-t.point.x,a=c.y-t.point.y),(r=Math.sqrt(s*s+a*a))<(h=l+t.point.radius))&&(c.x-=s*=r=(r-h)/r*.5,c.y-=a*=r,t.point.x+=s,t.point.y+=a),d<e||n<u||g<i||o<f}}(e)))}},this.forceAccumulate=function(t,e,i){var n,o=0,s=0;if(t.charge=0,!t.leaf)for(var a,r=t.nodes,h=r.length,c=-1;++c<h;)null!=(a=r[c])&&(this.forceAccumulate(a,e,i),t.charge+=a.charge,o+=a.charge*a.cx,s+=a.charge*a.cy);t.point&&(t.leaf||(t.point.x+=Math.random(),t.point.y+=Math.random()),n=this.alpha*this.charges[t.point.index],t.charge+=t.pointCharge=n,o+=n*t.point.x,s+=n*t.point.y),t.cx=o/t.charge,t.cy=s/t.charge},this.quadtree=function(t){var e,i=-1,n=t.length;n&&isNaN(t[0].x)&&(t=t.map(function(t){return{x:t[0],y:t[1]}}));for(var o=1/0,s=1/0,a=-1/0,r=-1/0;++i<n;)(e=t[i]).x<o&&(o=e.x),e.y<s&&(s=e.y),e.x>a&&(a=e.x),e.y>r&&(r=e.y);var h=a-o,c=r-s;function u(t,e,i,n,o,s){var a;isNaN(e.x)||isNaN(e.y)||(t.leaf?(a=t.point)?(Math.abs(a.x-e.x)+Math.abs(a.y-e.y)<.1||(t.point=null,l(t,a,i,n,o,s)),l(t,e,i,n,o,s)):t.point=e:l(t,e,i,n,o,s))}function l(t,e,i,n,o,s){var a=.5*(i+o),r=.5*(n+s),h=e.x>=a,c=e.y>=r,l=(c<<1)+h;t.leaf=!1,h?i=a:o=a,c?n=r:s=r,u(t=t.nodes[l]||(t.nodes[l]={leaf:!0,nodes:[],point:null}),e,i,n,o,s)}c<h?r=s+h:a=o+c;var d={leaf:!0,nodes:[],point:null,add:function(t){u(d,t,o,s,a,r)},visit:function(t){!function t(e,i,n,o,s,a){var r,h;e(i,n,o,s,a)||(r=.5*(n+s),h=.5*(o+a),(i=i.nodes)[0]&&t(e,i[0],n,o,r,h),i[1]&&t(e,i[1],r,o,s,h),i[2]&&t(e,i[2],n,h,r,a),i[3]&&t(e,i[3],r,h,s,a))}(t,d,o,s,a,r)}};return t.forEach(d.add),d}}function tt(){this.nodes=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],this.nodeSpace=120,this.layerSpace=120,this.center=[100,100],this.splitType=2,this.boolTransition=!0,this.intSteps=50,this.inited=!1,this.finished=!1,this.finishedCount=0,this.getConfig=function(){return[{label:"水平间距",nodeSpace:120},{label:"垂直间距",layerSpace:120}]},this.resetConfig=function(t){t&&(this.nodeSpace=Number(t.nodeSpace)||120,this.layerSpace=Number(t.layerSpace)||120,this.center=t.center||[100,100],this.splitType=Number(t.splitType)||2,this.init())},this.addData=function(){this.nodes=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]},this.newLayoutData=function(){return{finishx:0,finishy:0,xdistance:0,ydistance:0}},this.excute=function(){this.inited&&this.run()},this.init=function(){var t=[].concat(this.nodes),e=(t.sort(function(t,e){return(e.inLinks||[]).length+(e.outLinks||[]).length-((t.inLinks||[]).length+(t.outLinks||[]).length)}),this.nodes.length),i=Math.round(Math.sqrt(e))+1,n=Math.round(Math.sqrt(e))+1,o=0,s=0,a=0,r=0;r=1==this.splitType?(a=this.center[0]-(o=i)/2*this.nodeSpace+this.nodeSpace,this.center[1]-(s=n)/2*this.layerSpace+this.layerSpace):(i=(o=Math.round(Math.sqrt(e/2))+1)-i,n=(s=Math.round(2*o)+1)-n,a=this.center[0]-o/2*this.nodeSpace+i*this.nodeSpace,this.center[1]-s/2*this.layerSpace+n*this.layerSpace);for(var h,c,l,u,d=0,f=0;f<o;f++)for(var g=0;g<s;g++)e<=d||(h=f*this.nodeSpace,c=g*this.layerSpace,c+=a,h+=r,l=t[d++],(u=this.newLayoutData()).finishx=c,u.finishy=h,u.xdistance=1/this.intSteps*(c-l.x),u.ydistance=1/this.intSteps*(h-l.y),l.layoutData=u);this.inited=!0,this.finishedCount=0},this.run=function(){for(var t,e=this.nodes,i=e.length,n=0;n<i;n++){var o,s=e[n];null!=(t=s.layoutData)&&(this.boolTransition?(o=Math.abs(s.x-t.finishx),Math.abs(s.x+t.xdistance-t.finishx)<o?s.x+=t.xdistance:s.x=t.finishx,o=Math.abs(s.y-t.finishy),Math.abs(s.y+t.ydistance-t.finishy)<o?s.y+=t.ydistance:s.y=t.finishy,s.x==t.finishx&&s.y==t.finishy&&(s.layoutData=null,this.finishedCount++)):(s.x=t.finishx,s.y=t.finishy,s.layoutData=null,this.finishedCount++))}this.finished=this.finishedCount>=i}}function et(){var l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this.nodes=l,this.links=t,this.boolTransition=!0,this.scale=1.1,this.center=[0,0],this.ordering="degree",this.intSteps=50,this.inited=!1,this.finished=!1,this.finishedCount=0,this.getConfig=function(){return[{label:"中心位置",center:[0,0]},{label:"间隔比例",scale:1.1},{label:"排序方式",ordering:"degree"}]},this.resetConfig=function(t){t&&(this.center=t.center||[0,0],this.ordering=t.ordering||"degree",this.scale=Number(t.scale)||1.1),this.init()},this.addData=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this.nodes=t,this.links=e},this.newLayoutData=function(){return{finishx:0,finishy:0,xdistance:0,ydistance:0}},this.init=function(){var i,n,o,s=this,t=[],e=("degree"==s.ordering?(t=t.concat(s.nodes)).sort(function(t,e){return(e.inLinks||[]).length+(e.outLinks||[]).length-((t.inLinks||[]).length+(t.outLinks||[]).length)}):t="topology"==s.ordering?s.topologyOrdering():l,0),a=(t.forEach(function(t){e+=t.scale*t.radius*2*s.scale}),(e*=s.scale)/Math.PI),r=2*Math.PI/e,h=0,c=a/2;t.forEach(function(t){i=t.scale*t.radius*2,o=r*i*s.scale,n=s.center[0]+c*Math.cos(h+o),o=s.center[1]+c*Math.sin(h+o),h+=i*s.scale*r*s.scale;var e=s.newLayoutData();e.finishx=n,e.finishy=o,e.xdistance=1/s.intSteps*(n-t.x),e.ydistance=1/s.intSteps*(o-t.y),t.layoutData=e}),this.inited=!0,this.finishedCount=0},this.topologyOrdering=function(){var r=this,h=r.links,c=r.nodes,l={},u=(c.forEach(function(t,e){l[t.id]=e}),r.getDegree(c.length,l,h)),d=(r.degrees=u,[c[0]]),f=c.length,g=[],p=(r.initHierarchy(c,h,l,!(g[0]=!0)),0);return c.forEach(function(t,e){if(0!==e)if(e!==f-1&&u[e]===u[e+1]&&!r.connect(d[p],t,h)||!0===g[e]){for(var i=d[p].children,n=!1,o=0;o<i.length;++o){var s=l[i[o].id];if(u[s]===u[e]&&!0!==g[s]){d.push(c[s]),n=g[s]=!0;break}}for(var a=0;!n&&(g[a]||(d.push(c[a]),n=g[a]=!0),++a!==f););}else d.push(t),g[e]=!0,p++}),d},this.excute=function(){this.inited&&this.run()},this.initHierarchy=function(i,t,n,e){i.forEach(function(t,e){t.children=[],t.parent=[]}),e?t.forEach(function(t){var e=n[t.source.id],t=n[t.target.id];i[e].children.push(i[t]),i[t].parent.push(i[e])}):t.forEach(function(t){var e=n[t.source.id],t=n[t.target.id];i[e].children.push(i[t]),i[t].children.push(i[e])})},this.connect=function(t,e,i){for(var n=i.length,o=0;o<n;o++)if(t.id===i[o].source.id&&e.id===i[o].target.id||e.id===i[o].source.id&&t.id===i[o].target.id)return!0;return!1},this.getDegree=function(t,e,i){for(var n=[],o=0;o<t;o++)n[o]=0;return i.forEach(function(t){n[e[t.source.id]]+=1,n[e[t.target.id]]+=1}),n},this.run=function(){for(var t,e=this.nodes,i=e.length,n=0;n<i;n++){var o,s=e[n];null!=(t=s.layoutData)&&(this.boolTransition?(o=Math.abs(s.x-t.finishx),Math.abs(s.x+t.xdistance-t.finishx)<o?s.x+=t.xdistance:s.x=t.finishx,o=Math.abs(s.y-t.finishy),Math.abs(s.y+t.ydistance-t.finishy)<o?s.y+=t.ydistance:s.y=t.finishy,s.x==t.finishx&&s.y==t.finishy&&(s.layoutData=null,this.finishedCount++)):(s.x=t.finishx,s.y=t.finishy,s.layoutData=null,this.finishedCount++))}this.finished=this.finishedCount>=i}}function it(){var t=null;switch(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"fastLayout"){case"fastForce":t=new w([],[]);break;case"grid":t=new tt([]);break;case"circle":t=new et([],[]);break;default:t=new w([],[])}return t}function nt(){this.nodes=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],this.maxPadding=10,this.inited=!1,this.maxIterations=0,this.finished=!1,this.excute=function(){this.inited&&this.run()},this.getConfig=function(){return[{label:"间距",maxPadding:this.maxPadding}]},this.resetConfig=function(t){t&&(this.maxPadding=Number(t.maxPadding)||5,this.maxPadding<0)&&(this.maxPadding=0),this.init()},this.addData=function(){this.nodes=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]},this.init=function(){this.inited=!0,this.maxIterations=0},this.run=function(){var t,e,i=this;i.inited&&(t=i.nodes.length/2,i.maxIterations++<t?(e=i.quadtree(i.nodes),i.nodes.forEach(function(t){var c,l,u,d,f,g;e.visit((l=(c=t).radius*c.scale*2+i.maxPadding,u=c.x-l,d=c.x+l,f=c.y-l,g=c.y+l,function(t,e,i,n,o){var s,a,r,h;return t.point&&t.point!==c&&(s=c.x-t.point.x,a=c.y-t.point.y,0==s&&0==a&&(c.x=c.x+Math.round(10*Math.random()),c.y=c.y+Math.round(10*Math.random()),s=c.x-t.point.x,a=c.y-t.point.y),(r=Math.sqrt(s*s+a*a))<(h=l+t.point.radius))&&(c.x-=s*=r=(r-h)/r*.5,c.y-=a*=r,t.point.x+=s,t.point.y+=a),d<e||n<u||g<i||o<f}))})):i.finished=!0)},this.quadtree=function(t){var e,i=-1,n=t.length;n&&isNaN(t[0].x)&&(t=t.map(function(t){return{x:t[0],y:t[1]}}));for(var o=1/0,s=1/0,a=-1/0,r=-1/0;++i<n;)(e=t[i]).x<o&&(o=e.x),e.y<s&&(s=e.y),e.x>a&&(a=e.x),e.y>r&&(r=e.y);var h=a-o,c=r-s;function u(t,e,i,n,o,s){var a;isNaN(e.x)||isNaN(e.y)||(t.leaf?(a=t.point)?(Math.abs(a.x-e.x)+Math.abs(a.y-e.y)<.01||(t.point=null,l(t,a,i,n,o,s)),l(t,e,i,n,o,s)):t.point=e:l(t,e,i,n,o,s))}function l(t,e,i,n,o,s){var a=.5*(i+o),r=.5*(n+s),h=e.x>=a,c=e.y>=r,l=(c<<1)+h;t.leaf=!1,h?i=a:o=a,c?n=r:s=r,u(t=t.nodes[l]||(t.nodes[l]={leaf:!0,nodes:[],point:null}),e,i,n,o,s)}c<h?r=s+h:a=o+c;var d={leaf:!0,nodes:[],point:null,add:function(t){u(d,t,o,s,a,r)},visit:function(t){!function t(e,i,n,o,s,a){var r,h;e(i,n,o,s,a)||(r=.5*(n+s),h=.5*(o+a),(i=i.nodes)[0]&&t(e,i[0],n,o,r,h),i[1]&&t(e,i[1],r,o,s,h),i[2]&&t(e,i[2],n,h,r,a),i[3]&&t(e,i[3],r,h,s,a))}(t,d,o,s,a,r)}};return t.forEach(d.add),d}}y.prototype=new e,$.prototype=new e;function ot(n,t){var i,e,o,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{x:0,y:0},a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"fastForce",r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,h=5<arguments.length?arguments[5]:void 0,c=s.x,s=s.y,l=t.nodes||[],t=t.links||[],u=new Map,d=new Map,f=[],g=(l.forEach(function(t,e){i=e+1,d.set(t.id,i),u.set(i,t),f.push({id:i,scale:1,radius:Math.ceil(t.radius*(t.scale||1)),x:t.cx,y:t.cy,type:t.type||"default",selected:t.selected||!1,definedLevel:t.definedLevel})}),{}),p=[],y=(t.forEach(function(t){t.source.id!=t.target.id&&(e="".concat(t.source.id,"-").concat(t.target.id),o="".concat(t.target.id,"-").concat(t.source.id),g[e]&&g[o]||(p.push({source:d.get(t.source.id),target:d.get(t.target.id),weight:t.weight}),g[e]=!0,g[o]=!0))}),Math.round(Math.max(Math.sqrt(f.length)+10,20))),m=(l=function(t){var e="",i="";switch(t){case"fastForce":e=w.toString(),i=nt.toString();break;case"circle":e=et.toString();break;case"grid":e=tt.toString();break;default:e=w.toString(),i=nt.toString()}return t=e.indexOf("("),e="function Layout"+e.substring(t),0<i.length&&(t=i.indexOf("("),i="function AvoidOverlap"+i.substring(t))," ".concat(e," ").concat(i," ").concat("\n\nonmessage = function(event) {\n\t//获取主线程传输的数据\n\tvar array_buffer = new Uint8Array(event.data).buffer;\n\tvar decoder = new TextDecoder(\"utf-8\");\n\tvar view = new DataView(array_buffer, 0, array_buffer.byteLength);\n\tvar eventData = JSON.parse(decoder.decode(view));\n\t\n\tvar layoutType = eventData.layoutType || 'fastForce', //布局类型\n\t\tlayoutConfig = eventData.layoutConfig, //布局参数配置\n\t\tcenter=eventData.center||[0,0],  // 中心位置\n\t\ttotalTimes=eventData.totalTimes || 50; //计算次数\n\t\n\t//构建布局数据格式\n\tlet {nodes,links} = buildLayoutData(eventData.nodes,eventData.links);\n\t\n\t//如果节点数过多，需要布局类型进度调整\n\tif(nodes.length >= 1000 && layoutType=='kawakai'){\n\t\tlayoutType = 'fastForce';\n\t}\n\t\n\t//创建布局对象\n\tlet layout = new Layout(nodes,links);\n\t\n\tif(layoutType == 'fastForce'){\n\t\tif(layoutConfig){\n\t\t\tlayoutConfig['noverlap'] = true;\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({\n\t\t\t\tfriction:0.8,\n\t\t\t\tlinkDistance:100,\n\t\t\t\tlinkStrength:0.03,\n\t\t\t\tcharge:-200,\n\t\t\t\tgravity:0.01,\n\t\t\t\tnoverlap:true,\n\t\t\t\tcenter:center\n\t\t\t});\n\t\t}\n\t}\n\telse if(layoutType == 'simulation'){\n\t\tif(layoutConfig){\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({\n\t\t\t\tstrength:-1500,\n\t\t\t\tajustCluster:false,\n\t\t\t\tcenter:center\n\t\t\t});\n\t\t}\n\t}\n\telse if(layoutType == 'kawakai'){\n\t\t if(layoutConfig){\n\t\t \tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({sizeScale:1.5,center:center});\n\t\t}\n\t}\n\telse if(layoutType == 'grid'){\n\t\tif(layoutConfig){\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({nodeSpace:120,layerSpace:120,splitType:2,center:center});\n\t\t}\n\t\tlayout.boolTransition = false;\n\t\ttotalTimes = 1;\n\t}\n\telse if(layoutType == 'concentric'){\n\t\tif(layoutConfig){\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({maxNodeSize:80,levelWidth:1,center:center});\n\t\t}\n\t\tlayout.boolTransition = false;\n\t\ttotalTimes = 1;\n\t}\n\telse if(layoutType == 'circle'){\n\t\tif(layoutConfig){\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({scale:1.2,ordering:'degree',center:center});\n\t\t}\n\t\tlayout.boolTransition = false;\n\t\ttotalTimes = 1;\n\t}\n\telse if(layoutType == 'radialTree'){\n\t\tlayout.resetConfig({center:center});\n\t\tlayout.boolTransition = false;\n\t\ttotalTimes = 1;\n\t}\n\telse if(layoutType == 'forceDirected'){\n\t\tlayout.resetConfig({center:center});\n\t}\n\telse if(layoutType == 'hierarchical'){\n\t\tif(layoutConfig){\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({nodeSpace:100,layerSpace:160,sortType:'hubsize',direction: 'UD',center:center});\n\t\t}\n\t\tlayout.boolTransition = false;\n\t\ttotalTimes = 1;\n\t}else if(layoutType == 'arf'){\n\t\tif(layoutConfig){\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({neighberForce:8.0,attraction:0.05,forceScale:8.0,center:center});\n\t\t}\n\t\ttotalTimes += 50;\n\t}else if(layoutType == 'tree'){\n\t\tif(layoutConfig){\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({nodeSpace:100,layerSpace:160,direction: 'UD',center:center});\n\t\t}\n\t\tlayout.boolTransition = false;\n\t\ttotalTimes = 1;\n\t}else if(layoutType == 'cluster'){\n\t\tif(layoutConfig){\n\t\t\tlayout.resetConfig(layoutConfig);\n\t\t}else{\n\t\t\tlayout.resetConfig({area:5,speed:10,center:center});\n\t\t}\n\t}else{\n\t\tlayout.init();\n\t}\n\t\n\t//布局次数计数器\n\tlet layoutTimes=0;\n\n\t//执行n次布局\n\twhile(layoutTimes++ < totalTimes){\n\t\tvar index = 0;\n\t\twhile(index++ < 10){\n\t\t\tlayout.excute(); //执行布局算法\n\t\t}\n\t\tpostMessage({type: \"ticked\", counter:layoutTimes});\n\t}\n\n\t//对数据进行缩放\n\t// if(['kawakai'].indexOf(layoutType) != -1){\n\t// \tnodes = coordsScale(nodes,1.6);\n\t// }\n\n\t//当节点大于100并且为网络布局时，调整节点尽量避免重叠\n\t// if(nodes.length > 100 && ['fastForce','kawakai'].indexOf(layoutType) != -1){\n\t// \tpostMessage({type: \"ticked\", counter:layoutTimes-1});\n\t// \toverlapLayout(nodes);\n\t// }\n\t\n\tvar finishedNodes = nodes.map(function(node){\n\t\treturn {\n\t\t\tid:node.id,\n\t\t\tx: Math.round(node.x),\n\t\t\ty: Math.round(node.y)\n\t\t};\n\t});\n\t\n\tpostMessage({type: \"completed\", nodes:finishedNodes});\n\tself.close();\n\n\t//避免重叠的调整布局\n\tfunction overlapLayout(nodes){\n\t\tvar overlap= new AvoidOverlap({nodes:nodes});\n\t\toverlap.resetConfig({maxPadding:10});\n\n\t\tvar overlapTime = Math.min(Math.round(Math.sqrt(nodes.length)),200);\n\t\tvar index = 0;\n\t\twhile(index++ < overlapTime){\n\t\t\toverlap.excute();\n\t\t}\n\t};\n\n\t//图缩放比例\n\tfunction coordsScale(_nodes,scale){\n\t\tvar nodeCount = nodes.length;\n        var xMean = 0,yMean = 0;\n\t\t_nodes.forEach(function(n) {\n            xMean += n.x;\n            yMean += n.y\n        });\n        xMean /= nodeCount;\n        yMean /= nodeCount;\n        _nodes.forEach(function(node) {\n            node.x = xMean + ((node.x - xMean) * scale);\n            node.y = yMean + ((node.y - yMean) * scale);\n        });\n\t\treturn _nodes;\n\t};\n\t\n\t//构建可视化布局数据\n\tfunction buildLayoutData(_nodes=[],_links=[]){\n\t\tvar nodeIdMapNode= new Map();\n\t\t_nodes.forEach(function(n){\n\t\t\tn.scale = 1;\n\t\t\tn.radius=Math.ceil(n.radius*(n.scale?n.scale:1));\n\t\t\tn.x = n.x || Math.round(Math.random()*1000);\n\t\t\tn.y = n.y || Math.round(Math.random()*1000);\n\t\t\tn.selected = n.selected || false;\n\t\t\tn.cluster = n.cluster;\n\t\t\t\n\t\t\tnodeIdMapNode.set(n.id,n);\n\t\t});\n\t\t\n\t\tvar links=[];\n\t\t_links.forEach(function(l){\n\t\t\tvar sourceNode = nodeIdMapNode.get(l.source),\n\t\t\t\ttargetNode = nodeIdMapNode.get(l.target);\n\t\t\n\t\t\tif(sourceNode){\n\t\t\t\tsourceNode.outLinks=sourceNode.outLinks||[];\n\t\t\t\tsourceNode.outLinks.push({\n\t\t\t\t\tsource:sourceNode,\n\t\t\t\t\ttarget:targetNode\n\t\t\t\t});\n\t\t\t}\n\t\t\n\t\t\tif(targetNode){\n\t\t\t\ttargetNode.inLinks=targetNode.inLinks||[];\n\t\t\t\ttargetNode.inLinks.push({\n\t\t\t\t\tsource:sourceNode,\n\t\t\t\t\ttarget:targetNode\n\t\t\t\t});\n\t\t\t}\n\t\t\n\t\t\tlinks.push({\n\t\t\t\tsource:sourceNode,\n\t\t\t\ttarget:targetNode\n\t\t\t});\n\t\t});\n\t\t\n\t\tvar newNodes = [];\n\t\tnodeIdMapNode.forEach(function(value, key) {\n\t\t\tnewNodes.push(value);\n\t\t});\n\t\t\n\t\treturn {nodes:newNodes,links:links};\n\t}\n};\n\n")}(a),t=window.URL||window.webkitURL,l=new Blob([l],{type:"text/javascript"}),t=t.createObjectURL(l),new Worker(t)),l=new TextEncoder("utf-8").encode(JSON.stringify({totalTimes:y,nodes:f,links:p,center:[c,s],layoutType:a,layoutConfig:r}));function v(t){var e;t.nodes.forEach(function(t){(e=u.get(t.id)).cx=t.x,e.cy=t.y}),m.terminate(),n.hideLoadProcess(),"function"==typeof h&&h()}m.postMessage(l.buffer,[l.buffer]),m.onmessage=function(t){switch(t.data.type){case"ticked":return e=1<(e=(e=t.data).counter/y)?.999:e,i=Math.floor(100*e)+"%",void n.showLoadProcess("布局进度:(".concat(i,")"),e.toFixed(2));case"completed":return v(t.data)}var e,i}}function st(){var e,n,i,c={},l={},u=[];function d(t){var i={};return t.forEach(function(t,e){i[t]=!0}),Object.keys(i)}function f(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(t[e]);return i}function g(n,o){var t=n._assoc_mat[o]?Object.keys(n._assoc_mat[o]):[],s=0;return t.forEach(function(t,e){var i=n._assoc_mat[o][t]||1;o===t&&(i*=2),s+=i}),s}function v(t,e){return void 0===t._assoc_mat[e]?[]:Object.keys(t._assoc_mat[e])}function p(t,e,i){return t._assoc_mat[e]?t._assoc_mat[e][i]:void 0}function y(t){if(null===t||"object"!==C(t))return t;var e,i=t.constructor();for(e in t)i[e]=y(t[e]);return i}function m(a,r,h){var e;r.nodes_to_com={},r.total_weight=0,r.internals={},r.degrees={},r.gdegrees={},r.loops={},r.total_weight=(e=0,a.edges.forEach(function(t){e+=t.weight}),e),void 0===h?a.nodes.forEach(function(t,e){r.nodes_to_com[t]=e;var i=g(a,t);if(i<0)throw"Bad graph type, use positive weights!";r.degrees[e]=i,r.gdegrees[t]=i,r.loops[t]=p(a,t,t)||0,r.internals[e]=r.loops[t]}):a.nodes.forEach(function(n,t){var o=h[n],e=(r.nodes_to_com[n]=o,g(a,n)),s=(r.degrees[o]=(r.degrees[o]||0)+e,r.gdegrees[n]=e,0);v(a,n).forEach(function(t,e){var i=a._assoc_mat[n][t];if(i<=0)throw"Bad graph type, use positive weights";h[t]===o&&(s+=t===n?i:i/2)}),r.internals[o]=(r.internals[o]||0)+s})}function x(n){var o=n.total_weight,s=0;return d(f(n.nodes_to_com)).forEach(function(t,e){var i=n.internals[t]||0,t=n.degrees[t]||0;0<o&&(s=s+i/o-Math.pow(t/(2*o),2))}),s}function w(n){var o=0,s=y(n),a={};return Object.keys(n).forEach(function(t){var e=n[t],i=void 0===a[e]?-1:a[e];-1===i&&(i=a[e]=o,o+=1),s[t]=i,u.push([y(s)])}),s}function b(p,y){for(var t,m=!0,e=0,i=x(y);m&&-1!==e&&(t=i,m=!1,e+=1,p.nodes.forEach(function(t,e){var n,o,s,a,i,r,h,c,l=y.nodes_to_com[t],u=(y.gdegrees[t]||0)/(2*y.total_weight),d=(s=y,a={},v(o=p,n=t).forEach(function(t,e){var i;t!==n&&(i=o._assoc_mat[n][t]||1,t=s.nodes_to_com[t],a[t]=(a[t]||0)+i)}),a),f=(c=t,r=d[i=l]||0,(h=y).degrees[i]=(h.degrees[i]||0)-(h.gdegrees[c]||0),h.internals[i]=(h.internals[i]||0)-r-(h.loops[c]||0),h.nodes_to_com[c]=-1,l),g=0;Object.keys(d).forEach(function(t,e){var i=d[t]-(y.degrees[t]||0)*u;g<i&&(g=i,f=t)}),i=t,h=d[r=f]||0,(c=y).nodes_to_com[i]=+r,c.degrees[r]=(c.degrees[r]||0)+(c.gdegrees[i]||0),c.internals[r]=(c.internals[r]||0)+h+(c.loops[i]||0),f!==l&&(m=!0)}),!((i=x(y))-t<1e-7)););}function k(s,t){var a,r,h={nodes:[],edges:[],_assoc_mat:{}},e=f(s);return h.nodes=h.nodes.concat(d(e)),t.edges.forEach(function(t,e){r=t.weight||1;var i,n,o=s[t.source],t=s[t.target];a=p(h,o,t)||0,t=o={source:o,target:t,weight:a+r},(n=i=h)._assoc_mat[t.source]=n._assoc_mat[t.source]||{},n._assoc_mat[t.source][t.target]=t.weight,n._assoc_mat[t.target]=n._assoc_mat[t.target]||{},n._assoc_mat[t.target][t.source]=t.weight,l[o.source+"_"+o.target]?i.edges[l[o.source+"_"+o.target]].weight=o.weight:(i.edges.push(o),l[o.source+"_"+o.target]=i.edges.length-1)}),l={},h}function o(n,t){for(var o=y(n[0]),s=1;s<t+1;s++)Object.keys(o).forEach(function(t,e){var i=o[t];o[t]=n[s][i]});return o}function s(t,e){var i;if(0===t.edges.length)return i={},t.nodes.forEach(function(t,e){i[t]=t}),i;var n={},o=(m(c,n,e),x(n)),s=[],a=(b(c,n),x(n)),r=w(n.nodes_to_com),h=(s.push(r),o=a,k(r,c));for(m(h,n);b(h,n),a=x(n),u.push(y(s)),!(a-o<1e-7);)r=w(n.nodes_to_com),s.push(r),o=a,m(h=k(r,h),n);return s}function a(){var t=s(c,i);return o(t,t.length-1)}var t=-1;return a.resetAll=function(){t=-1,u=[]},a.nextStep=function(){return-1==t&&y(s(c,i)),t<u.length?null==u[t+=1]?o(u[t-1],u[t-1].length-1):o(u[t],u[t].length-1):void 0},a.nodes=function(t){return 0<arguments.length&&(e=t),a},a.edges=function(t){if(void 0===e)throw"Please provide the graph nodes first!";var i;return 0<arguments.length&&(i={},(n=t).forEach(function(t,e){i[t.source]=i[t.source]||{},i[t.source][t.target]=t.weight,i[t.target]=i[t.target]||{},i[t.target][t.source]=t.weight}),c={nodes:e,edges:n,_assoc_mat:i}),a},a.partition_init=function(t){return 0<arguments.length&&(i=t),a},a}function at(t,e){this.nodes=t,this.links=e,this.applay=function(){var e={},i=[],n=[];this.nodes.forEach(function(t){i.push(t.id),e[t.id]=t}),this.links.forEach(function(t){n.push({source:t.source.id,target:t.target.id,weight:t.weight})});for(var o,t,s=st().nodes(i).edges(n),a=!0;a;)null==(t=s.nextStep())?a=!1:o=t;var r,h={},c=(Object.keys(o).forEach(function(t){o[t]in h?h[o[t]].push(t):h[o[t]]=[t]}),1),l=new Map;for(r in h){var u=[];(h[r]||[]).forEach(function(t){u.push(e[t])}),l.set(c++,u)}return l}}var rt={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},ht={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},ct={springs:{}};function E(t,e,i){return Math.min(Math.max(t,e),i)}function lt(t,e){return t.apply(null,e)}var v={arr:function(t){return Array.isArray(t)},obj:function(t){return-1<Object.prototype.toString.call(t).indexOf("Object")},str:function(t){return"string"==typeof t},fnc:function(t){return"function"==typeof t},und:function(t){return void 0===t},nil:function(t){return v.und(t)||null===t},key:function(t){return!rt.hasOwnProperty(t)&&!ht.hasOwnProperty(t)&&"targets"!==t&&"keyframes"!==t}};function ut(t){t=/\(([^)]+)\)/.exec(t);return t?t[1].split(",").map(function(t){return parseFloat(t)}):[]}function dt(n,i){var t=ut(n),e=E(v.und(t[0])?1:t[0],.1,100),o=E(v.und(t[1])?100:t[1],.1,100),s=E(v.und(t[2])?10:t[2],.1,100),t=E(v.und(t[3])?0:t[3],.1,100),a=Math.sqrt(o/e),r=s/(2*Math.sqrt(o*e)),h=r<1?a*Math.sqrt(1-r*r):0,c=r<1?(r*a-t)/h:-t+a;function l(t){var e=i?i*t/1e3:t,e=r<1?Math.exp(-e*r*a)*(+Math.cos(h*e)+c*Math.sin(h*e)):(1+c*e)*Math.exp(-e*a);return 0===t||1===t?t:1-e}return i?l:function(){var t=ct.springs[n];if(t)return t;for(var e=0,i=0;;)if(1===l(e+=1/6)){if(16<=++i)break}else i=0;t=e*(1/6)*1e3;return ct.springs[n]=t}}function ft(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;return function(t){return Math.ceil(E(t,1e-6,1)*e)*(1/e)}}function gt(x,e,w,i){if(0<=x&&x<=1&&0<=w&&w<=1){var b=new Float32Array(11);if(x!==e||w!==i)for(var t=0;t<11;++t)b[t]=S(.1*t,x,w);return function(t){return x===e&&w===i||0===t||1===t?t:S(function(t){for(var e=0,i=1;10!==i&&b[i]<=t;++i)e+=.1;var n=e+(t-b[--i])/(b[i+1]-b[i])*.1,o=mt(n,x,w);if(.001<=o){for(var s=t,a=n,r=x,h=w,c=0;c<4;++c){var l=mt(a,r,h);if(0===l)return a;a-=(S(a,r,h)-s)/l}return a}if(0===o)return n;for(var u,d,f=t,g=e,p=e+.1,y=x,m=w,v=0;0<(u=S(d=g+(p-g)/2,y,m)-f)?p=d:g=d,1e-7<Math.abs(u)&&++v<10;);return d}(t),e,i)}}}L={linear:function(){return function(t){return t}}},T={Sine:function(){return function(t){return 1-Math.cos(t*Math.PI/2)}},Circ:function(){return function(t){return 1-Math.sqrt(1-t*t)}},Back:function(){return function(t){return t*t*(3*t-2)}},Bounce:function(){return function(t){for(var e,i=4;t<((e=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}},Elastic:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.5,i=E(t,1,10),n=E(e,.1,2);return function(t){return 0===t||1===t?t:-i*Math.pow(2,10*(t-1))*Math.sin((t-1-n/(2*Math.PI)*Math.asin(1/i))*(2*Math.PI)/n)}}},["Quad","Cubic","Quart","Quint","Expo"].forEach(function(t,e){T[t]=function(){return function(t){return Math.pow(t,e+2)}}}),Object.keys(T).forEach(function(t){var n=T[t];L["easeIn"+t]=n,L["easeOut"+t]=function(e,i){return function(t){return 1-n(e,i)(1-t)}},L["easeInOut"+t]=function(e,i){return function(t){return t<.5?n(e,i)(2*t)/2:1-n(e,i)(-2*t+2)/2}},L["easeOutIn"+t]=function(e,i){return function(t){return t<.5?(1-n(e,i)(1-2*t))/2:(n(e,i)(2*t-1)+1)/2}}});var L,T,pt=L;function yt(t,e){return 1-3*e+3*t}function S(t,e,i){return((yt(e,i)*t+(3*i-6*e))*t+3*e)*t}function mt(t,e,i){return 3*yt(e,i)*t*t+2*(3*i-6*e)*t+3*e}function vt(t,e){if(v.fnc(t))return t;var i=t.split("(")[0],n=pt[i],o=ut(t);switch(i){case"spring":return dt(t,e);case"cubicBezier":return lt(gt,o);case"steps":return lt(ft,o);default:return lt(n,o)}}function P(t,e){for(var i,n=t.length,o=2<=arguments.length?e:void 0,s=[],a=0;a<n;a++)a in t&&(i=t[a],e.call(o,i,a,t))&&s.push(i);return s}function B(t){return t.reduce(function(t,e){return t.concat(v.arr(e)?B(e):e)},[])}function xt(t){return v.arr(t)?t:t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t]}function wt(t){var e,i={};for(e in t)i[e]=t[e];return i}function bt(t,e){var i,n=wt(t);for(i in t)n[i]=(e.hasOwnProperty(i)?e:t)[i];return n}function A(t,e){var i,n=wt(t);for(i in e)n[i]=(v.und(t[i])?e:t)[i];return n}function N(t){t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(t)return t[1]}function kt(t,e){return v.fnc(t)?t(e.target,e.id,e.total):t}function Ct(t,e){if(null!=t[e])return"object"}function Mt(t,e,i,n){return"attribute"!==Ct(t,e)?t[e]||0:t.getAttribute(e)}function Et(t,e){var i=/^(\*=|\+=|-=)/.exec(t);if(!i)return t;var n=N(t)||0,o=parseFloat(e),s=parseFloat(t.replace(i[0],""));switch(i[0][0]){case"+":return o+s+n;case"-":return o-s+n;case"*":return o*s+n}}function Lt(t,e){var i;return/\s/g.test(t)?t:(i=(i=N(t))?t.substr(0,t.length-i.length):t,e?i+e:i)}function Tt(t,e){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=Lt(t,e)+"";return{original:n,numbers:n.match(i)?n.match(i).map(Number):[0],strings:v.str(t)||e?n.split(i):[]}}function St(t){return P(t?B(v.arr(t)?t.map(xt):xt(t)):[],function(t,e,i){return i.indexOf(t)===e})}function Pt(t){var i=St(t);return i.map(function(t,e){return{target:t,id:e,total:i.length,transforms:{list:[]}}})}function Bt(t,e){var i,n=[],o=e.keyframes;for(i in e=o?A(function(e){for(var i=P(B(e.map(function(t){return Object.keys(t)})),function(t){return v.key(t)}).reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[]),o={},t=0;t<i.length;t++)!function(t){var n=i[t];o[n]=e.map(function(t){var e,i={};for(e in t)v.key(e)?e==n&&(i.value=t[e]):i[e]=t[e];return i})}(t);return o}(o),e):e)v.key(i)&&n.push({name:i,tweens:function(t,i){var e,n=wt(i),o=(/^spring/.test(n.easing)&&(n.duration=dt(n.easing)),v.arr(t)&&(2!==(e=t.length)||v.obj(t[0])?v.fnc(i.duration)||(n.duration=i.duration/e):t={value:t}),v.arr(t)?t:[t]);return o.map(function(t,e){t=v.obj(t)?t:{value:t};return v.und(t.delay)&&(t.delay=e?0:i.delay),v.und(t.endDelay)&&(t.endDelay=e===o.length-1?i.endDelay:0),t}).map(function(t){return A(t,n)})}(e[i],t)});return n}var At={css:function(t,e,i){return t.style[e]=i},attribute:function(t,e,i){return t.setAttribute(e,i)},object:function(t,e,i){return t[e]=i},transform:function(t,e,i,n,o){var s;n.list.set(e,i),e!==n.last&&!o||(s="",n.list.forEach(function(t,e){s+="".concat(e,"(").concat(t,") ")}),t.style.transform=s)}};function Ot(t,a){Pt(t).forEach(function(t){for(var e in a){var i=kt(a[e],t),n=t.target,o=N(i),s=Mt(n,e),i=Et(Lt(i,o||N(s)),s),o=Ct(n,e);At[o](n,e,i,t.transforms,!0)}})}function Dt(t,e){return P(B(t.map(function(s){return e.map(function(t){var e,i,a,r,h,n=s,o=Ct(n.target,t.name);if(o)return r=n,i=(e=(a=t).tweens.map(function(t){var t=function(t,e){var i,n={};for(i in t){var o=kt(t[i],e);v.arr(o)&&1===(o=o.map(function(t){return kt(t,e)})).length&&(o=o[0]),n[i]=o}return n.duration=parseFloat(n.duration),n.delay=parseFloat(n.delay),n}(t,r),e=t.value,i=v.arr(e)?e[1]:e,n=N(i),o=Mt(r.target,a.name),s=h?h.to.original:o,e=v.arr(e)?e[0]:s,o=N(e)||N(o),n=n||o;return v.und(i)&&(i=s),t.from=Tt(e,n),t.to=Tt(Et(i,e),n),t.start=h?h.end:0,t.end=t.start+t.delay+t.duration+t.endDelay,t.easing=vt(t.easing,t.duration),t.isColor=!1,t.isColor&&(t.round=1),h=t}))[e.length-1],{type:o,property:t.name,animatable:n,tweens:e,duration:i.end,delay:e[0].delay,endDelay:i.endDelay}})})),function(t){return!v.und(t)})}function Nt(t,e){function i(t){return t.timelineOffset||0}var n=t.length,o={};return o.duration=n?Math.max.apply(Math,t.map(function(t){return i(t)+t.duration})):e.duration,o.delay=n?Math.min.apply(Math,t.map(function(t){return i(t)+t.delay})):e.delay,o.endDelay=n?o.duration-Math.max.apply(Math,t.map(function(t){return i(t)+t.duration-t.endDelay})):e.endDelay,o}var It=0;var I,z=[],zt=("undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){W.suspendWhenDocumentHidden&&(Rt()?I=cancelAnimationFrame(I):(z.forEach(function(t){return t._onDocumentVisibility()}),zt()))}),function(){!(I||Rt()&&W.suspendWhenDocumentHidden)&&0<z.length&&(I=requestAnimationFrame(Wt))});function Wt(t){for(var e=z.length,i=0;i<e;){var n=z[i];n.paused?(z.splice(i,1),e--):(n.tick(t),i++)}I=0<i?requestAnimationFrame(Wt):void 0}function Rt(){return document&&document.hidden}function W(){var h,c=0,l=0,u=0,d=0,f=null;function g(t){var e=window.Promise&&new Promise(function(t){return f=t});t.finished=e}e=bt(rt,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}),i=Bt(n=bt(ht,t),t),t=Pt(t.targets),n=Nt(i=Dt(t,i),n),o=It,It++;var t,e,i,n,o,C=A(e,{id:o,children:[],animatables:t,animations:i,duration:n.duration,delay:n.delay,endDelay:n.endDelay});function p(){var t=C.direction;"alternate"!==t&&(C.direction="normal"!==t?"normal":"reverse"),C.reversed=!C.reversed,h.forEach(function(t){return t.reversed=C.reversed})}function y(t){return C.reversed?C.duration-t:t}function s(){c=0,l=y(C.currentTime)*(1/W.speed)}function m(t,e){e&&e.seek(t-e.timelineOffset)}function v(e){for(var t=0,i=C.animations,n=i.length;t<n;){var o=i[t],s=o.animatable,a=o.tweens,r=a.length-1,h=a[r];r&&(h=P(a,function(t){return e<t.end})[0]||h);for(var r=E(e-h.start-h.delay,0,h.duration)/h.duration,c=isNaN(r)?1:h.easing(r),l=h.to.strings,u=h.round,d=[],f=h.to.numbers.length,g=void 0,p=0;p<f;p++){var y=void 0,m=h.to.numbers[p],v=h.from.numbers[p]||0;h.isPath||(y=v+c*(m-v)),!u||h.isColor&&2<p||(y=Math.round(y*u)/u),d.push(y)}var x=l.length;if(x)for(var g=l[0],w=0;w<x;w++){l[w];var b=l[w+1],k=d[w];isNaN(k)||(g+=b?k+b:k+" ")}else g=d[0];At[o.type](s.target,o.property,g,s.transforms),o.currentValue=g,t++}}function x(t){C[t]&&!C.passThrough&&C[t](C)}function a(t){var e=C.duration,i=C.delay,n=e-C.endDelay,o=y(t);if(C.progress=E(o/e*100,0,100),C.reversePlayback=o<C.currentTime,h){var s=o;if(C.reversePlayback)for(var a=d;a--;)m(s,h[a]);else for(var r=0;r<d;r++)m(s,h[r])}!C.began&&0<C.currentTime&&(C.began=!0,x("begin")),!C.loopBegan&&0<C.currentTime&&(C.loopBegan=!0,x("loopBegin")),o<=i&&0!==C.currentTime&&v(0),(n<=o&&C.currentTime!==e||!e)&&v(e),i<o&&o<n?(C.changeBegan||(C.changeBegan=!0,C.changeCompleted=!1,x("changeBegin")),x("change"),v(o)):C.changeBegan&&(C.changeCompleted=!0,C.changeBegan=!1,x("changeComplete")),C.currentTime=E(o,0,e),C.began&&x("update"),e<=t&&(l=0,C.remaining&&!0!==C.remaining&&C.remaining--,C.remaining?(c=u,x("loopComplete"),C.loopBegan=!1,"alternate"===C.direction&&p()):(C.paused=!0,C.completed||(C.completed=!0,x("loopComplete"),x("complete"),!C.passThrough&&"Promise"in window&&(f(),g(C)))))}return g(C),C.reset=function(){var t=C.direction;C.passThrough=!1,C.currentTime=0,C.progress=0,C.paused=!0,C.began=!1,C.loopBegan=!1,C.changeBegan=!1,C.completed=!1,C.changeCompleted=!1,C.reversePlayback=!1,C.reversed="reverse"===t,C.remaining=C.loop,h=C.children;for(var e=d=h.length;e--;)C.children[e].reset();(C.reversed&&!0!==C.loop||"alternate"===t&&1===C.loop)&&C.remaining++,v(C.reversed?C.duration:0)},C._onDocumentVisibility=s,C.set=function(t,e){return Ot(t,e),C},C.tick=function(t){a(((u=t)+(l-(c=c||u)))*W.speed)},C.seek=function(t){a(y(t))},C.pause=function(){C.paused=!0,s()},C.play=function(){C.paused&&(C.completed&&C.reset(),C.paused=!1,z.push(C),s(),zt())},C.reverse=function(){p(),C.completed=!C.reversed,s()},C.restart=function(){C.reset(),C.play()},C.remove=function(t){Gt(St(t),C)},C.reset(),C.autoplay&&C.play(),C}function Ft(t,e){for(var i=e.length;i--;)!function(t,e){return t.some(function(t){return t===e})}(t,e[i].animatable.target)||e.splice(i,1)}function Gt(t,e){var i=e.animations,n=e.children;Ft(t,i);for(var o=n.length;o--;){var s=n[o],a=s.animations;Ft(t,a),a.length||s.children.length||n.splice(o,1)}i.length||n.length||e.pause()}W.version="3.2.1",W.speed=1,W.suspendWhenDocumentHidden=!0,W.running=z,W.remove=function(t){for(var e=St(t),i=z.length;i--;)Gt(e,z[i])},W.get=Mt,W.set=Ot,W.timeline=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=W(a);return r.duration=0,r.add=function(t,e){var i=z.indexOf(r),n=r.children;function o(t){t.passThrough=!0}-1<i&&z.splice(i,1);for(var s=0;s<n.length;s++)o(n[s]);i=A(t,bt(ht,a)),i.targets=i.targets||a.targets,t=r.duration,i.autoplay=!1,i.direction=r.direction,i.timelineOffset=v.und(e)?t:Et(e,t),o(r),r.seek(i.timelineOffset),e=W(i),o(e),n.push(e),t=Nt(n,a);return r.delay=t.delay,r.endDelay=t.endDelay,r.duration=t.duration,r.seek(0),r.reset(),r.autoplay&&r.play(),r},r},W.easing=vt,W.penner=pt,W.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};function _t(){this.actionStack=[],this.todo=function(t,e){10<this.actionStack.length&&this.actionStack.shift(),this.actionStack.push({action:t,elements:e})},this.clearAll=function(){this.actionStack=null,this.actionStack=[]},this.undo=function(t){var e,i;0!=this.actionStack.length&&(e=(i=this.actionStack.pop()).action,i=i.elements,this.do(e,i,t))},this.do=function(t,e,n){var o,i;"node:add"!=t&&("node:remove"==t?(o=new Map,i=[],e.forEach(function(t){"node"==t.elementType?(n.scene.add(t),n.nodes.push(t),o.set(t.id,t)):"link"==t.elementType&&i.push(t)}),i.forEach(function(t){var e=t.source.id,i=t.target.id,e=o.get(e),e=(e&&e.outLinks.push(t),o.get(i));e&&e.inLinks.push(t),n.scene.add(t),n.links.push(t)})):"link:remove"==t&&(o=new Map,n.nodes.forEach(function(t){o.set(t.id,t)}),e.forEach(function(t){var e=t.source.id,i=t.target.id,e=o.get(e),e=(e&&e.outLinks.push(t),o.get(i));e&&e.inLinks.push(t),n.scene.add(t),n.links.push(t)}))),n.refreshView()}}var Ht={node:{click:"onClick",dblClick:"ondblClick",mouseUp:"onMouseUp",mouseDown:"onMouseDown",mouseOver:"onMouseOver",mouseOut:"onMouseOut",mousedrag:"onMousedrag"},link:{click:"onClick",dblClick:"ondblClick",mouseUp:"onMouseUp",mouseDown:"onMouseDown",mouseOver:"onMouseOver",mouseOut:"onMouseOut"},group:{click:"onClick",dblClick:"ondblClick"},scene:{whiteSpaceClick:"noElementClick",keyUp:"keyUp",keyDown:"keyDown",mouseWheel:"mouseWheel",mouseDraging:"mouseDraging",mouseDragEnd:"mouseDragEnd",boxSelectEnd:"onBoxSelectEndEvent"}};function R(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.container;if(!(e&&e instanceof HTMLElement))throw new Error("not find html container,can not init");var i=t.licenseKey;if(!i)throw new Error("please config license key!");t=t.config,this.defaultConfig={node:{label:{show:!0,color:"50,50,50",font:"normal 14px Arial",wrapText:!1,textPosition:"Bottom_Center",textOffsetX:0,textOffsetY:0,background:null,borderWidth:0,borderColor:null},shape:"circle",color:"30,160,250",borderColor:"30,100,250",borderWidth:0,tagColor:"230,30,30",size:60,alpha:1,borderRadius:0,padding:0,selected:{borderColor:"50,50,230",borderAlpha:1,borderWidth:5,showShadow:!1,shadowColor:"80,160,240",shadowBlur:10}},link:{label:{show:!0,color:"20,20,20",font:"normal 13px Arial"},lineType:"straight",colorType:"defined",color:"120,110,110",alpha:1,lineWidth:2,lineDash:null,showArrow:!0,arrowType:"triangle",selected:{color:"50,50,230"}},scene:{},group:{},highLightNeiber:!1,wheelZoom:.9,selectBox:{color:"10,10,225",alpha:.1}},t=t||this.defaultConfig,this.config=null,this.resetConfig(t),t=a({container:"default",width:200,height:160,viewColor:"#3ca9f1"},this.config.miniMap||{},!0,!0);this.stage=new Y(e,t,!1),this.canvas=this.stage.canvas,this.scene=null,this.nodes=[],this.links=[],this.currentNode=null,this.currentLink=null,this.currentGroup=null,this.showLinkFlag=!0,this.clusterGroups=[],this.currentCluster=null,this.currentLayout=null,this.undoManager=null,this.validChar="1_Z3JhcGh2aXMuY24=_1691863711688",this.licenseKey=i,this.drawLinkFlag=!1,this.virNode=null,this.drawLineCallback=function(t){return t},this.sceneEvent=null,this.defindPaintFuncCache={nodePaintFunc:null,linePaintFunc:null,nodeInBoundFunc:null,linkInBoundFunc:null},this.iconImageCache={},this.nodeTemplates={},this.init=function(){if(null==this.stage)throw new Error("graph can not init");this.validChar,this.licenseKey,this.stage.wheelZoom=this.config.wheelZoom,this.stage.selectBoxColor=this.config.selectBox.color,this.stage.selectBoxAlpha=this.config.selectBox.alpha,null!=this.scene&&(this.scene.childs=null,this.stage.remove(this.scene)),this.scene=new u(this.stage),this.nodes=[],this.links=[],this.initDrawLinkBase(),this.undoManager=new _t},this.init()}return R.prototype.resetConfig=function(t){this.config=a(this.defaultConfig,t||{},!0,!0),this.defaultNodeColor=this.config.node.color,this.highLightNeiber=this.config.highLightNeiber},R.prototype.initDrawLinkBase=function(){var o=this,t=new y;t.shape="circle",t.radius=1,t.show=!1,t.alpha=0,o.virNode=t,o.scene.mousemove(function(t){var e,i;o.drawLinkFlag&&(o.virNode.show||(o.virNode.show=!0,o.scene.add(o.virNode)),null==o.virLink&&(e=o.config.link,(i=new p(o.currentNode,o.virNode)).lineWidth=e.lineWidth,i.showArrow=e.showArrow,i.strokeColor=e.color,i.selectedColor=i.strokeColor,i.lineDash=[3,5,5],o.virLink=i,o.scene.add(o.virLink)),o.virNode.cx=t.x-2,o.virNode.cy=t.y+2)}),o.scene.dbclick(function(t){o.drawLinkFlag=!1,o.virNode.show&&(o.virNode.show=!1,o.scene.remove(o.virNode)),o.virLink&&(o.scene.remove(o.virLink),o.virLink=null)}),o.scene.click(function(t){var e;o.hideAllRightMenu(),null==t.target&&(o.highLightNeiber&&o.restoreHightLight(),e=o.config.scene.noElementClick)&&"function"==typeof e&&e(t,o)}),o.scene.mousewheel(function(t){var e=o.config.scene.mouseWheel;e&&"function"==typeof e&&e(t,o)}),o.scene.keyup(function(t){o.setMouseModel("normal");var e=o.config.scene.keyUp;e&&"function"==typeof e&&e(t,o)}),o.scene.keydown(function(t){"Control"===t.key&&o.setMouseModel("select");var e=o.config.scene.keyDown;e&&"function"==typeof e&&e(t,o)}),o.scene.mousedrag(function(t){var e=o.config.scene.mouseDraging;e&&"function"==typeof e&&e(t,o)}),o.scene.mouseup(function(t){var e,i,n;null==t.target?(o.hideAllRightMenu(),o.currentNode=null,o.currentLink=null,o.currentGroup=null,o.highLightNeiber&&o.restoreHightLight()):"node"==t.target.elementType?(o.currentLink=null,o.currentGroup=null):"group"==t.target.elementType?(o.currentNode=null,o.currentLink=null):(o.currentNode=null,o.currentGroup=null),2==t.button&&null==t.target&&setTimeout(function(){o.showSceneRightMenu(t)},200),this.areaSelect&&((e=o.config.scene.onBoxSelectEndEvent)&&"function"==typeof e?(i=this,setTimeout(function(){e(t,o,i.boxSelectedNodes),i.boxSelectedNodes=null},350)):this.boxSelectedNodes=null),this.dragging&&(this.dragging=!1,n=o.config.scene.mouseDragEnd)&&"function"==typeof n&&n(t,o)})},R.prototype.hideAllRightMenu=function(){this.config.hasOwnProperty("rightMenu")&&(this.config.rightMenu.hasOwnProperty("nodeMenu")&&"function"==typeof this.config.rightMenu.nodeMenu.hide&&this.config.rightMenu.nodeMenu.hide(),this.config.rightMenu.hasOwnProperty("linkMenu")&&"function"==typeof this.config.rightMenu.linkMenu.hide&&this.config.rightMenu.linkMenu.hide(),this.config.rightMenu.hasOwnProperty("groupMenu")&&"function"==typeof this.config.rightMenu.groupMenu.hide&&this.config.rightMenu.groupMenu.hide(),this.config.rightMenu.hasOwnProperty("sceneMenu"))&&"function"==typeof this.config.rightMenu.sceneMenu.hide&&this.config.rightMenu.sceneMenu.hide()},R.prototype.addGraph=function(t){var i,n;null!=t&&(null==this.scene&&this.init(),this.addNodes(t.nodes||[]),this.addEdges(t.links||[]),null!=t.groups)&&(i=new Map,this.nodes.forEach(function(t){i.set(t.id,t)}),n=this,t.groups.forEach(function(t){var e=[];t.childs.forEach(function(t){e.push(i.get(t))}),n.addNodesInGroup(e,{shape:t.shape,padding:t.padding,color:t.fillColor,alpha:t.alpha,smoothPath:t.smoothPath}).id=t.id}))},R.prototype.customStyle=function(t){return t&&"function"==typeof t?t(this.stage.graphics):null},R.prototype.addNodesInGroup=function(t,e){},R.prototype.createGroup=function(t){},R.prototype.removeGroup=function(e){var t,i;"string"==typeof e?0<(t=this.clusterGroups.filter(function(t){return t.id==e})).length&&(e=t[0],-1<(i=this.clusterGroups.indexOf(e)))&&(this.clusterGroups.splice(i,1),this.scene.remove(e)):-1<(i=this.clusterGroups.indexOf(e))&&(this.clusterGroups.splice(i,1),this.scene.remove(e)),e=null,this.refreshView()},R.prototype.removeAllGroup=function(){var e=this;e.clusterGroups.forEach(function(t){e.scene.remove(t)}),e.clusterGroups=[],e.refreshView()},R.prototype.configNodeAttributes=function(t,e){var i,n,o,s,a=this;i=t,o=e,n=a.config.node,i.id=o.id||i.id,i.type=o.type||"default",i.scale=o.scale||Number(1),i.label=o.label||o.id,i.alpha=o.alpha||n.alpha,i.fontColor=o.fontColor||n.label.color,i.textPosition=o.textPosition||n.label.textPosition,i.font=o.font||n.label.font,i.borderColor=o.borderColor||n.borderColor,i.borderWidth=o.borderWidth||n.borderWidth,i.borderRadius=o.borderRadius||n.borderRadius,i.showlabel=o.showlabel||n.label.show,i.nodeWrapText=n.label.nodeWrapText,i.showShadow=o.showShadow||n.selected.showShadow,i.shadowColor=o.shadowColor||n.selected.shadowColor,i.shadowBlur=o.shadowBlur||n.selected.shadowBlur,i.selectedBorderColor=o.selectedBorderColor||n.selected.borderColor,i.selectedBorderWidth=o.selectedBorderWidth||n.selected.borderWidth,i.lineDash=o.lineDash||n.lineDash,i.labelBackGround=o.labelBackGround||n.label.background,i.labelBorderWidth=o.labelBorderWidth||n.label.borderWidth,i.labelBorderColor=o.labelBorderColor||n.label.borderColor,i.textOffsetX=o.textOffsetX||n.label.textOffsetX,i.textOffsetY=o.textOffsetY||n.label.textOffsetY,i.padding=o.padding||n.padding,i.tagColor=o.tagColor||n.tagColor,i.tags=o.tags,i.properties=o.properties||{},o.x&&(i.x=o.x),o.y&&(i.y=o.y),t.weight=1,t.px=t.x,t.py=t.y,a.config.nodeClusters&&a.config.nodeClusters[t.type]?(n=a.config.nodeClusters[t.type],t.fillColor=n.color||a.config.node.color,t.shape=n.shape||a.config.node.shape,t.size=n.size||a.config.node.size,t.font=n.font||a.config.node.label.font,t.fontColor=n.fontColor||a.config.node.label.color,t.borderWidth=n.borderWidth||a.config.node.borderWidth,t.borderColor=n.borderColor||a.config.node.borderColor,t.selectedBorderWidth=n.selectedBorderWidth||a.config.node.selected.borderWidth,t.selectedBorderColor=n.selectedBorderColor||a.config.node.selected.borderColor,t.shadowColor=n.shadowColor||a.config.node.selected.shadowColor,t.textPosition=n.textPosition||a.config.node.label.textPosition,t.tagColor=n.tagColor||a.config.node.tagColor,t.padding=n.padding||a.config.node.padding,n.icon&&(s=n.icon,t.icon=s,t.setImage(null==(i=a.iconImageCache[s])?void 0:i.image),t.imageOffsetX=0|n.imageOffsetX,t.imageOffsetY=0|n.imageOffsetY),n.image&&(t.imageUrl=n.image,t.setImage(n.image,function(){a.refreshView()}))):(t.fillColor=e.color||e.fillColor||this.defaultNodeColor,t.shape=e.shape||a.config.node.shape||"circle",t.size=e.size||a.config.node.size||40),"rect"==t.shape&&(t.width=e.width||a.config.node.width||t.size||40,t.height=e.height||a.config.node.height||t.size||40),t.imageUrl=e.image,t.setImage(e.image,function(){a.refreshView()}),e.style&&(e.style.icon&&(s=e.style.icon,t.icon=s,t.setImage(null==(o=a.iconImageCache[s])?void 0:o.image),t.imageOffsetX=0|e.style.imageOffsetX,t.imageOffsetY=0|e.style.imageOffsetY),e.style.image&&(t.imageUrl=e.style.image,t.setImage(t.imageUrl,function(){a.refreshView()}),delete e.style.image),t=Object.assign(t,e.style)),null!=a.defindPaintFuncCache.nodePaintFunc&&(t.definedPaintFunc=a.defindPaintFuncCache.nodePaintFunc),null!=a.defindPaintFuncCache.nodeInBoundFunc&&(t.isInBound=a.defindPaintFuncCache.nodeInBoundFunc),a.refreshView()},R.prototype.resetNodeAttributes=function(t,e){var i;null!=t&&null!=e&&(i=this,Object.assign(t,e),t.setImage(e.image,function(){i.refreshView()}),i.refreshView())},R.prototype.registNodeTemplates=function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];t instanceof Array&&(e=this,t.forEach(function(t){e.nodeTemplates[t.name]=t})),this.validChar,this.licenseKey},R.prototype.newNode=function(t){var e,i=this,n=null;return"custome"==t.nodeType&&(e=i.nodeTemplates[t.shape])?(n=new $(e),e=h(h({},t.style),e.mainShape),n.customeShape=t.shape,n.drawFinished=function(){i.refreshView()},t.style=e):n=new y,n.x=null==t.x?Math.round(Math.random()*this.stage.width):t.x,n.y=null==t.y?Math.round(Math.random()*this.stage.height):t.y,null==t.id&&(t.id=m(12)),i.configNodeAttributes(n,t),n.click(function(t){var e;i.currentNode=this,i.drawLinkFlag&&null!=i.virLink&&(e=i.newEdge(i.virLink.source,this,{color:i.config.link.color}),i.virNode.show&&(i.virNode.show=!1,i.scene.remove(i.virNode)),i.drawLinkFlag=!1,i.virLink&&(i.scene.remove(i.virLink),i.virLink=null),i.drawLineCallback)&&"function"==typeof i.drawLineCallback&&i.drawLineCallback(e),i.highLightNeiber&&(i.restoreHightLight(),i.highLightNeiberNodes(this,.1)),i.config.node.hasOwnProperty("onClick")&&"function"==typeof(e=i.config.node.onClick)&&e(t,this)}),n.dbclick(function(t){var e;this.fixed=!this.fixed,i.config.node.hasOwnProperty("ondblClick")&&"function"==typeof(e=i.config.node.ondblClick)&&e(t,this)}),n.mousedrag(function(t){if(this.fixed=!0,this.px=this.x,this.py=this.y,this.isDragging||1<i.scene.selectedElements.length)return!1;var e;this.isDragging=!0,i.config.node.hasOwnProperty("onMousedrag")&&"function"==typeof(e=i.config.node.onMousedrag)&&e(t,this)}),n.mouseup(function(t){var e;(i.currentNode=this).fixed=!0,this.px=this.x,this.py=this.y,this.isDragging=!1,2==t.button&&(i.hideAllRightMenu(),i.showNodeRightMenu(t,this)),i.config.node.hasOwnProperty("onMouseUp")&&"function"==typeof(e=i.config.node.onMouseUp)&&e(t,this)}),n.mousedown(function(t){var e;(i.currentNode=this).fixed=!0,this.px=this.x,this.py=this.y,i.config.node.hasOwnProperty("onMouseDown")&&"function"==typeof(e=i.config.node.onMouseDown)&&e(t,this)}),n.mouseover(function(t){var e;i.config.node.hasOwnProperty("onMouseOver")&&"function"==typeof(e=i.config.node.onMouseOver)&&e(t,this)}),n.mouseout(function(t){var e;i.config.node.hasOwnProperty("onMouseOut")&&"function"==typeof(e=i.config.node.onMouseOut)&&e(t,this)}),i.scene.add(n),i.nodes.push(n),n},R.prototype.refreshView=function(){this.stage&&(this.stage.needRepaint=!0),this.validChar,this.licenseKey},R.prototype.highLightNeiberNodes=function(t,e){this.nodes.forEach(function(t){t.t_alpha=t.alpha,t.alpha=e||.1}),t.alpha=t.t_alpha,(t.inLinks||[]).forEach(function(t){t.source.visible&&(t.source.alpha=t.source.t_alpha)}),(t.outLinks||[]).forEach(function(t){t.target.visible&&(t.target.alpha=t.target.t_alpha)}),this.showLinkFlag&&(this.links.forEach(function(t){t.visible=!1}),(t.inLinks||[]).forEach(function(t){t.source.visible&&(t.visible=!0)}),(t.outLinks||[]).forEach(function(t){t.target.visible&&(t.visible=!0)}))},R.prototype.restoreHightLight=function(){this.nodes.forEach(function(t){t.alpha=t.t_alpha||t.alpha}),this.showLinkFlag&&this.links.forEach(function(t){t.source.visible&&t.target.visible&&(t.visible=!0)})},R.prototype.lockNode=function(t){t&&null!=t&&(t.fixed=!0,t.dragable=!1)},R.prototype.unLockNode=function(t){t&&null!=t&&(t.fixed=!1,t.dragable=!0)},R.prototype.showNodeRightMenu=function(t,e){this.config.hasOwnProperty("rightMenu")&&this.config.rightMenu.hasOwnProperty("nodeMenu")&&"function"==typeof this.config.rightMenu.nodeMenu.show&&this.config.rightMenu.nodeMenu.show(t,this,e)},R.prototype.showLinkRightMenu=function(t,e){this.config.hasOwnProperty("rightMenu")&&this.config.rightMenu.hasOwnProperty("linkMenu")&&"function"==typeof this.config.rightMenu.linkMenu.show&&this.config.rightMenu.linkMenu.show(t,this,e)},R.prototype.showGroupRightMenu=function(t,e){this.config.hasOwnProperty("rightMenu")&&this.config.rightMenu.hasOwnProperty("groupMenu")&&"function"==typeof this.config.rightMenu.groupMenu.show&&this.config.rightMenu.groupMenu.show(t,this,e)},R.prototype.showSceneRightMenu=function(t){this.config.hasOwnProperty("rightMenu")&&this.config.rightMenu.hasOwnProperty("sceneMenu")&&"function"==typeof this.config.rightMenu.sceneMenu.show&&this.config.rightMenu.sceneMenu.show(t,this)},R.prototype.configEdgeAttributes=function(t,e){var i,n,o;null!=t&&null!=e&&(i=t,n=e,o=this.config.link,i.id=n.id||i.id,i.type=n.type||"default",i.label=n.label,i.showlabel=n.showlabel||o.label.show,i.lineWidth=Number(n.lineWidth)||o.lineWidth,i.strokeColor=n.color||n.strokeColor||o.color,i.lineType=n.lineType||o.lineType,i.lineDash=n.lineDash||o.lineDash,i.font=n.font||o.label.font,i.fontColor=n.fontColor||o.label.color,i.arrowType=n.arrowType||o.arrowType,i.alpha=n.alpha||o.alpha,i.selectedColor=n.selectedColor||o.selected.color,i.colorType=n.colorType||o.colorType,i.labelBackGround=n.labelBackGround||o.label.background,i.labelBorderWidth=n.labelBorderWidth||o.label.borderWidth,i.labelBorderColor=n.labelBorderColor||o.label.borderColor,i.labelBorderRadius=n.labelBorderRadius||o.label.borderRadius,i.showArrow=n.showArrow||o.showArrow,i.multiControlPercent=n.multiControlPercent||.2,i.parallelType=n.parallelType||"curve",i.background=n.background,i.weight=n.weight?Number(n.weight):1,i.visible=n.visible||!0,i.properties=n.properties||{},this.config.linkClusters&&this.config.linkClusters[t.type]&&(o=this.config.linkClusters[t.type],t.strokeColor=o.color||this.config.link.color,t.lineWidth=o.lineWidth||this.config.link.lineWidth,t.lineType=o.lineType||this.config.link.lineType,t.lineDash=o.lineDash||this.config.link.lineDash,t.selectedColor=o.selectedColor||this.config.link.selected.color,t.font=o.font||this.config.link.label.font,t.fontColor=o.fontColor||this.config.link.label.color,t.showArrow=o.showArrow||this.config.link.showArrow,t.labelBackGround=o.labelBackGround||this.config.link.label.background),e.style&&Object.assign(t,e.style),null!=this.defindPaintFuncCache.linePaintFunc&&(t.definedPaintFunc=this.defindPaintFuncCache.linePaintFunc),null!=this.defindPaintFuncCache.linkInBoundFunc&&(t.isInBound=this.defindPaintFuncCache.linkInBoundFunc),this.refreshView())},R.prototype.resetEdgeAttributes=function(t,e){null!=t&&null!=e&&(Object.assign(t,e),this.refreshView())},R.prototype.newEdge=function(t,e,i){var n;if(null!=t&&null!=e&&null!=i)return n=this,null==i.id&&(i.id=m(15)),t=new p(t,e,i.label),n.configEdgeAttributes(t,i),t.click(function(t){var e;n.config.link.hasOwnProperty("onClick")&&"function"==typeof(e=n.config.link.onClick)&&e(t,this)}),t.dbclick(function(t){var e;n.config.link.hasOwnProperty("ondblClick")&&"function"==typeof(e=n.config.link.ondblClick)&&e(t,this)}),t.mousedown(function(t){var e;n.config.link.hasOwnProperty("onMouseDown")&&"function"==typeof(e=n.config.link.onMouseDown)&&e(t,this)}),t.mouseup(function(t){var e;n.currentLink=this,2==t.button&&(n.hideAllRightMenu(),n.showLinkRightMenu(t,this)),n.config.link.hasOwnProperty("onMouseUp")&&"function"==typeof(e=n.config.link.onMouseUp)&&e(t,this)}),t.mouseover(function(t){var e;n.config.link.hasOwnProperty("onMouseOver")&&"function"==typeof(e=n.config.link.onMouseOver)&&e(t,this)}),t.mouseout(function(t){var e;n.config.link.hasOwnProperty("onMouseOut")&&"function"==typeof(e=n.config.link.onMouseOut)&&e(t,this)}),n.scene.add(t),n.links.push(t),t},R.prototype.addNodes=function(t){var e,i,n,o;return t instanceof Array&&0!=t.length?(e=this,i=new Map,e.nodes.forEach(function(t){i.set(t.id,t)}),n=[],o=null,t.forEach(function(t){null==i.get(t.id)&&(o=e.newNode(t),n.push(o))}),e.refreshView(),n):[]},R.prototype.addNode=function(t){t=this.addNodes([t]);return 0<t.length?t[0]:null},R.prototype.addEdges=function(t){var e,i,n,o,s,a,r;return t instanceof Array&&0!=t.length?(e=this,i=new Map,e.links.forEach(function(t){t.id||(t.id=m(10)),i.set(t.id,t)}),n=new Map,e.nodes.forEach(function(t){n.set(t.id,t)}),o=[],r=a=s=null,t.forEach(function(t){t.id||(t.id=m(10)),null==i.get(t.id)&&(s=n.get(t.source),a=n.get(t.target),null!=s)&&null!=a&&(r=e.newEdge(s,a,t),o.push(r))}),e.refreshView(),o):[]},R.prototype.addEdge=function(t){t=this.addEdges([t]);return 0<t.length?t[0]:null},R.prototype.getGraphData=function(){return{nodes:this.nodes,links:this.links}},R.prototype.getVisibleData=function(){return{nodes:this.nodes.filter(function(t){return 1==t.visible}),links:this.links.filter(function(t){return 1==t.source.visible&&1==t.target.visible})}},R.prototype.setZoomRange=function(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[.1,10];e instanceof Array&&2==e.length&&(t=Number(e[0])||.1)<(e=Number(e[1])||10)&&(this.scene.scaleRange=[t,e])},R.prototype.getBounds=function(){return this.scene.getElementsBound()},R.prototype.moveCenter=function(t){t&&(this.scene.scale=t<=0?.1:t),this.scene.translateToCenter(),this.refreshView()},R.prototype.moveNodeToCenter=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this;null!=e&&0<Number(e)?i.createBaseAnimate({targets:i.scene,duration:e,easing:"linear",translateX:-t.x+i.stage.width/2,translateY:-t.y+i.stage.height/2,begin:function(t){i.switchAnimate(!0)}}).finished.then(function(){i.switchAnimate(!1)}):(i.scene.setCenter(t.x,t.y),i.refreshView())},R.prototype.resize=function(){this.stage.resize(),this.validChar,this.licenseKey},R.prototype.setMouseModel=function(t,e){"drag"==t?this.stage.mode="drag":"select"==t?(this.stage.mode="select",e&&-1!=["rect","lasso","circle"].indexOf(e)&&(this.scene.selectBoxType=e)):this.stage.mode="normal"},R.prototype.saveImage=function(t){null==t&&(t={}),1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||(t=a({width:6e3,height:6e3,type:"png",fileName:"GraphVis图谱图片",background:"#fff",textWatermark:{content:"GraphVis图谱可视化",angle:-30,alpha:.1,fontStyle:"normal",fontSize:60,fontFamliy:"Arial",fontColor:"#666"}},t)),this.stage.saveAsLocalImage(t),this.validChar,this.licenseKey},R.prototype.getSnapshotImage=function(){return this.validChar,this.licenseKey,this.stage.getSnapshotImage()},R.prototype.serialized=function(){var t=["shape","size","font","fillColor","fontColor","borderWidth","borderColor","selectedBorderColor","selectedBorderWidth","shadowColor","shadowBlur","height","width","textPosition","textOffsetX","textOffsetY","labelBackGround","labelBorderWidth","labelBorderColor","tags","tagColor","x","y","scale"],n=[],o=null,s=(this.nodes.forEach(function(e){o={id:e.id,label:e.label,type:e.type,nodeType:e.nodeType,shape:e.customeShape,properties:e.properties,style:{}};var i;t.forEach(function(t){(i=e[t])&&(o.style[t]=i)}),e.imageUrl&&(o.style.image=e.imageUrl),n.push(o)}),["lineType","lineWidth","font","fontColor","strokeColor","selectedColor","background","labelBackGround","lineDash"]),a=[],r=null,e=(this.links.forEach(function(e){r={id:e.id,label:e.label,type:e.type,source:e.source.id,target:e.target.id,weight:e.weight,properties:e.properties,style:{}};var i;s.forEach(function(t){(i=e[t])&&(r.style[t]=i)}),a.push(r)}),this.clusterGroups.map(function(t){return{id:t.id,shape:t.shape,fillColor:t.fillColor,padding:t.padding,alpha:t.alpha,smoothPath:t.smoothPath,childs:t.childs.map(function(t){return t.id})}}));return this.validChar,this.licenseKey,{nodes:n,links:a,groups:e}},R.prototype.exportJsonFile=function(t){var e=JSON.stringify(this.serialized()),t=(t||"graphdata")+".json",e=new Blob([e],{type:"text/json"}),i=document.createElement("a"),n=new MouseEvent("click");i.download=t,i.href=window.URL.createObjectURL(e),i.dataset.downloadurl=["text/json",i.download,i.href].join(":"),i.dispatchEvent(n)},R.prototype.hideAllLink=function(){this.showLinkFlag=!1,this.links.forEach(function(t){t.visible=!1}),this.refreshView()},R.prototype.showAllLink=function(){this.showLinkFlag=!0,this.links.forEach(function(t){t.source.visible&&t.target.visible&&(t.visible=!0)}),this.refreshView()},R.prototype.onlyShowSelectLink=function(){this.links.forEach(function(t){t.selected?t.visible=!0:t.visible=!1}),this.refreshView()},R.prototype.showAllNode=function(){this.nodes.forEach(function(t){t.alpha=1,t.visible=!0}),this.refreshView()},R.prototype.applyNodeSize=function(e){var i=this,n=new Set,t=(i.nodes.forEach(function(t){t.degree=(t.outLinks||[]).length+(t.inLinks||[]).length,n.add(t.degree)}),Array.from(n).sort()),o=[t[0],t[t.length-1]];i.nodes.forEach(function(t){t.scale=i.numScale(e,o,t.degree)}),this.refreshView()},R.prototype.applyLinkWeight=function(e){var i=this,n=new Set,t=(i.links.forEach(function(t){n.add(t.weight)}),Array.from(n).sort()),o=[t[0],t[t.length-1]];i.links.forEach(function(t){t.lineWidth=Math.round(i.numScale(e,o,t.weight))}),this.refreshView()},R.prototype.numScale=function(t,e,i){i=((i-e[0])*(t[1]-t[0])/(e[1]-e[0])+t[0]).toFixed(1);return isNaN(i)?1:i},R.prototype.selectedAllNodes=function(){var e=this;this.nodes.forEach(function(t){t.selected=!0,e.scene.addToSelected(t)}),this.refreshView()},R.prototype.cancelAllSelected=function(){this.scene.cancleAllSelected(),this.refreshView()},R.prototype.removeFromSelected=function(t){t&&(this.scene.removeFromSelected(t),this.refreshView())},R.prototype.reverseSelectNodes=function(){var e=this;this.nodes.forEach(function(t){t.selected?(t.selected=!1,e.scene.removeFromSelected(t)):(t.selected=!0,e.scene.addToSelected(t))}),this.refreshView()},R.prototype.selectedNeighbers=function(t){t=t||this.currentNode;if(null==t)return!1;var e=t.inLinks||[],t=t.outLinks||[],i=[];e.forEach(function(t){i.push(t.source)}),t.forEach(function(t){i.push(t.target)}),this.addToSelectedElements(i)},R.prototype.onlyShowSelectedNode=function(){this.nodes.forEach(function(t){t.selected||(t.visible=!1)}),this.refreshView()},R.prototype.hideSelectedNode=function(){this.nodes.forEach(function(t){t.selected&&(t.visible=!1)}),this.refreshView()},R.prototype.hideIsolatedNodes=function(){this.nodes.forEach(function(t){0==(t.inLinks||[]).length&&0==(t.outLinks||[]).length&&(t.visible=!1)}),this.refreshView()},R.prototype.deleteNodes=function(t){var e,i,n;t instanceof Array&&0!=t.length&&(t=t.map(function(t){return t}),e=this,i=[],n=-1,t.forEach(function(t){(t.inLinks||[]).forEach(function(t){i.push(t)}),(t.outLinks||[]).forEach(function(t){i.push(t)}),-1<(n=e.nodes.indexOf(t))&&(e.nodes.splice(n,1),e.scene.remove(t))}),i.forEach(function(t){-1<(n=e.links.indexOf(t))&&(e.links.splice(n,1),e.scene.remove(t))}),this.undoManager.todo("node:remove",t.concat(i)),this.refreshView())},R.prototype.deleteNode=function(t){t&&this.deleteNodes([t])},R.prototype.deleteLinks=function(t){var i;t instanceof Array&&0!=t.length&&(t=t.map(function(t){return t}),i=this,t.forEach(function(t){var e=i.links.indexOf(t);-1<e&&(i.links.splice(e,1),i.scene.remove(t))}),this.undoManager.todo("link:remove",t),this.refreshView())},R.prototype.deleteLink=function(t){t&&this.deleteLinks([t])},R.prototype.removeCurrentLink=function(){this.deleteLink(this.currentLink),this.currentLink=null},R.prototype.scaleGraph=function(n){var o=0,s=0;this.nodes.forEach(function(t){o+=t.x,s+=t.y}),o/=this.nodes.length,s/=this.nodes.length,o=Math.round(o),s=Math.round(s),this.nodes.forEach(function(t){var e=(t.x-o)*n,i=(t.y-s)*n;t.x=o+e,t.y=s+i}),this.refreshView()},R.prototype.rotateGraph=function(t){var n=Math.sin(-t*Math.PI/180),o=Math.cos(-t*Math.PI/180),s=0,a=0;this.nodes.forEach(function(t){s+=t.cx,a+=t.cy}),s/=this.nodes.length,a/=this.nodes.length,s=Math.round(s),a=Math.round(a),this.nodes.forEach(function(t){var e=t.cx-s,i=t.cy-a;t.cx=s+e*o-i*n,t.cy=a+i*o+e*n}),this.refreshView()},R.prototype.selectedEdge=function(t){t&&(t.selected=!0,this.scene.addToSelected(t),t.target.selected=!0,this.scene.addToSelected(t.target),t.source.selected=!0,this.scene.addToSelected(t.source))},R.prototype.getMouseDownPosition=function(){return{x:this.scene.mouseDownX,y:this.scene.mouseDownY}},R.prototype.covertPagePosition=function(t,e){return 2!=arguments.length?{pageX:0,pageY:0}:this.stage.getPagePosition(t,e)},R.prototype.convertScenePosition=function(t){var e=null;return t.pageX?e=i(t):((e=i(t)).pageX=t.clientX+document.body.scrollLeft-document.body.clientLeft,e.pageY=t.clientY+document.body.scrollTop-document.body.clientTop),{x:e.x,y:e.y};function i(t){var e,i={};for(e in t)"returnValue"!=e&&"keyLocation"!=e&&(i[e]=t[e]);return i}},R.prototype.addNodeForDrag=function(e,i){var n=this;n.stage.removeEventListener("mousemove"),n.stage.mousemove(function(t){t=n.scene.toSceneEvent(t),n.stage.removeEventListener("mousemove"),e.id=null==e.id?m(12):e.id,e.x=t.x,e.y=t.y,t=n.newNode(e);t.fixed=!0,n.refreshView(),i&&"function"==typeof i&&i(t)})},R.prototype.removeSelectNodes=function(){var t=this.nodes.filter(function(t){return t.selected});this.deleteNodes(t)},R.prototype.clearAll=function(){this.scene&&this.scene.clear(),this.nodes=[],this.links=[],this.currentNode=null,this.currentLink=null,this.currentCluster=null,this.currentLayout=null,this.clusterGroups=[],this.drawLinkFlag=!1,this.virLink=null,this.undoManager.clearAll(),this.zoomOriginal(),this.refreshView()},R.prototype.setZoom=function(t){switch(t){case"zoomOut":this.zoomOut();break;case"zoomIn":this.zoomIn();break;case"zoom1":this.zoomOriginal();break;default:this.zoomFit()}},R.prototype.zoomOut=function(){this.stage.zoomOut(),this.refreshView()},R.prototype.zoomIn=function(){this.stage.zoomIn(),this.refreshView()},R.prototype.zoomFit=function(){this.stage.centerAndZoom(),this.refreshView()},R.prototype.zoomOriginal=function(){this.stage.centerAndZoom(),this.scene.scale=1,this.refreshView()},R.prototype.getZoomRatio=function(){return this.scene.scale},R.prototype.destroy=function(){this.clearAll(),this.scene.removeAllEventListener(),this.stage.removeAllEventListener()},R.prototype.beginAddLine=function(t){this.drawLinkFlag=!0,t&&"function"==typeof t&&(this.drawLineCallback=t)},R.prototype.getSelectedNodes=function(){return this.nodes.filter(function(t){return 1==t.selected})},R.prototype.findNodesByAttr=function(e,i){return this.nodes.filter(function(t){return t[e]==i})},R.prototype.findNodeById=function(e){var t=this.nodes.filter(function(t){return t.id==e});return 0<t.length?((t=t[0]).visible=!0,t):null},R.prototype.getNodes=function(){return(this.nodes||[]).map(function(t){return t})},R.prototype.getEdges=function(){return(this.links||[]).map(function(t){return t})},R.prototype.getNodeById=function(e){return this.nodes.filter(function(t){return t.id==e})[0]},R.prototype.getEdgeById=function(e){return this.links.filter(function(t){return t.id==e})[0]},R.prototype.switchAnimate=function(t){this.stage.fps=t?50:-50},R.prototype.setStaticMode=function(t){this.stage.staticMode=t},R.prototype.setSmoothWheelMode=function(t){this.stage.smoothWheelMode=Boolean(t)},R.prototype.setShowDetailScale=function(){this.stage.showDetailScale=Number(0<arguments.length&&void 0!==arguments[0]?arguments[0]:.2)||.2,this.validChar,this.licenseKey},R.prototype.setDragHideLine=function(t){this.stage.openDragHideEffect=Boolean(t),this.validChar,this.licenseKey},R.prototype.updateThumbnail=function(){this.stage.thumbnail.visible&&this.stage.thumbnail.update()},R.prototype.showThumbnail=function(t){t?this.stage.thumbnail.show():this.stage.thumbnail.destroy()},R.prototype.randomColor=function(){return Math.floor(255*Math.random())+","+Math.floor(200*Math.random())+","+Math.floor(255*Math.random())},R.prototype.buildVisualGraphData=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=new Map,o=(t.forEach(function(t){t.scale=1,t.radius=t.radius||30,t.x=t.x||Math.round(1e3*Math.random()),t.y=t.y||Math.round(1e3*Math.random()),t.cx=t.x,t.cy=t.y,t.selected=t.selected||!1,n.set(t.id,t)}),[]),s=(e.forEach(function(t){var e=n.get(t.source),i=n.get(t.target);e&&(e.outLinks=e.outLinks||[],e.outLinks.push({source:e,target:i})),i&&(i.inLinks=i.inLinks||[],i.inLinks.push({source:e,target:i})),null!=i&&null!=e&&o.push({id:t.id||"".concat(t.source,"-").concat(t.target),source:e,target:i})}),[]);return n.forEach(function(t,e){s.push(t)}),i&&(t=this.getViewCenter(),this.preGroupLayout(s,t)),{nodes:s,links:o}},R.prototype.preResetNodeCoords=function(t){var i,n,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[100,100],o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:80,s=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],t=[].concat(t),a=(t.sort(function(t,e){return(e.inLinks||[]).length+(e.outLinks||[]).length-((t.inLinks||[]).length+(t.outLinks||[]).length)}),Math.PI*(3-Math.sqrt(5))),r=e[0],h=e[1];t.forEach(function(t,e){i=o*Math.sqrt(e+=.5),n=a*e,0==e?(t=r,(t=h).fixed=!0):(t.x=r+i*Math.cos(n),t.y=h+i*Math.sin(n))}),s&&this.moveCenter(this.scene.scaleRange[0])},R.prototype.showLoadProcess=function(){this.stage.showLoading(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Loading",1<arguments.length&&void 0!==arguments[1]?arguments[1]:.1),this.validChar,this.licenseKey},R.prototype.hideLoadProcess=function(){this.stage.hideLoading()},R.prototype.getViewCenter=function(){return{x:this.stage.width/2-this.scene.translateX,y:this.stage.height/2-this.scene.translateY}},R.prototype.setSceneDragAble=function(){this.scene.dragable=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],this.validChar,this.licenseKey},R.prototype.excuteLocalLayout=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"fastForce",e=1<arguments.length?arguments[1]:void 0,i=2<arguments.length?arguments[2]:void 0,n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=this,s=(this.validChar,this.licenseKey,new it(t)),a={nodes:this.nodes,links:this.links},t=(n&&(a=o.getVisibleData()),-1!=["fastForce","kawakai","hierarchical","simulation"].indexOf(t)?(a.nodes.forEach(function(t){t.fixed=!1}),s.addData(a.nodes,this.edgeCut(a.links))):"radialTree"==t?(n=o.miniSpanningTree(),s.addData(a.nodes,n)):s.addData(a.nodes,a.links),o.getViewCenter());(e=e||{}).center=[t.x,t.y],s.resetConfig(e),function t(){cancelAnimationFrame(o.layoutLoopName),s.finished?"function"==typeof i&&i():(s.excute(),o.refreshView(),o.layoutLoopName=requestAnimationFrame(t))}()},R.prototype.stopLayout=function(){cancelAnimationFrame(this.layoutLoopName)},R.prototype.edgeCut=function(t){var e,i,n={},o=[];return t.forEach(function(t){t.source.id!=t.target.id&&(e="".concat(t.source.id,"-").concat(t.target.id),i="".concat(t.target.id,"-").concat(t.source.id),n[e]&&n[i]||(o.push(t),n[e]=!0,n[i]=!0))}),o},R.prototype.excuteWorkerLayout=function(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"fastForce",n=2<arguments.length?arguments[2]:void 0,o=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],s=4<arguments.length?arguments[4]:void 0;this.validChar,this.licenseKey,cancelAnimationFrame(this.layoutLoopName),"dagre"!=i&&"radial"!=i?(e=[0,0],e=null!=n&&n.center||this.getViewCenter(),o&&this.preGroupLayout(t.nodes,{x:e.x,y:e.y}),ot(this,t,e,i,n,s)):this.excuteLocalLayout(i,n,s)},R.prototype.preGroupLayout=function(t,s){var a,e=[],i=[],r=(t.forEach(function(t){t.readFlag=!1,t.degree=(t.inLinks||[]).length+(t.outLinks||[]).length,1<t.degree?i.push(t):0==t.degree&&e.push(t)}),i.sort(function(t,e){return t.degree-e.degree}),2*Math.PI*(3-Math.sqrt(6)));i.forEach(function(n,t){var e=[],i=((n.outLinks||[]).forEach(function(t){t.target.readFlag||e.push(t.target)}),(n.inLinks||[]).forEach(function(t){t.source.readFlag||e.push(t.source)}),t*r),o=0==e.length?50:200;t%2==0&&(o=-o),o=(100*Math.random()+o)*Math.sqrt(.2+t),n.x=s.x+Math.round(Math.random()*o)*Math.cos(i),n.y=s.y+Math.round(Math.random()*o)*Math.sin(i),n.readFlag=!0,a=2*n.radius,e.forEach(function(t,e){var e=e+12,i=a*Math.sqrt(.5+e),e=e*r;t.readFlag=!0,t.x=n.x+i*Math.cos(e),t.y=n.y+i*Math.sin(e)})}),e.forEach(function(t,e){var i=e*r,e=e%2==0?-500:500;t.x=s.x+Math.round(Math.random()*e)*Math.cos(i),t.y=s.y+Math.round(Math.random()*e)*Math.sin(i)})},R.prototype.clusterGroupLayout=function(){var a=this,r=0,h=a.clusterGroups,c=new Map,l=(h.forEach(function(e){var t=e.childs,i={nodes:t,links:a.getConnectLinkOfNodes(t)};a.excuteWorkerLayout(i,"fastForce",null,!1,function(){r++}),t.forEach(function(t){c.set(t.id,e.id)})}),setInterval(function(){var e,i,n,t,o,s;h.length==r&&(clearInterval(l),a.zoomFit(),n=new Map,t=a.clusterGroups.map(function(t,e){return n.set(t.id,t),{id:t.id,x:t.outerCircleCenter.x,y:t.outerCircleCenter.y,cx:t.outerCircleCenter.x,cy:t.outerCircleCenter.y,scale:1,radius:t.outerCircleRadius}}),o=new Set,a.links.forEach(function(t){e=c.get(t.source.id),i=c.get(t.target.id),e!=i&&o.add({source:e,target:i})}),s={nodes:t,links:Array.from(o)},a.excuteWorkerLayout(s,"fastForce",{noverlap:!0,charge:50},!1,function(){s.nodes.forEach(function(t){n.get(t.id).setLocation(t.cx,t.cy)}),a.zoomFit()}))},1e3))},R.prototype.findCommonNeighbors=function(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],o=[];return n.forEach(function(e){var i=(e.outLinks||[]).map(function(t){return t.target})||[];(e.inLinks||[]).forEach(function(t){i.push(t.source)}),n.forEach(function(t){e!=t&&((t.outLinks||[]).forEach(function(t){-1!=i.indexOf(t.target)&&o.push(t.target)}),(t.inLinks||[]).forEach(function(t){-1!=i.indexOf(t.source)&&o.push(t.source)}))})}),function(t){if(Array.isArray(t))return s(t)}(t=new Set(o))||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||G(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()},R.prototype.parsePathFromNodes=function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=[],n=t.length-1,o=0;o<n;o++)i.push(t[o]+"-"+t[o+1]);return e?this.links.filter(function(t){return-1!=i.indexOf(t.source.id+"-"+t.target.id)}):this.links.filter(function(t){return-1!=i.indexOf(t.source.id+"-"+t.target.id)||-1!=i.indexOf(t.target.id+"-"+t.source.id)})},R.prototype.community=function(t){return function(t,e,i){var n=null,n=new at(1<arguments.length&&void 0!==e?e:[],2<arguments.length&&void 0!==i?i:[]),e=new Map;return e=n?n.applay():e}(t,this.nodes,this.links)},R.prototype.findNLevelRelations=function(t){var a,r,h,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return null==t||c<1?[t]:(a=[],r={},h=[],null!=t&&(h.push(t),function e(t,i){var n,o,s;1<i?(c==i&&-1==a.indexOf(t)&&a.push(t),n=c-i,o=t.inLinks||[],s=t.outLinks||[],o.forEach(function(t){-1==a.indexOf(t.source)&&(a.push(t.source),null==r[n]&&(r[n]=[]),r[n].push(t.source))}),s.forEach(function(t){-1==a.indexOf(t.target)&&(a.push(t.target),null==r[n]&&(r[n]=[]),r[n].push(t.target))}),null!=r[n]&&r[n].forEach(function(t){e(t,i-1)})):1==i&&(o=t.inLinks||[],s=t.outLinks||[],o.forEach(function(t){-1==a.indexOf(t.source)&&h.push(t.source)}),s.forEach(function(t){-1==a.indexOf(t.target)&&h.push(t.target)}))}(t,c)),h)},R.prototype.addToSelectedElements=function(){var e=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){t.selected=!0,e.scene.addToSelected(t)}),e.refreshView()},R.prototype.createBaseAnimate=function(){return W(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},R.prototype.createTimelineAnimate=function(){return W.timeline(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},R.prototype.registEventListener=function(t,e,i){null!=t&&null!=e&&null!=i&&(this.validChar,this.licenseKey,e=Ht[t][e])&&"function"==typeof i&&(this.config[t][e]=i)},R.prototype.removeEventListener=function(t,e){null!=t&&null!=e&&(e=Ht[t][e])&&delete this.config[t][e]},R.prototype.removeAllEventListener=function(t){if(null!=t){var e=this.config[t];if(e)for(var i in e)delete e[i]}},R.prototype.registRightMenu=function(t,e){-1!=["scene","node","link","group"].indexOf(t)&&(this.validChar,this.licenseKey,(e=e||{}).hasOwnProperty("show"))&&"function"==typeof e.show&&e.hasOwnProperty("hide")&&"function"==typeof e.hide&&(this.config.hasOwnProperty("rightMenu")||(this.config.rightMenu={}),this.config.rightMenu["".concat(t,"Menu")]=e)},R.prototype.reConfigNodeCluster=function(e){var i,n;e&&"object"==C(e)&&(this.validChar,this.licenseKey,(i=this).config.nodeClusters=e,n=null,i.nodes.forEach(function(t){(n=e[t.type])&&(t.fillColor=n.color||i.config.node.color,t.shape=n.shape||i.config.node.shape,t.size=n.size||i.config.node.size,t.font=n.font||i.config.node.label.font,t.fontColorfontColor=n.fontColor||i.config.node.label.color,t.borderWidth=n.borderWidth||i.config.node.borderWidth,t.borderColor=n.borderColor||i.config.node.borderColor,t.selectedBorderWidth=n.selectedBorderWidth||i.config.node.selected.borderWidth,t.selectedBorderColor=n.selectedBorderColor||i.config.node.selected.borderColor,t.shadowColor=n.shadowColor||i.config.node.selected.shadowColor,t.textPosition=n.textPosition||i.config.node.label.textPosition,t.tagColor=n.tagColor||i.config.node.tagColor,n.image)&&t.setImage(n.image,function(){i.refreshView()})}),i.refreshView())},R.prototype.reConfigLinkCluster=function(e){var i,n;e&&"object"==C(e)&&(this.validChar,this.licenseKey,(i=this).config.linkClusters=e,n=null,i.links.forEach(function(t){(n=e[t.type])&&(t.strokeColor=n.color||i.config.link.color,t.lineWidth=n.lineWidth||i.config.link.lineWidth,t.lineType=n.lineType||i.config.link.lineType,t.lineDash=n.lineDash||i.config.link.lineDash,t.selectedColor=n.selectedColor||i.config.link.selected.color,t.font=n.font||i.config.link.label.font,t.fontColor=n.fontColor||i.config.link.label.color,t.showArrow=n.showArrow||i.config.link.showArrow,t.labelBackGround=n.labelBackGround||i.config.link.label.background)}),i.refreshView())},R.prototype.definedNodePaintFunc=function(t){"function"==typeof t&&(this.validChar,this.licenseKey,this.defindPaintFuncCache.nodePaintFunc=t)},R.prototype.definedNodeInBoundFunc=function(t){"function"==typeof t&&(this.defindPaintFuncCache.nodeInBoundFunc=t)},R.prototype.definedLinkPaintFunc=function(t){"function"==typeof t&&(this.validChar,this.licenseKey,this.defindPaintFuncCache.linePaintFunc=t)},R.prototype.definedLinkInBoundFunc=function(t){"function"==typeof t&&(this.defindPaintFuncCache.linkInBoundFunc=t)},R.prototype.registIconFonts=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:200,o=2<arguments.length?arguments[2]:void 0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"#fff",a=this,r=Math.round(n/2);t.forEach(function(t){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=e.height=n,i.textBaseline="middle",i.textAlign="center",i.font="normal ".concat(n,"px ").concat(o),i.fillStyle=t.color||s,i.fillText(t.content,r,r),a.iconImageCache[t.name]=h(h({},t),{},{size:n,image:e})})},R.prototype.mergeNodes=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length?arguments[1]:void 0;if(Array.isArray(t)&&t.length<2)return null;var i=this,n=m(10),o=new Map,s=new Set;t.forEach(function(t){o.set(t.id,t),(t.outLinks||[]).forEach(function(t){return s.add(t)}),(t.inLinks||[]).forEach(function(t){return s.add(t)}),t.visible=!1});for(var a,r,h,c,l=[],u=Array.from(s),d=null,f={},g=0;g<u.length;g++)a=(d=u[g]).source.id,r=d.target.id,d.visible=!1,h="".concat(a,"-").concat(n),c="".concat(n,"-").concat(r),f[h]||f[c]||(null!=o.get(a)?null==o.get(r)&&(f[c]=!0,f["".concat(r,"-").concat(n)]=!0,l.push({id:"virtul-s-"+m(12),source:n,target:r,lineWidth:4,lineDash:[5,8,5],showArrow:!1})):(f[h]=!0,f["".concat(n,"-").concat(a)]=!0,l.push({id:"virtul-t-"+m(12),source:a,target:n,lineWidth:4,lineDash:[5,8,5],showArrow:!1})));var p=this.getNodesCoodinateCenter(t),e=this.addNode({id:n,label:e,image:"data:image/svg+xml;base64,".concat(btoa('<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2322" width="128" height="128" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M736 256m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#4A8BFE" p-id="2323"></path><path d="M800 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#3BD5B3" p-id="2324"></path><path d="M528 592m-112 0a112 112 0 1 0 224 0 112 112 0 1 0-224 0Z" fill="#4A8BFE" p-id="2325"></path><path d="M704 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#3BD5B3" p-id="2326"></path><path d="M864 704m-32 0a32 32 0 1 0 64 0 32 32 0 1 0-64 0Z" fill="#4A8BFE" p-id="2327"></path><path d="M272 784m-80 0a80 80 0 1 0 160 0 80 80 0 1 0-160 0Z" fill="#4A8BFE" p-id="2328"></path><path d="M192 544m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#3BD5B3" p-id="2329"></path><path d="M368 368m-80 0a80 80 0 1 0 160 0 80 80 0 1 0-160 0Z" fill="#3BD5B3" p-id="2330"></path><path d="M208 240m-48 0a48 48 0 1 0 96 0 48 48 0 1 0-96 0Z" fill="#3BD5B3" p-id="2331"></path><path d="M528 176m-48 0a48 48 0 1 0 96 0 48 48 0 1 0-96 0Z" fill="#4A8BFE" p-id="2332"></path><path d="M496 816m-48 0a48 48 0 1 0 96 0 48 48 0 1 0-96 0Z" fill="#3BD5B3" p-id="2333"></path><path d="M592 368m-48 0a48 48 0 1 0 96 0 48 48 0 1 0-96 0Z" fill="#3BD5B3" p-id="2334"></path></svg>')),shape:"circle",scale:2,color:"250,250,250",borderWidth:2,font:"normal 12px YaHei",textPosition:"Bottom_Center",type:"mergeNode"}),y=(e.cx=p[0],e.cy=p[1],e.orginCoodinate=p,e.containNodes=t,e.containLinks=u,-1);return t.forEach(function(t){-1!=(y=i.nodes.indexOf(t))&&i.nodes.splice(y,1)}),u.forEach(function(t){-1!=(y=i.links.indexOf(t))&&i.links.splice(y,1)}),this.addEdges(l),e},R.prototype.expandNode=function(t){var e,i,n;"mergeNode"==t.type&&(e=t.orginCoodinate,i=[t.cx-e[0],t.cy-e[1]],n=this,t.containNodes.forEach(function(t){t.cx=t.cx+i[0],t.cy=t.cy+i[1],t.visible=!0,n.nodes.push(t)}),t.containLinks.forEach(function(t){t.visible=!0,n.links.push(t)}),this.deleteNode(t))},R.prototype.getNodesCoodinateCenter=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=0,i=0;return t.forEach(function(t){e+=t.cx,i+=t.cy}),e/=t.length,i/=t.length,[Math.round(e),Math.round(i)]},R.prototype.getConnectLinkOfNodes=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=new Map,i=new Set;t.forEach(function(t){e.set(t.id,t),(t.outLinks||[]).forEach(function(t){return i.add(t)}),(t.inLinks||[]).forEach(function(t){return i.add(t)})});var n,o,s=[];return Array.from(i).forEach(function(t){n=t.source.id,o=t.target.id,null!=e.get(n)&&null!=e.get(o)&&s.push(t)}),s},R.prototype.undoAction=function(){this.undoManager.undo(this)},R.prototype.getViewSize=function(){return{width:this.stage.width,height:this.stage.height}},R.prototype.setBackGroundColor=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"#fff";t&&(this.validChar,this.licenseKey,this.stage.setBackGroundColor(t))},R.prototype.setBackGroundImage=function(t){t&&(this.validChar,this.licenseKey,this.stage.setBackGroundImage(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:1))},OffscreenCanvasRenderingContext2D&&(OffscreenCanvasRenderingContext2D.prototype.DGraphRoundRect=Vt),CanvasRenderingContext2D.prototype.DGraphRoundRect=Vt,OffscreenCanvasRenderingContext2D&&(OffscreenCanvasRenderingContext2D.prototype.drawArrowLine=Xt),CanvasRenderingContext2D.prototype.drawArrowLine=Xt,OffscreenCanvasRenderingContext2D&&(OffscreenCanvasRenderingContext2D.prototype.paintCustomArrow=Yt),CanvasRenderingContext2D.prototype.paintCustomArrow=Yt,OffscreenCanvasRenderingContext2D&&(OffscreenCanvasRenderingContext2D.prototype.drawArrowTail=jt),CanvasRenderingContext2D.prototype.drawArrowTail=jt,requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||function(t){clearTimeout(t)},R;function Vt(t,e,i,n,o){this.roundRect?(this.beginPath(),this.roundRect(t,e,i,n,o<0?0:o)):o?(n<2*(o=i<2*o?i/2:o)&&(o=n/2),this.beginPath(),this.moveTo(t+o,e),this.arcTo(t+i,e,t+i,e+n,o),this.arcTo(t+i,e+n,t,e+n,o),this.arcTo(t,e+n,t,e,o),this.arcTo(t,e,t+i,e,o),this.closePath()):(this.beginPath(),this.rect(t,e,i,n))}function Xt(t,e,i,n,o){(o=void 0===o?3:o)<3&&(o=3);function s(t,e,i,n){var o=i*Math.cos(n),i=i*Math.sin(n);return{x:o+=t,y:i+=e}}var a=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)),r=Math.asin(Math.abs(n-e)/a),a=(i<t&&e<n?r=Math.PI-r:i<t&&n<e?r+=Math.PI:t<i&&n<e&&(r=2*Math.PI-r),s(t,e,a-2*o,r)),h=a.x,a=a.y,c=s(h,a,o,r-.5*Math.PI),l=s(h,a,2*o,r-.5*Math.PI),u=s(h,a,o,r+.5*Math.PI),h=s(h,a,2*o,r+.5*Math.PI);this.moveTo(t,e),this.lineTo(c.x,c.y),this.lineTo(l.x,l.y),this.lineTo(i,n),this.lineTo(h.x,h.y),this.lineTo(u.x,u.y),this.closePath()}function Yt(t,e,i,n,o){var i=i-t,n=n-e,s=Math.sqrt(i*i+n*n),a=n/s,r=i/s,h=[];h.push(0,0);for(var c=0;c<o.length;c+=2){var l=o[c],u=o[c+1];h.push(l<0?s+l:l,u)}for(h.push(s,0),c=o.length;0<c;c-=2)l=o[c-2],u=o[c-1],h.push(l<0?s+l:l,-u);for(h.push(0,0),c=0;c<h.length;c+=2)l=h[c]*r-h[c+1]*a+t,u=h[c]*a+h[c+1]*r+e,0===c?this.moveTo(l,u):this.lineTo(l,u)}function jt(t,e,i,n,o){var s=e-o*Math.cos(n),a=i-o*Math.sin(n),r=e+.8*o*Math.cos(n),h=i+.8*o*Math.sin(n),c=s+o/1.2*Math.cos(n+.3*Math.PI),l=a+o/1.2*Math.sin(n+.3*Math.PI),s=s+o/1.2*Math.cos(n-.3*Math.PI),a=a+o/1.2*Math.sin(n-.3*Math.PI);t.beginPath(),t.moveTo(e,i),t.lineTo(c,l),t.lineTo(r,h),t.lineTo(s,a),t.closePath()}});
